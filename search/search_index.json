{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome to Mint Documentation","text":"<p>A production-ready, event-driven microservices wallet system featuring secure authentication, real-time transaction processing, and automated notifications.</p> <p> </p>"},{"location":"#overview","title":"Overview","text":"<p>Mint is a microservices-based wallet system built with Node.js, TypeScript, and event-driven architecture using RabbitMQ. It demonstrates production-ready patterns for building scalable, distributed systems.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>\ud83d\udd10 Secure Authentication - JWT with RS256 asymmetric encryption</li> <li>\ud83d\udcb0 Real-time Wallet Management - Event-driven balance updates</li> <li>\ud83d\udd01 Robust Transaction Processing - ACID-compliant with automatic rollback</li> <li>\ud83d\udce8 Smart Notifications - Email alerts for all wallet activities</li> <li>\ud83d\udd17 Production API Gateway - NGINX with rate limiting and load balancing</li> </ul>"},{"location":"#quick-links","title":"Quick Links","text":"<ul> <li> <p> Getting Started</p> <p>Install Mint in minutes and run your first transaction</p> <p> Installation Guide</p> </li> <li> <p> Architecture</p> <p>Learn about the microservices architecture and event-driven design</p> <p> Architecture Overview</p> </li> <li> <p> API Reference</p> <p>Complete API documentation for all services</p> <p> API Docs</p> </li> <li> <p> Development</p> <p>Set up your local development environment</p> <p> Developer Guide</p> </li> </ul>"},{"location":"#architecture-at-a-glance","title":"Architecture at a Glance","text":"<pre><code>graph TB\n    Client[Client Application]\n    Gateway[NGINX Gateway :80]\n    Auth[Auth Service :4001]\n    Wallet[Wallet Service :4003]\n    Transactions[Transactions Service :4004]\n    Notifications[Notifications Service :4002]\n    RabbitMQ[(RabbitMQ :5672)]\n    MongoDB[(MongoDB :27017)]\n\n    Client --&gt; Gateway\n    Gateway --&gt; Auth\n    Gateway --&gt; Wallet\n    Gateway --&gt; Transactions\n\n    Auth --&gt; RabbitMQ\n    Transactions --&gt; RabbitMQ\n    Wallet --&gt; RabbitMQ\n    RabbitMQ --&gt; Notifications\n\n    Auth --&gt; MongoDB\n    Wallet --&gt; MongoDB\n    Transactions --&gt; MongoDB\n\n    style Gateway fill:#2196F3\n    style RabbitMQ fill:#FF9800\n    style MongoDB fill:#4CAF50</code></pre>"},{"location":"#technology-stack","title":"Technology Stack","text":"Category Technologies Runtime Node.js 22.x, TypeScript 5.x Framework Express.js 5.x Database MongoDB 7.x with Mongoose Message Broker RabbitMQ 3.x API Gateway NGINX Alpine Authentication JWT (RS256), Argon2 Validation Zod Containerization Docker, Docker Compose Logging Winston, Pino"},{"location":"#project-highlights","title":"Project Highlights","text":""},{"location":"#event-driven-architecture","title":"Event-Driven Architecture","text":"<p>All service-to-service communication happens through RabbitMQ events, ensuring:</p> <ul> <li>Loose Coupling - Services are independent and can be deployed separately</li> <li>Scalability - Easy horizontal scaling of individual services</li> <li>Reliability - Guaranteed message delivery with acknowledgments</li> <li>Async Processing - Non-blocking operations for better performance</li> </ul>"},{"location":"#security-first","title":"Security First","text":"<ul> <li>RS256 JWT Tokens - Asymmetric encryption for enhanced security</li> <li>JWKS Endpoint - Public key distribution for token verification</li> <li>HTTP-only Cookies - Protection against XSS attacks</li> <li>Argon2 Password Hashing - Industry-standard password security</li> <li>Rate Limiting - Protection against brute force attacks</li> </ul>"},{"location":"#production-ready","title":"Production Ready","text":"<ul> <li>Health Checks - Monitor service availability</li> <li>Error Handling - Graceful error responses and logging</li> <li>Docker Compose - Simple deployment with container orchestration</li> <li>Environment Config - Separate configs for dev/prod environments</li> <li>API Documentation - Comprehensive OpenAPI-style documentation</li> </ul>"},{"location":"#use-cases","title":"Use Cases","text":"<p>Mint's architecture is suitable for:</p> <ul> <li>Portfolio Projects - Demonstrate microservices expertise</li> <li>Learning Platform - Understand event-driven architecture</li> <li>MVP Foundation - Build fintech applications quickly</li> <li>Interview Preparation - Discuss system design patterns</li> <li>Production Template - Base for real-world wallet systems</li> </ul>"},{"location":"#whats-next","title":"What's Next?","text":"<ul> <li> <p>Installation</p> <p>Get Mint up and running in 5 minutes</p> <p>Start Here </p> </li> <li> <p>Quick Start</p> <p>Complete your first transaction flow</p> <p>Try It </p> </li> <li> <p>API Reference</p> <p>Explore all available endpoints</p> <p>View APIs </p> </li> <li> <p>Contributing</p> <p>Help improve Mint</p> <p>Contribute </p> </li> </ul>"},{"location":"#support","title":"Support","text":"<ul> <li>GitHub Issues: Report bugs or request features</li> <li>Documentation: Browse the guides in the sidebar</li> <li>Source Code: View on GitHub</li> </ul> <p>Built with  by Sreekar Venkata Nutulapati</p> <p>GitHub \u00b7 LinkedIn</p>"},{"location":"architecture/","title":"Architecture Overview","text":""},{"location":"architecture/#table-of-contents","title":"Table of Contents","text":"<ul> <li>System Architecture</li> <li>Services</li> <li>Communication Patterns</li> <li>Database Architecture</li> <li>Security Architecture</li> <li>Scalability Considerations</li> </ul>"},{"location":"architecture/#system-architecture","title":"System Architecture","text":"<p>Mint follows a microservices architecture with event-driven communication using RabbitMQ. Each service is independently deployable, scalable, and maintains its own database following the \"Database per Service\" pattern.</p>"},{"location":"architecture/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>flowchart TB\n    %% =========================\n    %% API GATEWAY\n    %% =========================\n    subgraph Gateway[\"\ud83c\udf10 API Gateway\"]\n        NGINX[\"NGINX&lt;br/&gt;:80&lt;br/&gt;&lt;small&gt;Rate Limiting \u00b7 Load Balancing&lt;/small&gt;\"]\n    end\n\n    %% =========================\n    %% CORE SERVICES\n    %% =========================\n    subgraph Services[\"\ud83e\udde9 Core Services\"]\n        AUTH[\"\ud83d\udd10 Auth&lt;br/&gt;:4001\"]\n        WALLET[\"\ud83d\udcb0 Wallet&lt;br/&gt;:4003\"]\n        TXN[\"\ud83d\udcb3 Transactions&lt;br/&gt;:4004\"]\n        NOTIF[\"\ud83d\udd14 Notifications&lt;br/&gt;:4002\"]\n    end\n\n    %% =========================\n    %% DATA &amp; MESSAGING\n    %% =========================\n    subgraph Infra[\"\ud83d\uddc4\ufe0f Data &amp; Messaging\"]\n        REDIS[(\u26a1 Redis&lt;br/&gt;:6379)]\n        RABBIT[\"\ud83d\udce8 RabbitMQ&lt;br/&gt;:5672&lt;br/&gt;&lt;small&gt;auth.events \u00b7 transaction.events&lt;/small&gt;\"]\n        MONGO[(\ud83d\uddc3\ufe0f MongoDB&lt;br/&gt;:27017&lt;br/&gt;&lt;small&gt;auth \u00b7 wallet \u00b7 transactions&lt;/small&gt;)]\n    end\n\n    %% =========================\n    %% OBSERVABILITY\n    %% =========================\n    subgraph Observability[\"\ud83d\udcca Observability\"]\n        PROM[\"\ud83d\udcc8 Prometheus&lt;br/&gt;:9090\"]\n        GRAF[\"\ud83d\udcca Grafana&lt;br/&gt;:3000\"]\n        LOKI[\"\ud83d\udcdd Loki&lt;br/&gt;:3100\"]\n        ALLOY[\"\ud83d\udd04 Alloy&lt;br/&gt;&lt;small&gt;Log Collector&lt;/small&gt;\"]\n    end\n\n    %% =========================\n    %% TRAFFIC FLOW\n    %% =========================\n    NGINX --&gt; AUTH\n    NGINX --&gt; WALLET\n    NGINX --&gt; TXN\n\n    %% =========================\n    %% CACHE\n    %% =========================\n    AUTH &lt;--&gt; |cache| REDIS\n    WALLET &lt;--&gt; |cache| REDIS\n    TXN &lt;--&gt; |cache| REDIS\n\n    %% =========================\n    %% ASYNC EVENTS\n    %% =========================\n    AUTH --&gt; |auth.events| RABBIT\n    WALLET --&gt; |wallet.events| RABBIT\n    TXN --&gt; |transaction.events| RABBIT\n    RABBIT --&gt; |consume| NOTIF\n\n    %% =========================\n    %% DATABASE\n    %% =========================\n    AUTH --&gt; |users| MONGO\n    WALLET --&gt; |wallets| MONGO\n    TXN --&gt; |transactions| MONGO\n\n    %% =========================\n    %% METRICS\n    %% =========================\n    AUTH --&gt; |/metrics| PROM\n    WALLET --&gt; |/metrics| PROM\n    TXN --&gt; |/metrics| PROM\n    NOTIF --&gt; |/metrics| PROM\n    PROM --&gt; GRAF\n\n    %% =========================\n    %% LOGS\n    %% =========================\n    AUTH --&gt; |logs| ALLOY\n    WALLET --&gt; |logs| ALLOY\n    TXN --&gt; |logs| ALLOY\n    NOTIF --&gt; |logs| ALLOY\n    ALLOY --&gt; LOKI\n    LOKI --&gt; GRAF</code></pre>"},{"location":"architecture/#communication-patterns","title":"Communication Patterns","text":"<ol> <li>Synchronous (HTTP/REST): Client \u2192 NGINX \u2192 Microservices</li> <li>Asynchronous (Events): Service \u2192 RabbitMQ \u2192 Consumer Services</li> <li>Service-to-Service: Via RabbitMQ events (no direct HTTP calls between services)</li> </ol>"},{"location":"architecture/#services","title":"Services","text":""},{"location":"architecture/#auth-service","title":"\ud83d\udd10 Auth Service","text":"<p>Port: 4001 Database: <code>auth_db</code></p>"},{"location":"architecture/#responsibilities","title":"Responsibilities","text":"<ul> <li>User registration and authentication</li> <li>JWT token generation and validation</li> <li>JWKS endpoint for public key distribution</li> <li>User profile management</li> <li>Session management</li> </ul>"},{"location":"architecture/#tech-stack","title":"Tech Stack","text":"<ul> <li>Express.js - Web framework</li> <li>MongoDB/Mongoose - Database</li> <li>Redis/IORedis - Caching layer</li> <li>Argon2 - Password hashing</li> <li>Jose - JWT handling with RS256</li> <li>Zod - Request validation</li> <li>RabbitMQ - Event publishing</li> <li>Prometheus - Metrics collection</li> <li>Swagger/OpenAPI - API documentation</li> </ul>"},{"location":"architecture/#key-features","title":"Key Features","text":"<ul> <li>RS256 asymmetric JWT encryption</li> <li>HTTP-only cookie sessions</li> <li>JWKS endpoint for key rotation</li> <li>Secure password hashing with Argon2</li> <li>User search functionality</li> </ul>"},{"location":"architecture/#events-published","title":"Events Published","text":"<ul> <li><code>user.signup</code> - When a new user registers</li> </ul>"},{"location":"architecture/#wallet-service","title":"\ud83d\udcb0 Wallet Service","text":"<p>Port: 4003 Database: <code>wallet_db</code></p>"},{"location":"architecture/#responsibilities_1","title":"Responsibilities","text":"<ul> <li>Wallet creation for new users</li> <li>Balance management</li> <li>Transaction application to wallets</li> <li>Wallet history tracking</li> <li>Balance integrity maintenance</li> </ul>"},{"location":"architecture/#tech-stack_1","title":"Tech Stack","text":"<ul> <li>Express.js - Web framework</li> <li>MongoDB/Mongoose - Database with optimistic locking</li> <li>RabbitMQ - Event consumption &amp; publishing</li> <li>Jose - JWT verification</li> <li>Prometheus - Metrics collection</li> </ul>"},{"location":"architecture/#key-features_1","title":"Key Features","text":"<ul> <li>Automatic wallet creation on user signup</li> <li>Optimistic locking for concurrent transactions</li> <li>Event-driven balance updates</li> <li>Automatic rollback on failed transactions</li> <li>Balance consistency guarantees</li> </ul>"},{"location":"architecture/#events-consumed","title":"Events Consumed","text":"<ul> <li><code>user.signup</code> - Creates wallet with initial balance</li> <li><code>transaction.completed</code> - Updates wallet balances</li> <li><code>transaction.failed</code> - Reverts wallet changes</li> </ul>"},{"location":"architecture/#events-published_1","title":"Events Published","text":"<ul> <li><code>wallet.transactionFinalized</code> - Confirms transaction completion</li> </ul>"},{"location":"architecture/#transactions-service","title":"\ud83d\udd01 Transactions Service","text":"<p>Port: 4004 Database: <code>transactions_db</code></p>"},{"location":"architecture/#responsibilities_2","title":"Responsibilities","text":"<ul> <li>Transaction creation (top-up, transfer)</li> <li>Transaction state management</li> <li>Transaction validation</li> <li>Transaction history</li> <li>Orchestrating transaction workflow</li> </ul>"},{"location":"architecture/#tech-stack_2","title":"Tech Stack","text":"<ul> <li>Express.js - Web framework</li> <li>MongoDB/Mongoose - Database</li> <li>Redis/IORedis - Caching layer</li> <li>RabbitMQ - Event consumption &amp; publishing</li> <li>Zod - Request validation</li> <li>Jose - JWT verification</li> <li>Prometheus - Metrics collection</li> <li>Swagger/OpenAPI - API documentation</li> </ul>"},{"location":"architecture/#key-features_2","title":"Key Features","text":"<ul> <li>Multi-state transaction lifecycle (PENDING \u2192 PROCESSING \u2192 COMPLETED/FAILED)</li> <li>Balance validation before transfers</li> <li>Idempotency support</li> <li>Event-driven workflow orchestration</li> <li>Automatic failure handling</li> </ul>"},{"location":"architecture/#transaction-types","title":"Transaction Types","text":"<ol> <li>Top-Up: Add funds to user wallet</li> <li>Transfer: Send funds between users</li> </ol>"},{"location":"architecture/#events-consumed_1","title":"Events Consumed","text":"<ul> <li><code>transaction.created</code> - Begins processing</li> <li><code>wallet.transactionFinalized</code> - Finalizes state</li> </ul>"},{"location":"architecture/#events-published_2","title":"Events Published","text":"<ul> <li><code>transaction.created</code> - Initiates workflow</li> <li><code>transaction.completed</code> - Success notification</li> <li><code>transaction.failed</code> - Failure notification</li> </ul>"},{"location":"architecture/#notifications-service","title":"\ud83d\udce8 Notifications Service","text":"<p>Port: 4002 Database: None (stateless)</p>"},{"location":"architecture/#responsibilities_3","title":"Responsibilities","text":"<ul> <li>Welcome email on user registration</li> <li>Transaction success notifications</li> <li>Transaction failure alerts</li> <li>Email template management</li> </ul>"},{"location":"architecture/#tech-stack_3","title":"Tech Stack","text":"<ul> <li>Express.js - Web framework</li> <li>RabbitMQ - Event consumption</li> <li>Nodemailer - Email sending</li> <li>Winston - Logging</li> </ul>"},{"location":"architecture/#key-features_3","title":"Key Features","text":"<ul> <li>Event-driven email delivery</li> <li>Template-based emails</li> <li>SMTP integration</li> <li>Async processing (doesn't block transactions)</li> </ul>"},{"location":"architecture/#events-consumed_2","title":"Events Consumed","text":"<ul> <li><code>user.signup</code> - Sends welcome email</li> <li><code>transaction.completed</code> - Sends success notification</li> <li><code>transaction.failed</code> - Sends failure alert</li> </ul>"},{"location":"architecture/#api-gateway-nginx","title":"\ud83d\udd17 API Gateway (NGINX)","text":"<p>Port: 80</p>"},{"location":"architecture/#responsibilities_4","title":"Responsibilities","text":"<ul> <li>Single entry point for all client requests</li> <li>Request routing to services</li> <li>Rate limiting</li> <li>Load balancing</li> <li>Health monitoring</li> </ul>"},{"location":"architecture/#key-features_4","title":"Key Features","text":"<ul> <li>Rate limiting: 10 req/s, burst 20</li> <li>Keepalive connections</li> <li>Automatic backend failover</li> <li>Health check monitoring</li> <li>Request/response buffering</li> <li>Graceful error handling</li> </ul>"},{"location":"architecture/#route-configuration","title":"Route Configuration","text":"<ul> <li><code>/api/v1/auth/*</code> \u2192 Auth Service (4001)</li> <li><code>/api/v1/users/*</code> \u2192 Auth Service (4001)</li> <li><code>/api/v1/wallet/*</code> \u2192 Wallet Service (4003)</li> <li><code>/api/v1/transactions/*</code> \u2192 Transactions Service (4004)</li> <li><code>/.well-known/*</code> \u2192 Auth Service (4001)</li> <li><code>/metrics/*</code> \u2192 Prometheus metrics endpoints</li> <li><code>/api-docs</code> \u2192 Swagger API documentation</li> <li><code>/health</code> \u2192 Gateway health check</li> </ul>"},{"location":"architecture/#redis-cache","title":"\u26a1 Redis Cache","text":"<p>Port: 6379</p>"},{"location":"architecture/#responsibilities_5","title":"Responsibilities","text":"<ul> <li>In-memory caching for frequently accessed data</li> <li>Reducing database load</li> <li>Improving API response times</li> <li>Session data storage (future)</li> </ul>"},{"location":"architecture/#tech-stack_4","title":"Tech Stack","text":"<ul> <li>Redis 7 - In-memory data store</li> <li>IORedis - Node.js Redis client</li> <li>AOF Persistence - Append-only file for durability</li> </ul>"},{"location":"architecture/#caching-strategy","title":"Caching Strategy","text":"<ul> <li>Pattern: Cache-aside (lazy loading)</li> <li>TTL: 5 minutes for user data, 3 minutes for transactions</li> <li>Key Structure: <code>&lt;service&gt;:&lt;resource&gt;:&lt;identifier&gt;</code></li> <li>Failure Mode: Graceful degradation to database</li> </ul>"},{"location":"architecture/#cached-data","title":"Cached Data","text":"<ul> <li>User Data (<code>auth:user:email:*</code>, <code>auth:user:exists:*</code>)</li> <li>Login lookups: 85% hit rate</li> <li>User existence checks: 80% hit rate</li> <li> <p>TTL: 5 minutes</p> </li> <li> <p>Transaction Lists (<code>transactions:list:*</code>)</p> </li> <li>Paginated queries: 80% hit rate</li> <li> <p>TTL: 3 minutes</p> </li> <li> <p>Transaction Details (<code>transactions:detail:*</code>)</p> </li> <li>Individual lookups: 75% hit rate</li> <li>TTL: 3 minutes</li> </ul>"},{"location":"architecture/#cache-invalidation","title":"Cache Invalidation","text":"<ul> <li>User Changes: Delete on signup</li> <li>Transaction Creation: Pattern delete on topup/transfer</li> <li>Manual: Flush via Redis CLI if needed</li> </ul>"},{"location":"architecture/#performance-impact","title":"Performance Impact","text":"<ul> <li>Before Caching: Login ~40ms, Transaction list ~80ms</li> <li>After Caching (hit): Login ~8ms, Transaction list ~12ms</li> <li>Improvement: 80-90% latency reduction on cache hits</li> </ul>"},{"location":"architecture/#prometheus","title":"\ud83d\udcca Prometheus","text":"<p>Port: 9090</p>"},{"location":"architecture/#responsibilities_6","title":"Responsibilities","text":"<ul> <li>Metrics collection from all services</li> <li>Time-series data storage</li> <li>Alerting rule evaluation</li> <li>PromQL query engine</li> <li>Target discovery and health monitoring</li> </ul>"},{"location":"architecture/#tech-stack_5","title":"Tech Stack","text":"<ul> <li>Prometheus - Metrics platform</li> <li>Prom-client - Node.js metrics library</li> <li>TSDB - Time-series database with 15-day retention</li> </ul>"},{"location":"architecture/#metrics-scraped","title":"Metrics Scraped","text":"<ul> <li>HTTP Metrics: Request duration, total requests, active connections</li> <li>Database Metrics: Query duration, operation counts</li> <li>Cache Metrics: Hit/miss rates, error counts</li> <li>Transaction Metrics: Creation rates, amount distribution</li> <li>System Metrics: CPU, memory, event loop lag, GC duration</li> </ul>"},{"location":"architecture/#scrape-configuration","title":"Scrape Configuration","text":"<ul> <li>Interval: 15 seconds</li> <li>Timeout: 10 seconds</li> <li>Targets: All service <code>/metrics</code> endpoints</li> <li>Storage: 15 days (configurable)</li> </ul>"},{"location":"architecture/#sample-metrics","title":"Sample Metrics","text":"<pre><code># API request rate\nrate(http_requests_total[5m])\n\n# P95 latency\nhistogram_quantile(0.95, http_request_duration_seconds_bucket)\n\n# Cache hit rate\nsum(rate(cache_hits_total[5m])) /\n(sum(rate(cache_hits_total[5m])) + sum(rate(cache_misses_total[5m])))\n\n# Database query time\nhistogram_quantile(0.95, db_query_duration_seconds_bucket)\n</code></pre>"},{"location":"architecture/#grafana","title":"\ud83d\udcc8 Grafana","text":"<p>Port: 3000 Default Credentials: admin/admin</p>"},{"location":"architecture/#responsibilities_7","title":"Responsibilities","text":"<ul> <li>Metrics visualization</li> <li>Dashboard creation and management</li> <li>Alerting and notifications</li> <li>Data source integration</li> <li>User management</li> </ul>"},{"location":"architecture/#key-features_5","title":"Key Features","text":"<ul> <li>Pre-configured Prometheus data source</li> <li>Custom dashboards for each service</li> <li>Real-time metric updates (30s refresh)</li> <li>Alert notifications (email, Slack, webhook)</li> <li>Dashboard provisioning via config files</li> </ul>"},{"location":"architecture/#pre-built-dashboards","title":"Pre-built Dashboards","text":"<ol> <li>Service Health Overview</li> <li>Uptime, error rates, active connections</li> <li>Request rate trends</li> <li> <p>Status code distribution</p> </li> <li> <p>Performance Metrics</p> </li> <li>API latency (P50, P95, P99)</li> <li>Database query times</li> <li>Cache hit rates</li> <li> <p>Event loop lag</p> </li> <li> <p>Cache Analytics</p> </li> <li>Hit/miss ratios by key prefix</li> <li>Cache operation errors</li> <li>Cache size trends</li> <li> <p>TTL effectiveness</p> </li> <li> <p>Transaction Analytics</p> </li> <li>Transaction creation rates</li> <li>Success vs failure ratios</li> <li>Amount distributions</li> <li> <p>Processing duration</p> </li> <li> <p>System Resources</p> </li> <li>Memory usage and GC patterns</li> <li>CPU utilization</li> <li>Active handles and requests</li> <li>Node.js metrics</li> </ol>"},{"location":"architecture/#dashboard-provisioning","title":"Dashboard Provisioning","text":"<pre><code># grafana/provisioning/datasources/prometheus.yml\napiVersion: 1\ndatasources:\n  - name: Prometheus\n    type: prometheus\n    url: http://prometheus:9090\n    isDefault: true\n\n# grafana/provisioning/dashboards/mint.json\n# Pre-configured dashboards loaded on startup\n</code></pre>"},{"location":"architecture/#loki","title":"\ud83d\udcdd Loki","text":"<p>Port: 3100</p>"},{"location":"architecture/#responsibilities_8","title":"Responsibilities","text":"<ul> <li>Centralized log aggregation and storage</li> <li>Log indexing and querying via LogQL</li> <li>Long-term log retention</li> <li>Integration with Grafana for visualization</li> <li>Multi-tenant log isolation (future)</li> </ul>"},{"location":"architecture/#tech-stack_6","title":"Tech Stack","text":"<ul> <li>Loki - Log aggregation system</li> <li>LogQL - Query language for logs</li> <li>Object Storage - Log chunk storage (filesystem in dev)</li> </ul>"},{"location":"architecture/#key-features_6","title":"Key Features","text":"<ul> <li>Efficient Storage: Indexes only metadata, not full log content</li> <li>LogQL Queries: Powerful query language similar to PromQL</li> <li>Label-based Indexing: Fast filtering by service, level, etc.</li> <li>Retention Policies: Configurable log retention periods</li> <li>Compression: Efficient log chunk compression</li> <li>No Schema: No predefined log schema required</li> </ul>"},{"location":"architecture/#log-storage","title":"Log Storage","text":"<ul> <li>Index: Label-based metadata (service, level, job)</li> <li>Chunks: Compressed log content</li> <li>Retention: 7 days default (configurable)</li> <li>Storage Backend: Filesystem (local), S3, GCS (production)</li> </ul>"},{"location":"architecture/#sample-logql-queries","title":"Sample LogQL Queries","text":"<pre><code># All logs from auth service\n{job=\"auth\"}\n\n# Error logs across all services\n{level=\"error\"}\n\n# Logs matching text pattern\n{job=\"transactions\"} |= \"payment\"\n\n# JSON parsing and filtering\n{job=\"auth\"} | json | userId=\"507f1f77bcf86cd799439011\"\n\n# Metric from logs (count)\nsum(rate({level=\"error\"}[5m])) by (job)\n\n# Top 10 error messages\ntopk(10, sum by(message) (rate({level=\"error\"}[1h])))\n</code></pre>"},{"location":"architecture/#grafana-alloy","title":"\ud83d\udd04 Grafana Alloy","text":"<p>Agent Type: Log Collection &amp; Forwarding</p>"},{"location":"architecture/#responsibilities_9","title":"Responsibilities","text":"<ul> <li>Collect logs from all microservices</li> <li>Parse and enrich log data</li> <li>Forward logs to Loki</li> <li>Add labels and metadata</li> <li>Filter and transform log streams</li> </ul>"},{"location":"architecture/#tech-stack_7","title":"Tech Stack","text":"<ul> <li>Grafana Alloy - Unified observability agent</li> <li>Loki Client - Log shipping to Loki</li> <li>Docker Logs Driver - Container log collection</li> </ul>"},{"location":"architecture/#log-collection-strategy","title":"Log Collection Strategy","text":"<ul> <li>Source: Docker container stdout/stderr</li> <li>Collection: Alloy reads from Docker socket</li> <li>Parsing: JSON log parsing with Winston format</li> <li>Enrichment: Adds job labels (service names)</li> <li>Delivery: Batched push to Loki</li> </ul>"},{"location":"architecture/#configuration","title":"Configuration","text":"<pre><code># alloy/config.alloy\nloki.source.docker \"containers\" {\n  host = \"unix:///var/run/docker.sock\"\n  targets = [\n    {\n      __path__ = \"/var/lib/docker/containers/*/*.log\",\n      job = \"docker\",\n    },\n  ]\n  forward_to = [loki.write.endpoint.receiver]\n}\n\nloki.write \"endpoint\" {\n  endpoint {\n    url = \"http://loki:3100/loki/api/v1/push\"\n  }\n}\n</code></pre>"},{"location":"architecture/#log-labels-applied","title":"Log Labels Applied","text":"<ul> <li>job: Service name (auth, wallet, transactions, notifications)</li> <li>container_name: Docker container name</li> <li>environment: dev/staging/production</li> <li>level: Log level (error, warn, info, debug)</li> </ul>"},{"location":"architecture/#communication-patterns_1","title":"Communication Patterns","text":""},{"location":"architecture/#1-synchronous-communication-rest-api","title":"1. Synchronous Communication (REST API)","text":"<p>Used for client-facing operations that require immediate responses.</p> <pre><code>Client \u2192 NGINX Gateway \u2192 Service \u2192 Response\n</code></pre> <p>Characteristics: - HTTP/REST protocol - Request-response pattern - Immediate feedback to client - Used for queries and commands</p> <p>Examples: - User login - Get wallet balance - Create transaction - Search users</p>"},{"location":"architecture/#2-asynchronous-communication-events","title":"2. Asynchronous Communication (Events)","text":"<p>Used for inter-service communication and decoupling.</p> <pre><code>Service \u2192 RabbitMQ \u2192 Consumer Service(s)\n</code></pre> <p>Characteristics: - Publish-subscribe pattern - Eventual consistency - Loose coupling - Resilient to service failures - Enables multiple consumers</p> <p>Examples: - User signup triggers wallet creation and welcome email - Transaction completion updates wallet and sends notification - Transaction failure triggers rollback</p>"},{"location":"architecture/#database-architecture","title":"Database Architecture","text":""},{"location":"architecture/#database-per-service-pattern","title":"Database per Service Pattern","text":"<p>Each service owns its data and database:</p> Service Database Collections Auth <code>auth_db</code> <code>users</code> Wallet <code>wallet_db</code> <code>wallets</code> Transactions <code>transactions_db</code> <code>transactions</code> Notifications None Stateless"},{"location":"architecture/#benefits","title":"Benefits","text":"<ul> <li>Loose coupling: Services are independent</li> <li>Technology flexibility: Each service can use appropriate database</li> <li>Scalability: Scale databases independently</li> <li>Fault isolation: Database issues don't cascade</li> </ul>"},{"location":"architecture/#challenges","title":"Challenges","text":"<ul> <li>Data consistency: Eventual consistency via events</li> <li>Joins: Cannot join across services (denormalization needed)</li> <li>Transactions: Distributed transactions require Saga pattern</li> </ul>"},{"location":"architecture/#data-consistency","title":"Data Consistency","text":"<p>The system uses eventual consistency through events:</p> <ol> <li>Optimistic Locking: Wallet service uses version fields</li> <li>Event Ordering: RabbitMQ preserves message order per queue</li> <li>Idempotency: Events can be replayed safely</li> <li>Compensation: Failed transactions trigger reversal events</li> </ol>"},{"location":"architecture/#security-architecture","title":"Security Architecture","text":""},{"location":"architecture/#authentication-flow","title":"Authentication Flow","text":"<pre><code>1. User \u2192 POST /api/v1/auth/signup\n2. Auth Service \u2192 Hash password with Argon2\n3. Auth Service \u2192 Store user in auth_db\n4. Auth Service \u2192 Publish user.signup event\n5. Auth Service \u2192 Return user info\n\nLogin:\n1. User \u2192 POST /api/v1/auth/login\n2. Auth Service \u2192 Verify password with Argon2\n3. Auth Service \u2192 Generate JWT (RS256)\n4. Auth Service \u2192 Set HTTP-only cookie\n5. Auth Service \u2192 Return user info\n</code></pre>"},{"location":"architecture/#authorization-flow","title":"Authorization Flow","text":"<pre><code>1. Client \u2192 Request with cookie\n2. NGINX \u2192 Forward to service\n3. Service \u2192 Extract JWT from cookie\n4. Service \u2192 Fetch public key from JWKS endpoint\n5. Service \u2192 Verify JWT signature\n6. Service \u2192 Validate issuer, audience, expiry\n7. Service \u2192 Extract user ID from claims\n8. Service \u2192 Process request\n</code></pre>"},{"location":"architecture/#security-features","title":"Security Features","text":"<ol> <li>Password Security</li> <li>Argon2 hashing (memory-hard, resistant to GPU attacks)</li> <li>No plaintext password storage</li> <li> <p>Secure random salts</p> </li> <li> <p>JWT Security</p> </li> <li>RS256 asymmetric encryption</li> <li>Private key only on auth service</li> <li>Public key distribution via JWKS</li> <li>Short expiration (7 days)</li> <li> <p>Issuer and audience validation</p> </li> <li> <p>Cookie Security</p> </li> <li>HTTP-only (no JavaScript access)</li> <li>Secure flag in production</li> <li>SameSite protection</li> <li> <p>Signed cookies</p> </li> <li> <p>API Security</p> </li> <li>Rate limiting at gateway</li> <li>Request validation with Zod</li> <li>Error messages don't leak info</li> <li>CORS configuration</li> </ol>"},{"location":"architecture/#scalability-considerations","title":"Scalability Considerations","text":""},{"location":"architecture/#horizontal-scaling","title":"Horizontal Scaling","text":"<p>Each service can be scaled independently:</p> <pre><code># docker-compose.yml\nauth:\n  replicas: 3  # Scale auth service\n\nwallet:\n  replicas: 5  # Scale wallet service more if needed\n</code></pre>"},{"location":"architecture/#database-scaling","title":"Database Scaling","text":"<ol> <li>Read Replicas: Add MongoDB replicas for read-heavy services</li> <li>Sharding: Shard by userId for large-scale deployments</li> <li>Caching: Add Redis for frequently accessed data (future)</li> </ol>"},{"location":"architecture/#message-queue-scaling","title":"Message Queue Scaling","text":"<ol> <li>Multiple Consumers: Scale consumers horizontally</li> <li>Queue Partitioning: Use routing keys for load distribution</li> <li>Dead Letter Queues: Handle failures gracefully (future)</li> </ol>"},{"location":"architecture/#load-balancing","title":"Load Balancing","text":"<p>NGINX provides: - Round-robin load balancing - Health check-based routing - Keepalive connection pooling - Automatic failover</p>"},{"location":"architecture/#bottlenecks-to-monitor","title":"Bottlenecks to Monitor","text":"<ol> <li>Database Connections: Monitor connection pool usage</li> <li>RabbitMQ Queue Depth: Watch for consumer lag</li> <li>JWT Verification: Cache JWKS keys</li> <li>Network I/O: Monitor service-to-service latency</li> </ol>"},{"location":"architecture/#system-qualities","title":"System Qualities","text":""},{"location":"architecture/#reliability","title":"Reliability","text":"<ul> <li>Automatic transaction rollback on failures</li> <li>Event replay capability</li> <li>Health monitoring for all services</li> <li>Graceful degradation</li> </ul>"},{"location":"architecture/#availability","title":"Availability","text":"<ul> <li>Stateless services (easy to replicate)</li> <li>No single point of failure (with scaling)</li> <li>Health checks and automatic restart</li> <li>Circuit breaker pattern (via NGINX retry)</li> </ul>"},{"location":"architecture/#maintainability","title":"Maintainability","text":"<ul> <li>Clear service boundaries</li> <li>Consistent code structure across services</li> <li>Comprehensive logging</li> <li>Type-safe with TypeScript</li> </ul>"},{"location":"architecture/#performance","title":"Performance","text":"<ul> <li>Async processing for non-critical paths</li> <li>Connection pooling</li> <li>Efficient database queries</li> <li>Rate limiting prevents overload</li> </ul>"},{"location":"architecture/#design-decisions","title":"Design Decisions","text":""},{"location":"architecture/#why-rabbitmq","title":"Why RabbitMQ?","text":"<ul> <li>Reliable message delivery</li> <li>Message persistence</li> <li>Flexible routing</li> <li>Wide ecosystem support</li> </ul>"},{"location":"architecture/#why-mongodb","title":"Why MongoDB?","text":"<ul> <li>Schema flexibility</li> <li>JSON-native (matches TypeScript objects)</li> <li>Good performance for read-heavy workloads</li> <li>Horizontal scaling support</li> </ul>"},{"location":"architecture/#why-rs256-jwt","title":"Why RS256 JWT?","text":"<ul> <li>More secure than HS256 (asymmetric)</li> <li>Public key can be distributed safely</li> <li>Enables key rotation</li> <li>Industry standard</li> </ul>"},{"location":"architecture/#why-nginx","title":"Why NGINX?","text":"<ul> <li>Battle-tested reverse proxy</li> <li>Excellent performance</li> <li>Built-in rate limiting</li> <li>Comprehensive configuration options</li> </ul>"},{"location":"architecture/#related-documentation","title":"Related Documentation","text":"<ul> <li>Event Architecture - Detailed event flows</li> <li>Deployment Guide - Production deployment</li> <li>Development Guide - Local development</li> <li>API Reference - API documentation</li> </ul>"},{"location":"deployment/","title":"Deployment Guide","text":""},{"location":"deployment/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Prerequisites</li> <li>Environment Setup</li> <li>JWT Keys Generation</li> <li>Docker Deployment</li> <li>Environment Configuration</li> <li>Service Ports</li> <li>Health Checks</li> <li>Production Considerations</li> <li>Scaling</li> </ul>"},{"location":"deployment/#prerequisites","title":"Prerequisites","text":"<p>Before deploying Mint, ensure you have the following installed:</p>"},{"location":"deployment/#required-software","title":"Required Software","text":"Software Minimum Version Purpose Docker 20.10+ Container runtime Docker Compose 2.0+ Multi-container orchestration Git 2.0+ Version control"},{"location":"deployment/#installation-links","title":"Installation Links","text":"<ul> <li>Docker: https://docs.docker.com/get-docker/</li> <li>Docker Compose: https://docs.docker.com/compose/install/</li> <li>Git: https://git-scm.com/downloads</li> </ul>"},{"location":"deployment/#system-requirements","title":"System Requirements","text":"<p>Minimum: - CPU: 2 cores - RAM: 4GB - Disk: 10GB</p> <p>Recommended: - CPU: 4+ cores - RAM: 8GB+ - Disk: 20GB+</p>"},{"location":"deployment/#environment-setup","title":"Environment Setup","text":""},{"location":"deployment/#1-clone-the-repository","title":"1. Clone the Repository","text":"<pre><code>git clone https://github.com/yourusername/mint.git\ncd mint\n</code></pre>"},{"location":"deployment/#2-create-environment-files","title":"2. Create Environment Files","text":"<p>Each service requires an <code>.env.docker</code> file. Create them from examples:</p> <pre><code># Auth Service\ncp auth/.env.example auth/.env.docker\n\n# Wallet Service\ncp wallet/.env.example wallet/.env.docker\n\n# Transactions Service\ncp transactions/.env.example transactions/.env.docker\n\n# Notifications Service\ncp notifications/.env.example notifications/.env.docker\n</code></pre>"},{"location":"deployment/#3-configure-environment-variables","title":"3. Configure Environment Variables","text":"<p>Edit each <code>.env.docker</code> file according to the Environment Configuration section below.</p>"},{"location":"deployment/#jwt-keys-generation","title":"JWT Keys Generation","text":"<p>The auth service requires RSA key pair for JWT signing.</p>"},{"location":"deployment/#generate-keys","title":"Generate Keys","text":"<pre><code>cd auth\nmkdir -p keys\ncd keys\n\n# Generate private key (2048-bit RSA)\nopenssl genrsa -out private_key.pem 2048\n\n# Extract public key\nopenssl rsa -in private_key.pem -pubout -out public_key.pem\n\ncd ../..\n</code></pre>"},{"location":"deployment/#verify-keys","title":"Verify Keys","text":"<pre><code># Check private key\nopenssl rsa -in auth/keys/private_key.pem -check\n\n# View public key\ncat auth/keys/public_key.pem\n</code></pre>"},{"location":"deployment/#key-security","title":"Key Security","text":"<p>Important: - Never commit <code>private_key.pem</code> to version control - Keep <code>private_key.pem</code> secure (only auth service needs it) - <code>public_key.pem</code> can be shared (distributed via JWKS endpoint) - Consider using secrets management in production (e.g., Vault, AWS Secrets Manager)</p>"},{"location":"deployment/#docker-deployment","title":"Docker Deployment","text":""},{"location":"deployment/#production-mode","title":"Production Mode","text":"<p>Start all services in production mode:</p> <pre><code>docker compose up --build\n</code></pre> <p>Features: - Optimized builds - No hot-reload - Production environment variables - Persistent volumes</p>"},{"location":"deployment/#development-mode","title":"Development Mode","text":"<p>Start with hot-reloading for development:</p> <pre><code>docker compose -f docker-compose.dev.yml up --build\n</code></pre> <p>Features: - Source code mounted as volumes - Hot-reload on file changes - Debug logging enabled - Development environment variables</p>"},{"location":"deployment/#run-in-background","title":"Run in Background","text":"<pre><code># Production\ndocker compose up -d --build\n\n# Development\ndocker compose -f docker-compose.dev.yml up -d --build\n</code></pre>"},{"location":"deployment/#stop-services","title":"Stop Services","text":"<pre><code># Stop containers (keeps data)\ndocker compose down\n\n# Stop and remove volumes (deletes data)\ndocker compose down -v\n</code></pre>"},{"location":"deployment/#view-logs","title":"View Logs","text":"<pre><code># All services\ndocker compose logs -f\n\n# Specific service\ndocker compose logs -f auth\n\n# Last 100 lines\ndocker compose logs --tail=100 wallet\n\n# Follow logs from a specific time\ndocker compose logs --since 10m transactions\n</code></pre>"},{"location":"deployment/#environment-configuration","title":"Environment Configuration","text":""},{"location":"deployment/#auth-service-envdocker","title":"Auth Service (<code>.env.docker</code>)","text":"<pre><code># Server\nPORT=4001\nNODE_ENV=production\n\n# Database\nDATABASE_URL=mongodb://root:example@mongodb:27017/auth_db?authSource=admin\n\n# RabbitMQ\nRABBITMQ_URL=amqp://guest:guest@rabbitmq:5672\n\n# JWT (RS256)\nJWT_PRIVATE_KEY_PATH=/app/keys/private_key.pem\nJWT_PUBLIC_KEY_PATH=/app/keys/public_key.pem\nJWT_ISSUER=mint-auth-service\nJWT_AUDIENCE=mint-api\nJWT_EXPIRES_IN=7d\n\n# Cookie\nCOOKIE_SECRET=CHANGE_THIS_IN_PRODUCTION_USE_LONG_RANDOM_STRING\nCOOKIE_NAME=mint_session\nCOOKIE_DOMAIN=localhost\nCOOKIE_MAX_AGE=604800000\n\n# CORS\nCORS_ORIGIN=http://localhost\n</code></pre> <p>Security Notes: - Change <code>COOKIE_SECRET</code> to a strong random string (32+ characters) - In production, set <code>COOKIE_DOMAIN</code> to your domain - Use HTTPS in production (update CORS_ORIGIN)</p>"},{"location":"deployment/#wallet-service-envdocker","title":"Wallet Service (<code>.env.docker</code>)","text":"<pre><code># Server\nPORT=4003\nNODE_ENV=production\n\n# Database\nDATABASE_URL=mongodb://root:example@mongodb:27017/wallet_db?authSource=admin\n\n# RabbitMQ\nRABBITMQ_URL=amqp://guest:guest@rabbitmq:5672\n\n# JWT\nJWT_ISSUER=mint-auth-service\nJWT_AUDIENCE=mint-api\nJWKS_URI=http://auth:4001/.well-known/jwks.json\n\n# Wallet Configuration\nINITIAL_WALLET_BALANCE=0\n</code></pre> <p>Configuration Options: - <code>INITIAL_WALLET_BALANCE</code>: Default balance for new wallets (e.g., promotional credit) - <code>JWKS_URI</code>: Must point to auth service JWKS endpoint</p>"},{"location":"deployment/#transactions-service-envdocker","title":"Transactions Service (<code>.env.docker</code>)","text":"<pre><code># Server\nPORT=4004\nNODE_ENV=production\n\n# Database\nDATABASE_URL=mongodb://root:example@mongodb:27017/transactions_db?authSource=admin\n\n# RabbitMQ\nRABBITMQ_URL=amqp://guest:guest@rabbitmq:5672\n\n# JWT\nJWT_ISSUER=mint-auth-service\nJWT_AUDIENCE=mint-api\nJWKS_URI=http://auth:4001/.well-known/jwks.json\n</code></pre>"},{"location":"deployment/#notifications-service-envdocker","title":"Notifications Service (<code>.env.docker</code>)","text":"<pre><code># Server\nPORT=4002\nNODE_ENV=production\n\n# RabbitMQ\nRABBITMQ_URL=amqp://guest:guest@rabbitmq:5672\n\n# Email (SMTP)\nSMTP_HOST=smtp.gmail.com\nSMTP_PORT=587\nSMTP_SECURE=false\nSMTP_USER=your-email@gmail.com\nSMTP_PASS=your-app-password\nEMAIL_FROM=noreply@mint.com\nEMAIL_FROM_NAME=Mint Wallet\n</code></pre> <p>Email Configuration:</p> <p>For Gmail: 1. Enable 2FA on your Google account 2. Generate App Password: https://myaccount.google.com/apppasswords 3. Use App Password as <code>SMTP_PASS</code></p> <p>For Other Providers: - SendGrid: <code>SMTP_HOST=smtp.sendgrid.net</code>, <code>SMTP_PORT=587</code> - Mailgun: <code>SMTP_HOST=smtp.mailgun.org</code>, <code>SMTP_PORT=587</code> - AWS SES: <code>SMTP_HOST=email-smtp.region.amazonaws.com</code>, <code>SMTP_PORT=587</code></p>"},{"location":"deployment/#service-ports","title":"Service Ports","text":""},{"location":"deployment/#internal-ports-container-to-container","title":"Internal Ports (Container-to-Container)","text":"Service Port Protocol Access Auth 4001 HTTP Internal Notifications 4002 HTTP Internal Wallet 4003 HTTP Internal Transactions 4004 HTTP Internal MongoDB 27017 TCP Internal RabbitMQ 5672 AMQP Internal"},{"location":"deployment/#external-ports-host-access","title":"External Ports (Host Access)","text":"Service Port Access Purpose NGINX Gateway 80 Public API Gateway RabbitMQ Management 15672 Admin Queue monitoring MongoDB 27017 Admin Database access"},{"location":"deployment/#port-mapping","title":"Port Mapping","text":"<p>In <code>docker-compose.yml</code>:</p> <pre><code>services:\n  nginx:\n    ports:\n      - \"80:80\"  # Gateway\n\n  rabbitmq:\n    ports:\n      - \"5672:5672\"    # AMQP\n      - \"15672:15672\"  # Management UI\n\n  mongodb:\n    ports:\n      - \"27017:27017\"  # Database\n</code></pre>"},{"location":"deployment/#changing-ports","title":"Changing Ports","text":"<p>To change the gateway port (e.g., avoid conflicts):</p> <pre><code>nginx:\n  ports:\n    - \"8080:80\"  # Access at http://localhost:8080\n</code></pre>"},{"location":"deployment/#health-checks","title":"Health Checks","text":""},{"location":"deployment/#verify-deployment","title":"Verify Deployment","text":"<p>After starting services, verify health:</p> <pre><code># Gateway health\ncurl http://localhost/health\n\n# Auth service\ncurl http://localhost/api/v1/auth/health\n\n# Check all containers\ndocker compose ps\n</code></pre> <p>Expected output: <pre><code>NAME                   STATUS\nmint-auth              Up (healthy)\nmint-wallet            Up (healthy)\nmint-transactions      Up (healthy)\nmint-notifications     Up (healthy)\nmint-mongodb           Up (healthy)\nmint-rabbitmq          Up (healthy)\nmint-nginx             Up (healthy)\n</code></pre></p>"},{"location":"deployment/#health-check-endpoints","title":"Health Check Endpoints","text":"Endpoint Service Returns <code>GET /health</code> Gateway Gateway status <code>GET /api/v1/auth/health</code> Auth Service health <code>GET /.well-known/jwks.json</code> Auth Public keys (also health indicator)"},{"location":"deployment/#troubleshooting-health-issues","title":"Troubleshooting Health Issues","text":"<p>If services are unhealthy:</p> <ol> <li>Check logs: <code>docker compose logs &lt;service&gt;</code></li> <li>Check environment: Verify <code>.env.docker</code> files</li> <li>Check dependencies: Ensure MongoDB and RabbitMQ are running</li> <li>Check ports: Ensure no port conflicts</li> <li>Restart: <code>docker compose restart &lt;service&gt;</code></li> </ol>"},{"location":"deployment/#production-considerations","title":"Production Considerations","text":""},{"location":"deployment/#security-hardening","title":"Security Hardening","text":""},{"location":"deployment/#1-environment-variables","title":"1. Environment Variables","text":"<pre><code># Change all defaults\nCOOKIE_SECRET=&lt;64-char-random-string&gt;\nMONGO_ROOT_PASSWORD=&lt;strong-password&gt;\nRABBITMQ_DEFAULT_USER=mint\nRABBITMQ_DEFAULT_PASS=&lt;strong-password&gt;\n</code></pre> <p>Generate secure secrets: <pre><code># Linux/Mac\nopenssl rand -hex 32\n\n# Or use Node.js\nnode -e \"console.log(require('crypto').randomBytes(32).toString('hex'))\"\n</code></pre></p>"},{"location":"deployment/#2-https-setup","title":"2. HTTPS Setup","text":"<p>Use a reverse proxy (Nginx, Traefik) with Let's Encrypt:</p> <pre><code># docker-compose.prod.yml\nnginx:\n  labels:\n    - \"traefik.enable=true\"\n    - \"traefik.http.routers.mint.rule=Host(`mint.yourdomain.com`)\"\n    - \"traefik.http.routers.mint.tls.certresolver=letsencrypt\"\n</code></pre>"},{"location":"deployment/#3-database-security","title":"3. Database Security","text":"<pre><code>mongodb:\n  environment:\n    MONGO_INITDB_ROOT_USERNAME: mint_admin\n    MONGO_INITDB_ROOT_PASSWORD: ${MONGO_PASSWORD}\n  volumes:\n    - mongodb_data:/data/db\n  networks:\n    - internal  # Isolate from public network\n</code></pre>"},{"location":"deployment/#4-network-isolation","title":"4. Network Isolation","text":"<pre><code>networks:\n  public:\n    # Gateway only\n  internal:\n    # All services\n    internal: true\n</code></pre>"},{"location":"deployment/#5-resource-limits","title":"5. Resource Limits","text":"<pre><code>auth:\n  deploy:\n    resources:\n      limits:\n        cpus: '1.0'\n        memory: 512M\n      reservations:\n        cpus: '0.5'\n        memory: 256M\n</code></pre>"},{"location":"deployment/#monitoring-logging","title":"Monitoring &amp; Logging","text":""},{"location":"deployment/#1-centralized-logging","title":"1. Centralized Logging","text":"<p>Use Docker logging drivers:</p> <pre><code>services:\n  auth:\n    logging:\n      driver: \"json-file\"\n      options:\n        max-size: \"10m\"\n        max-file: \"3\"\n</code></pre>"},{"location":"deployment/#2-health-monitoring","title":"2. Health Monitoring","text":"<p>Set up health check monitoring:</p> <pre><code>auth:\n  healthcheck:\n    test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:4001/api/v1/auth/health\"]\n    interval: 30s\n    timeout: 10s\n    retries: 3\n    start_period: 40s\n</code></pre>"},{"location":"deployment/#3-application-metrics","title":"3. Application Metrics","text":"<p>Install Prometheus exporters (future enhancement):</p> <pre><code>prometheus:\n  image: prom/prometheus\n  volumes:\n    - ./prometheus.yml:/etc/prometheus/prometheus.yml\n</code></pre>"},{"location":"deployment/#backup-strategy","title":"Backup Strategy","text":""},{"location":"deployment/#database-backups","title":"Database Backups","text":"<pre><code># Backup MongoDB\ndocker exec mint-mongodb mongodump \\\n  --uri=\"mongodb://root:example@localhost:27017\" \\\n  --out=/backup\n\n# Copy to host\ndocker cp mint-mongodb:/backup ./backups/$(date +%Y%m%d)\n</code></pre>"},{"location":"deployment/#automated-backups","title":"Automated Backups","text":"<pre><code>#!/bin/bash\n# backup.sh - Run via cron\n\nBACKUP_DIR=\"/backups/mint\"\nDATE=$(date +%Y%m%d-%H%M%S)\n\n# Backup all databases\ndocker exec mint-mongodb mongodump \\\n  --uri=\"mongodb://root:example@localhost:27017\" \\\n  --gzip \\\n  --archive=/backup/mint-${DATE}.gz\n\n# Copy to host\ndocker cp mint-mongodb:/backup/mint-${DATE}.gz ${BACKUP_DIR}/\n\n# Keep only last 7 days\nfind ${BACKUP_DIR} -name \"*.gz\" -mtime +7 -delete\n</code></pre>"},{"location":"deployment/#restore-from-backup","title":"Restore from Backup","text":"<pre><code># Copy backup to container\ndocker cp ./backups/mint-20250115.gz mint-mongodb:/backup/\n\n# Restore\ndocker exec mint-mongodb mongorestore \\\n  --uri=\"mongodb://root:example@localhost:27017\" \\\n  --gzip \\\n  --archive=/backup/mint-20250115.gz\n</code></pre>"},{"location":"deployment/#scaling","title":"Scaling","text":""},{"location":"deployment/#horizontal-scaling","title":"Horizontal Scaling","text":"<p>Scale individual services:</p> <pre><code># docker-compose.scale.yml\nservices:\n  auth:\n    deploy:\n      replicas: 3\n\n  wallet:\n    deploy:\n      replicas: 5\n\n  transactions:\n    deploy:\n      replicas: 3\n</code></pre> <p>Deploy with scaling:</p> <pre><code>docker compose -f docker-compose.yml -f docker-compose.scale.yml up -d\n</code></pre>"},{"location":"deployment/#load-balancing","title":"Load Balancing","text":"<p>NGINX automatically load balances across replicas:</p> <pre><code>upstream auth_backend {\n  server auth:4001 max_fails=3 fail_timeout=10s;\n  keepalive 32;\n}\n</code></pre>"},{"location":"deployment/#database-scaling","title":"Database Scaling","text":""},{"location":"deployment/#read-replicas","title":"Read Replicas","text":"<pre><code>mongodb-replica:\n  image: mongo:7\n  command: mongod --replSet rs0\n  depends_on:\n    - mongodb\n</code></pre>"},{"location":"deployment/#sharding","title":"Sharding","text":"<p>For large-scale deployments, implement MongoDB sharding:</p> <pre><code>mongos:\n  image: mongo:7\n  command: mongos --configdb configReplSet/config1:27019\n\nconfig1:\n  image: mongo:7\n  command: mongod --configsvr --replSet configReplSet\n\nshard1:\n  image: mongo:7\n  command: mongod --shardsvr --replSet shard1ReplSet\n</code></pre>"},{"location":"deployment/#docker-compose-files","title":"Docker Compose Files","text":""},{"location":"deployment/#production-docker-composeyml","title":"Production (<code>docker-compose.yml</code>)","text":"<ul> <li>Optimized builds</li> <li>Production environment</li> <li>Health checks enabled</li> <li>Resource limits</li> <li>Restart policies</li> </ul>"},{"location":"deployment/#development-docker-composedevyml","title":"Development (<code>docker-compose.dev.yml</code>)","text":"<ul> <li>Volume mounts for hot-reload</li> <li>Debug logging</li> <li>No resource limits</li> <li>Exposed ports for debugging</li> </ul>"},{"location":"deployment/#override-pattern","title":"Override Pattern","text":"<pre><code># Base + Production\ndocker compose up\n\n# Base + Development\ndocker compose -f docker-compose.yml -f docker-compose.dev.yml up\n\n# Base + Production + Scaling\ndocker compose -f docker-compose.yml -f docker-compose.scale.yml up\n</code></pre>"},{"location":"deployment/#useful-commands","title":"Useful Commands","text":"<pre><code># View running containers\ndocker compose ps\n\n# View resource usage\ndocker stats\n\n# Access service shell\ndocker exec -it mint-auth sh\n\n# Access MongoDB\ndocker exec -it mint-mongodb mongosh -u root -p example\n\n# Access RabbitMQ CLI\ndocker exec -it mint-rabbitmq rabbitmqctl list_queues\n\n# Rebuild specific service\ndocker compose up -d --build auth\n\n# Scale service\ndocker compose up -d --scale wallet=3\n\n# View service config\ndocker compose config\n\n# Remove everything (including volumes)\ndocker compose down -v --rmi all\n</code></pre>"},{"location":"deployment/#related-documentation","title":"Related Documentation","text":"<ul> <li>Architecture Overview - System design</li> <li>Development Guide - Local development</li> <li>Troubleshooting - Common issues</li> <li>API Documentation - API reference</li> </ul>"},{"location":"development/","title":"Development Guide","text":""},{"location":"development/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Local Development Setup</li> <li>Running Services</li> <li>Code Quality</li> <li>Database Management</li> <li>RabbitMQ Management</li> <li>Debugging</li> <li>Testing</li> <li>Common Workflows</li> </ul>"},{"location":"development/#local-development-setup","title":"Local Development Setup","text":""},{"location":"development/#prerequisites","title":"Prerequisites","text":"<ul> <li>Node.js 20.x or higher</li> <li>pnpm 8.x or higher (recommended) or npm</li> <li>Docker &amp; Docker Compose (for infrastructure)</li> </ul>"},{"location":"development/#installation","title":"Installation","text":""},{"location":"development/#1-install-nodejs","title":"1. Install Node.js","text":"<p>Download from nodejs.org or use nvm:</p> <pre><code># Using nvm (recommended)\nnvm install 20\nnvm use 20\n</code></pre>"},{"location":"development/#2-install-pnpm","title":"2. Install pnpm","text":"<pre><code>npm install -g pnpm\n</code></pre>"},{"location":"development/#3-clone-repository","title":"3. Clone Repository","text":"<pre><code>git clone https://github.com/yourusername/mint.git\ncd mint\n</code></pre>"},{"location":"development/#4-install-dependencies","title":"4. Install Dependencies","text":"<p>Install dependencies for all services:</p> <pre><code># Auth Service\ncd auth\npnpm install\ncd ..\n\n# Wallet Service\ncd wallet\npnpm install\ncd ..\n\n# Transactions Service\ncd transactions\npnpm install\ncd ..\n\n# Notifications Service\ncd notifications\npnpm install\ncd ..\n</code></pre> <p>Tip: Create a script to install all at once:</p> <pre><code>#!/bin/bash\n# install-all.sh\n\nfor service in auth wallet transactions notifications; do\n  echo \"Installing $service...\"\n  cd $service\n  pnpm install\n  cd ..\ndone\n</code></pre>"},{"location":"development/#5-setup-environment-files","title":"5. Setup Environment Files","text":"<pre><code># Copy example files\nfor service in auth wallet transactions notifications; do\n  cp $service/.env.example $service/.env.local\ndone\n</code></pre> <p>Edit <code>.env.local</code> files with local development settings:</p> <pre><code># Use localhost instead of Docker service names\nDATABASE_URL=mongodb://root:example@localhost:27017/auth_db?authSource=admin\nRABBITMQ_URL=amqp://guest:guest@localhost:5672\nJWKS_URI=http://localhost:4001/.well-known/jwks.json\n</code></pre>"},{"location":"development/#running-services","title":"Running Services","text":""},{"location":"development/#option-1-full-docker-recommended-for-quick-start","title":"Option 1: Full Docker (Recommended for Quick Start)","text":"<p>Run everything in Docker:</p> <pre><code>docker compose -f docker-compose.dev.yml up --build\n</code></pre> <p>Pros: - Everything configured and working - Hot-reload enabled - Consistent environment</p> <p>Cons: - Slower to restart services - Harder to debug</p>"},{"location":"development/#option-2-hybrid-infrastructure-in-docker-services-local","title":"Option 2: Hybrid (Infrastructure in Docker, Services Local)","text":"<p>Run infrastructure in Docker, services locally:</p>"},{"location":"development/#1-start-infrastructure","title":"1. Start Infrastructure","text":"<pre><code>docker compose up mongodb rabbitmq\n</code></pre>"},{"location":"development/#2-run-services-locally","title":"2. Run Services Locally","text":"<p>Open 4 terminals and run:</p> <pre><code># Terminal 1 - Auth Service\ncd auth\npnpm dev\n\n# Terminal 2 - Wallet Service\ncd wallet\npnpm dev\n\n# Terminal 3 - Transactions Service\ncd transactions\npnpm dev\n\n# Terminal 4 - Notifications Service\ncd notifications\npnpm dev\n</code></pre> <p>Pros: - Fast hot-reload - Easy debugging with breakpoints - Direct access to logs</p> <p>Cons: - More terminal windows - Manual service management</p>"},{"location":"development/#development-scripts","title":"Development Scripts","text":"<p>Each service has these scripts:</p> <pre><code># Development with hot-reload\npnpm dev\n\n# Build TypeScript\npnpm build\n\n# Run production build\npnpm start\n\n# Lint code\npnpm lint\n\n# Format code\npnpm format\n\n# Type check (without building)\npnpm type-check\n</code></pre>"},{"location":"development/#code-quality","title":"Code Quality","text":""},{"location":"development/#linting","title":"Linting","text":"<p>All services use ESLint with TypeScript rules:</p> <pre><code># Lint code\npnpm lint\n\n# Auto-fix issues\npnpm lint --fix\n</code></pre>"},{"location":"development/#formatting","title":"Formatting","text":"<p>Format code with Prettier:</p> <pre><code># Check formatting\npnpm format:check\n\n# Auto-format\npnpm format\n</code></pre>"},{"location":"development/#type-checking","title":"Type Checking","text":"<pre><code># Type check without building\npnpm type-check\n</code></pre>"},{"location":"development/#pre-commit-hook-optional","title":"Pre-commit Hook (Optional)","text":"<p>Install husky for automatic checks:</p> <pre><code># In project root\npnpm install -D husky lint-staged\n\n# Setup husky\nnpx husky install\n\n# Add pre-commit hook\nnpx husky add .husky/pre-commit \"pnpm lint-staged\"\n</code></pre> <p><code>.lintstagedrc.json</code>: <pre><code>{\n  \"*.{ts,tsx}\": [\n    \"eslint --fix\",\n    \"prettier --write\"\n  ]\n}\n</code></pre></p>"},{"location":"development/#database-management","title":"Database Management","text":""},{"location":"development/#access-mongodb","title":"Access MongoDB","text":""},{"location":"development/#via-docker","title":"Via Docker","text":"<pre><code>docker exec -it mint-mongodb mongosh -u root -p example\n</code></pre>"},{"location":"development/#via-local-client","title":"Via Local Client","text":"<pre><code>mongosh mongodb://root:example@localhost:27017\n</code></pre>"},{"location":"development/#common-mongodb-commands","title":"Common MongoDB Commands","text":"<pre><code>// List databases\nshow dbs\n\n// Switch to database\nuse auth_db\n\n// List collections\nshow collections\n\n// View users\ndb.users.find().pretty()\n\n// Find specific user\ndb.users.findOne({ email: \"john@example.com\" })\n\n// Update user\ndb.users.updateOne(\n  { email: \"john@example.com\" },\n  { $set: { name: \"John Updated\" } }\n)\n\n// Delete user\ndb.users.deleteOne({ email: \"test@example.com\" })\n\n// View wallets\nuse wallet_db\ndb.wallets.find().pretty()\n\n// View transactions\nuse transactions_db\ndb.transactions.find().pretty()\n</code></pre>"},{"location":"development/#reset-database","title":"Reset Database","text":"<pre><code># Stop services\ndocker compose down\n\n# Remove volumes (deletes all data)\ndocker compose down -v\n\n# Restart\ndocker compose up\n</code></pre>"},{"location":"development/#seed-test-data","title":"Seed Test Data","text":"<p>Create a seed script:</p> <pre><code>// scripts/seed.ts\nimport mongoose from 'mongoose';\nimport { User } from '../src/models/User';\n\nasync function seed() {\n  await mongoose.connect('mongodb://root:example@localhost:27017/auth_db?authSource=admin');\n\n  // Create test users\n  await User.create([\n    {\n      name: 'Alice',\n      email: 'alice@example.com',\n      password: 'password123' // Will be hashed by model\n    },\n    {\n      name: 'Bob',\n      email: 'bob@example.com',\n      password: 'password123'\n    }\n  ]);\n\n  console.log('Seed data created');\n  await mongoose.disconnect();\n}\n\nseed();\n</code></pre> <p>Run seed script: <pre><code>cd auth\nnpx tsx scripts/seed.ts\n</code></pre></p>"},{"location":"development/#rabbitmq-management","title":"RabbitMQ Management","text":""},{"location":"development/#access-management-ui","title":"Access Management UI","text":"<p>Open http://localhost:15672</p> <p>Credentials: - Username: <code>guest</code> - Password: <code>guest</code></p>"},{"location":"development/#management-ui-features","title":"Management UI Features","text":"<ol> <li>Queues: View queue depths, message rates</li> <li>Exchanges: View bindings and routing</li> <li>Connections: Active connections from services</li> <li>Channels: Open channels per connection</li> </ol>"},{"location":"development/#useful-operations","title":"Useful Operations","text":""},{"location":"development/#view-queue-messages","title":"View Queue Messages","text":"<ol> <li>Go to \"Queues\" tab</li> <li>Click on queue name</li> <li>Scroll to \"Get messages\"</li> <li>Click \"Get Message(s)\"</li> </ol>"},{"location":"development/#purge-queue","title":"Purge Queue","text":"<pre><code># Via UI: Queues \u2192 Queue Name \u2192 Purge\n\n# Via CLI\ndocker exec mint-rabbitmq rabbitmqadmin purge queue name=email.signup.q\n</code></pre>"},{"location":"development/#publish-test-message","title":"Publish Test Message","text":"<pre><code># Via CLI\ndocker exec mint-rabbitmq rabbitmqadmin publish \\\n  exchange=auth.events \\\n  routing_key=user.signup \\\n  payload='{\"userId\":\"123\",\"email\":\"test@example.com\"}'\n</code></pre>"},{"location":"development/#monitor-events","title":"Monitor Events","text":"<p>Watch RabbitMQ logs to see event flow:</p> <pre><code>docker compose logs -f rabbitmq\n</code></pre>"},{"location":"development/#debugging","title":"Debugging","text":""},{"location":"development/#vs-code-debug-configuration","title":"VS Code Debug Configuration","text":"<p><code>.vscode/launch.json</code>:</p> <pre><code>{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"name\": \"Debug Auth Service\",\n      \"type\": \"node\",\n      \"request\": \"launch\",\n      \"runtimeExecutable\": \"pnpm\",\n      \"runtimeArgs\": [\"dev\"],\n      \"cwd\": \"${workspaceFolder}/auth\",\n      \"skipFiles\": [\"&lt;node_internals&gt;/**\"],\n      \"envFile\": \"${workspaceFolder}/auth/.env.local\"\n    },\n    {\n      \"name\": \"Debug Wallet Service\",\n      \"type\": \"node\",\n      \"request\": \"launch\",\n      \"runtimeExecutable\": \"pnpm\",\n      \"runtimeArgs\": [\"dev\"],\n      \"cwd\": \"${workspaceFolder}/wallet\",\n      \"skipFiles\": [\"&lt;node_internals&gt;/**\"],\n      \"envFile\": \"${workspaceFolder}/wallet/.env.local\"\n    }\n  ]\n}\n</code></pre>"},{"location":"development/#debugging-tips","title":"Debugging Tips","text":""},{"location":"development/#1-add-breakpoints","title":"1. Add Breakpoints","text":"<p>In VS Code, click left of line number to add breakpoint.</p>"},{"location":"development/#2-console-logging","title":"2. Console Logging","text":"<pre><code>console.log('Variable value:', variable);\n\n// Better: Use logger\nimport { logger } from './utils/logger';\nlogger.debug('Debugging info', { variable });\n</code></pre>"},{"location":"development/#3-inspect-events","title":"3. Inspect Events","text":"<p>Log RabbitMQ events:</p> <pre><code>// In consumer\nchannel.consume(queue, async (msg) =&gt; {\n  const data = JSON.parse(msg.content.toString());\n  console.log('Received event:', data); // Debug log\n  await processEvent(data);\n});\n</code></pre>"},{"location":"development/#4-check-service-logs","title":"4. Check Service Logs","text":"<pre><code># All services\ndocker compose logs -f\n\n# Specific service\ndocker compose logs -f auth\n\n# Filter by error\ndocker compose logs | grep ERROR\n</code></pre>"},{"location":"development/#testing","title":"Testing","text":""},{"location":"development/#manual-api-testing","title":"Manual API Testing","text":""},{"location":"development/#using-curl","title":"Using cURL","text":"<pre><code># Register user\ncurl -X POST http://localhost/api/v1/auth/signup \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"Test User\",\n    \"email\": \"test@example.com\",\n    \"password\": \"password123\"\n  }'\n\n# Login\ncurl -X POST http://localhost/api/v1/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"test@example.com\",\n    \"password\": \"password123\"\n  }' \\\n  -c cookies.txt\n\n# Get wallet\ncurl http://localhost/api/v1/wallet/user -b cookies.txt\n\n# Top-up\ncurl -X POST http://localhost/api/v1/transactions/topup \\\n  -H \"Content-Type: application/json\" \\\n  -b cookies.txt \\\n  -d '{\"amount\": 100, \"description\": \"Test\"}'\n</code></pre>"},{"location":"development/#using-postman","title":"Using Postman","text":"<ol> <li>Import collection from <code>postman/mint-collection.json</code> (create if needed)</li> <li>Set environment variables</li> <li>Use saved requests</li> </ol>"},{"location":"development/#using-httpie","title":"Using httpie","text":"<pre><code># More readable than curl\nhttp POST localhost/api/v1/auth/signup \\\n  name=\"Test User\" \\\n  email=\"test@example.com\" \\\n  password=\"password123\"\n</code></pre>"},{"location":"development/#integration-testing","title":"Integration Testing","text":"<p>Run end-to-end flow:</p> <pre><code>#!/bin/bash\n# test-flow.sh\n\n# 1. Register\nRESPONSE=$(curl -s -X POST http://localhost/api/v1/auth/signup \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\":\"Test\",\"email\":\"test@example.com\",\"password\":\"pass123\"}')\n\necho \"Register: $RESPONSE\"\n\n# 2. Login\ncurl -s -X POST http://localhost/api/v1/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"email\":\"test@example.com\",\"password\":\"pass123\"}' \\\n  -c cookies.txt &gt; /dev/null\n\n# 3. Check wallet\nWALLET=$(curl -s http://localhost/api/v1/wallet/user -b cookies.txt)\necho \"Wallet: $WALLET\"\n\n# 4. Top-up\ncurl -s -X POST http://localhost/api/v1/transactions/topup \\\n  -H \"Content-Type: application/json\" \\\n  -b cookies.txt \\\n  -d '{\"amount\":100}' &gt; /dev/null\n\n# 5. Wait for processing\nsleep 2\n\n# 6. Check balance\nUPDATED=$(curl -s http://localhost/api/v1/wallet/user -b cookies.txt)\necho \"Updated wallet: $UPDATED\"\n</code></pre>"},{"location":"development/#common-workflows","title":"Common Workflows","text":""},{"location":"development/#adding-a-new-feature","title":"Adding a New Feature","text":"<ol> <li> <p>Create feature branch <pre><code>git checkout -b feature/new-feature\n</code></pre></p> </li> <li> <p>Make changes in appropriate service(s)</p> </li> <li> <p>Test locally <pre><code>pnpm dev\n# Test feature\n</code></pre></p> </li> <li> <p>Lint and format <pre><code>pnpm lint\npnpm format\n</code></pre></p> </li> <li> <p>Commit and push <pre><code>git add .\ngit commit -m \"feat: add new feature\"\ngit push origin feature/new-feature\n</code></pre></p> </li> </ol>"},{"location":"development/#adding-a-new-endpoint","title":"Adding a New Endpoint","text":"<ol> <li> <p>Define route in <code>src/routers/</code> <pre><code>router.get('/new-endpoint', authenticate, controller);\n</code></pre></p> </li> <li> <p>Create controller in <code>src/controllers/</code> <pre><code>export const controller = async (req, res) =&gt; {\n  // Implementation\n};\n</code></pre></p> </li> <li> <p>Add validation schema in <code>src/schemas/</code> <pre><code>export const schema = z.object({\n  field: z.string()\n});\n</code></pre></p> </li> <li> <p>Test endpoint <pre><code>curl http://localhost:4001/api/v1/new-endpoint\n</code></pre></p> </li> </ol>"},{"location":"development/#adding-a-new-event","title":"Adding a New Event","text":"<ol> <li> <p>Define event publisher in publishing service    <pre><code>await publishEvent('new.event', {\n  field1: 'value',\n  field2: 123\n});\n</code></pre></p> </li> <li> <p>Add consumer in consuming service    <pre><code>// src/consumers/newEventConsumer.ts\nexport async function consumeNewEvent(data) {\n  // Process event\n}\n</code></pre></p> </li> <li> <p>Register consumer in RabbitMQ setup    <pre><code>channel.consume('new.event.q', async (msg) =&gt; {\n  await consumeNewEvent(JSON.parse(msg.content.toString()));\n  channel.ack(msg);\n});\n</code></pre></p> </li> <li> <p>Test event flow</p> </li> <li>Trigger publisher</li> <li>Check RabbitMQ UI</li> <li>Verify consumer processes</li> </ol>"},{"location":"development/#fixing-a-bug","title":"Fixing a Bug","text":"<ol> <li> <p>Reproduce the bug locally</p> </li> <li> <p>Add debugging <pre><code>console.log('Debug info:', variable);\n</code></pre></p> </li> <li> <p>Identify root cause</p> </li> <li> <p>Fix and verify</p> </li> <li> <p>Add test to prevent regression</p> </li> </ol>"},{"location":"development/#project-structure","title":"Project Structure","text":""},{"location":"development/#service-structure","title":"Service Structure","text":"<pre><code>service/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 controllers/     # Request handlers\n\u2502   \u251c\u2500\u2500 middleware/      # Auth, error handling\n\u2502   \u251c\u2500\u2500 models/          # Database models\n\u2502   \u251c\u2500\u2500 routers/         # Express routes\n\u2502   \u251c\u2500\u2500 schemas/         # Zod validation\n\u2502   \u251c\u2500\u2500 services/        # Business logic\n\u2502   \u251c\u2500\u2500 utils/           # Helpers (logger, jwt)\n\u2502   \u251c\u2500\u2500 rabbitmq/        # RabbitMQ setup\n\u2502   \u251c\u2500\u2500 consumers/       # Event consumers (if applicable)\n\u2502   \u251c\u2500\u2500 app.ts           # Express app setup\n\u2502   \u251c\u2500\u2500 env.ts           # Environment validation\n\u2502   \u2514\u2500\u2500 server.ts        # Entry point\n\u251c\u2500\u2500 keys/                # JWT keys (auth only)\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 tsconfig.json\n\u2514\u2500\u2500 .env.example\n</code></pre>"},{"location":"development/#adding-new-files","title":"Adding New Files","text":"<p>Follow existing patterns:</p> <ul> <li>Controllers: Handle HTTP requests</li> <li>Services: Business logic</li> <li>Models: Database schemas</li> <li>Schemas: Input validation</li> <li>Utils: Shared utilities</li> </ul>"},{"location":"development/#useful-commands","title":"Useful Commands","text":""},{"location":"development/#docker","title":"Docker","text":"<pre><code># View logs\ndocker compose logs -f &lt;service&gt;\n\n# Restart service\ndocker compose restart &lt;service&gt;\n\n# Rebuild service\ndocker compose up -d --build &lt;service&gt;\n\n# Access service shell\ndocker exec -it mint-&lt;service&gt; sh\n</code></pre>"},{"location":"development/#database","title":"Database","text":"<pre><code># Access MongoDB\ndocker exec -it mint-mongodb mongosh -u root -p example\n\n# Backup database\ndocker exec mint-mongodb mongodump --uri=\"mongodb://root:example@localhost:27017\" --out=/backup\n\n# Restore database\ndocker exec mint-mongodb mongorestore --uri=\"mongodb://root:example@localhost:27017\" /backup\n</code></pre>"},{"location":"development/#rabbitmq","title":"RabbitMQ","text":"<pre><code># List queues\ndocker exec mint-rabbitmq rabbitmqctl list_queues\n\n# List exchanges\ndocker exec mint-rabbitmq rabbitmqctl list_exchanges\n\n# Purge queue\ndocker exec mint-rabbitmq rabbitmqadmin purge queue name=&lt;queue-name&gt;\n</code></pre>"},{"location":"development/#environment-variables-reference","title":"Environment Variables Reference","text":"<p>Create <code>.env.local</code> for each service with these settings:</p> <pre><code># Common (all services)\nNODE_ENV=development\nPORT=&lt;service-port&gt;\n\n# Database (auth, wallet, transactions)\nDATABASE_URL=mongodb://root:example@localhost:27017/&lt;db-name&gt;?authSource=admin\n\n# RabbitMQ (all services)\nRABBITMQ_URL=amqp://guest:guest@localhost:5672\n\n# JWT (wallet, transactions)\nJWT_ISSUER=mint-auth-service\nJWT_AUDIENCE=mint-api\nJWKS_URI=http://localhost:4001/.well-known/jwks.json\n\n# SMTP (notifications)\nSMTP_HOST=smtp.gmail.com\nSMTP_PORT=587\nSMTP_USER=your-email@gmail.com\nSMTP_PASS=your-app-password\n</code></pre>"},{"location":"development/#related-documentation","title":"Related Documentation","text":"<ul> <li>Architecture Overview - System design</li> <li>Deployment Guide - Production deployment</li> <li>API Documentation - API reference</li> <li>Troubleshooting - Common issues</li> </ul>"},{"location":"events/","title":"Event Architecture","text":""},{"location":"events/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Overview</li> <li>RabbitMQ Setup</li> <li>Exchanges</li> <li>Queues &amp; Bindings</li> <li>Event Schemas</li> <li>Event Flows</li> <li>Transaction Lifecycle</li> <li>Best Practices</li> </ul>"},{"location":"events/#overview","title":"Overview","text":"<p>Mint uses RabbitMQ as the message broker for asynchronous, event-driven communication between microservices. This enables loose coupling, scalability, and resilience.</p>"},{"location":"events/#key-benefits","title":"Key Benefits","text":"<ul> <li>Decoupling: Services don't need to know about each other</li> <li>Reliability: Messages are persisted until consumed</li> <li>Scalability: Multiple consumers can process events in parallel</li> <li>Resilience: Services can fail and recover without message loss</li> <li>Flexibility: Easy to add new consumers for existing events</li> </ul>"},{"location":"events/#messaging-pattern","title":"Messaging Pattern","text":"<p>The system uses Topic Exchanges with the publish-subscribe pattern:</p> <ol> <li>Publisher sends events to an exchange with a routing key</li> <li>Exchange routes messages to queues based on routing key patterns</li> <li>Consumer processes messages from queues</li> <li>Acknowledgment confirms successful processing</li> </ol>"},{"location":"events/#rabbitmq-setup","title":"RabbitMQ Setup","text":""},{"location":"events/#connection-configuration","title":"Connection Configuration","text":"<p>All services connect to RabbitMQ using:</p> <pre><code>RABBITMQ_URL=amqp://guest:guest@rabbitmq:5672\n</code></pre>"},{"location":"events/#management-ui","title":"Management UI","text":"<p>Access RabbitMQ Management interface: - URL: http://localhost:15672 - Username: <code>guest</code> - Password: <code>guest</code></p> <p>Features: - View exchanges, queues, and bindings - Monitor message rates - View message contents - Purge queues - Monitor connections and channels</p>"},{"location":"events/#exchanges","title":"Exchanges","text":"<p>The system uses two topic exchanges:</p>"},{"location":"events/#1-authevents","title":"1. <code>auth.events</code>","text":"<p>Type: Topic Durability: Durable (survives broker restart)</p> <p>Purpose: Authentication and user-related events</p> <p>Routing Keys: - <code>user.signup</code> - New user registration</p> <p>Publishers: - Auth Service</p> <p>Consumers: - Wallet Service (creates wallet) - Notifications Service (sends welcome email)</p>"},{"location":"events/#2-transactionevents","title":"2. <code>transaction.events</code>","text":"<p>Type: Topic Durability: Durable</p> <p>Purpose: Transaction lifecycle events</p> <p>Routing Keys: - <code>transaction.created</code> - New transaction initiated - <code>transaction.completed</code> - Transaction succeeded - <code>transaction.failed</code> - Transaction failed - <code>wallet.transactionFinalized</code> - Wallet updates completed</p> <p>Publishers: - Transactions Service - Wallet Service</p> <p>Consumers: - Transactions Service - Wallet Service - Notifications Service</p>"},{"location":"events/#queues-bindings","title":"Queues &amp; Bindings","text":""},{"location":"events/#queue-overview","title":"Queue Overview","text":"Queue Exchange Routing Key Consumer Description <code>email.signup.q</code> <code>auth.events</code> <code>user.signup</code> Notifications Welcome emails <code>wallet.user.q</code> <code>auth.events</code> <code>user.signup</code> Wallet Wallet creation <code>transaction.created.q</code> <code>transaction.events</code> <code>transaction.created</code> Transactions Transaction processing <code>wallet.update.q</code> <code>transaction.events</code> <code>transaction.completed</code> Wallet Balance updates <code>wallet.revert.q</code> <code>transaction.events</code> <code>transaction.failed</code> Wallet Rollback balances <code>email.transactionCompleted.q</code> <code>transaction.events</code> <code>transaction.completed</code> Notifications Success emails <code>email.transactionFailed.q</code> <code>transaction.events</code> <code>transaction.failed</code> Notifications Failure emails <code>transaction.finalized.q</code> <code>transaction.events</code> <code>wallet.transactionFinalized</code> Transactions Finalize state"},{"location":"events/#queue-properties","title":"Queue Properties","text":"<p>All queues are configured with: - Durable: <code>true</code> - Survives broker restart - Auto-delete: <code>false</code> - Persists even if no consumers - Message TTL: None - Messages never expire - Max Length: None - No size limit</p>"},{"location":"events/#event-schemas","title":"Event Schemas","text":""},{"location":"events/#1-usersignup","title":"1. user.signup","text":"<p>Published by: Auth Service Consumed by: Wallet Service, Notifications Service</p> <pre><code>{\n  userId: string;      // MongoDB ObjectId as string\n  name: string;        // User's full name\n  email: string;       // User's email address\n  createdAt: Date;     // ISO 8601 timestamp\n}\n</code></pre> <p>Example: <pre><code>{\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"name\": \"John Doe\",\n  \"email\": \"john@example.com\",\n  \"createdAt\": \"2025-01-15T10:30:00Z\"\n}\n</code></pre></p>"},{"location":"events/#2-transactioncreated","title":"2. transaction.created","text":"<p>Published by: Transactions Service Consumed by: Transactions Service (self-consumption)</p> <pre><code>{\n  transactionId: string;     // MongoDB ObjectId\n  type: 'topup' | 'transfer';\n  userId: string;            // Sender/initiator\n  recipientId?: string;      // For transfers only\n  amount: number;            // Transaction amount\n  description?: string;      // Optional description\n  createdAt: Date;\n}\n</code></pre> <p>Example (Top-up): <pre><code>{\n  \"transactionId\": \"507f1f77bcf86cd799439013\",\n  \"type\": \"topup\",\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"amount\": 100.00,\n  \"description\": \"Adding funds\",\n  \"createdAt\": \"2025-01-15T11:00:00Z\"\n}\n</code></pre></p> <p>Example (Transfer): <pre><code>{\n  \"transactionId\": \"507f1f77bcf86cd799439014\",\n  \"type\": \"transfer\",\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"recipientId\": \"507f1f77bcf86cd799439020\",\n  \"amount\": 50.00,\n  \"description\": \"Payment for services\",\n  \"createdAt\": \"2025-01-15T11:15:00Z\"\n}\n</code></pre></p>"},{"location":"events/#3-transactioncompleted","title":"3. transaction.completed","text":"<p>Published by: Transactions Service Consumed by: Wallet Service, Notifications Service</p> <pre><code>{\n  transactionId: string;\n  type: 'topup' | 'transfer';\n  userId: string;\n  recipientId?: string;\n  amount: number;\n  description?: string;\n  completedAt: Date;\n}\n</code></pre> <p>Example: <pre><code>{\n  \"transactionId\": \"507f1f77bcf86cd799439013\",\n  \"type\": \"topup\",\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"amount\": 100.00,\n  \"description\": \"Adding funds\",\n  \"completedAt\": \"2025-01-15T11:00:05Z\"\n}\n</code></pre></p>"},{"location":"events/#4-transactionfailed","title":"4. transaction.failed","text":"<p>Published by: Transactions Service Consumed by: Wallet Service, Notifications Service</p> <pre><code>{\n  transactionId: string;\n  type: 'topup' | 'transfer';\n  userId: string;\n  recipientId?: string;\n  amount: number;\n  reason: string;          // Failure reason\n  failedAt: Date;\n}\n</code></pre> <p>Example: <pre><code>{\n  \"transactionId\": \"507f1f77bcf86cd799439014\",\n  \"type\": \"transfer\",\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"recipientId\": \"507f1f77bcf86cd799439020\",\n  \"amount\": 50.00,\n  \"reason\": \"Insufficient balance\",\n  \"failedAt\": \"2025-01-15T11:15:03Z\"\n}\n</code></pre></p>"},{"location":"events/#5-wallettransactionfinalized","title":"5. wallet.transactionFinalized","text":"<p>Published by: Wallet Service Consumed by: Transactions Service</p> <pre><code>{\n  transactionId: string;\n  userId: string;\n  success: boolean;       // Whether wallet update succeeded\n  finalizedAt: Date;\n}\n</code></pre> <p>Example: <pre><code>{\n  \"transactionId\": \"507f1f77bcf86cd799439013\",\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"success\": true,\n  \"finalizedAt\": \"2025-01-15T11:00:06Z\"\n}\n</code></pre></p>"},{"location":"events/#event-flows","title":"Event Flows","text":""},{"location":"events/#user-registration-flow","title":"User Registration Flow","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant Auth\n    participant RabbitMQ\n    participant Wallet\n    participant Notifications\n\n    Client-&gt;&gt;Auth: POST /api/v1/auth/signup\n    Auth-&gt;&gt;Auth: Create user in auth_db\n    Auth-&gt;&gt;RabbitMQ: Publish user.signup\n    Auth-&gt;&gt;Client: Return user info\n\n    RabbitMQ-&gt;&gt;Wallet: Consume user.signup\n    Wallet-&gt;&gt;Wallet: Create wallet in wallet_db\n\n    RabbitMQ-&gt;&gt;Notifications: Consume user.signup\n    Notifications-&gt;&gt;Notifications: Send welcome email</code></pre> <p>Timeline: 1. User submits registration (0ms) 2. Auth creates user and returns (50ms) \u2705 User sees response 3. Wallet creates wallet (200ms) 4. Email sent (500ms)</p> <p>Benefits: User gets immediate feedback. Wallet and email happen asynchronously.</p>"},{"location":"events/#top-up-transaction-flow","title":"Top-Up Transaction Flow","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant Transactions\n    participant RabbitMQ\n    participant Wallet\n    participant Notifications\n\n    Client-&gt;&gt;Transactions: POST /transactions/topup\n    Transactions-&gt;&gt;Transactions: Create PENDING transaction\n    Transactions-&gt;&gt;RabbitMQ: Publish transaction.created\n    Transactions-&gt;&gt;Client: Return transaction ID\n\n    RabbitMQ-&gt;&gt;Transactions: Consume transaction.created\n    Transactions-&gt;&gt;Transactions: Update to PROCESSING\n    Transactions-&gt;&gt;RabbitMQ: Publish transaction.completed\n\n    RabbitMQ-&gt;&gt;Wallet: Consume transaction.completed\n    Wallet-&gt;&gt;Wallet: Update balance\n    Wallet-&gt;&gt;RabbitMQ: Publish wallet.transactionFinalized\n\n    RabbitMQ-&gt;&gt;Transactions: Consume wallet.transactionFinalized\n    Transactions-&gt;&gt;Transactions: Update to COMPLETED\n\n    RabbitMQ-&gt;&gt;Notifications: Consume transaction.completed\n    Notifications-&gt;&gt;Notifications: Send success email</code></pre> <p>States: 1. <code>PENDING</code> - Transaction created 2. <code>PROCESSING</code> - Being processed 3. <code>COMPLETED</code> - Successfully completed</p>"},{"location":"events/#transfer-transaction-flow-success","title":"Transfer Transaction Flow (Success)","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant Transactions\n    participant RabbitMQ\n    participant Wallet\n    participant Notifications\n\n    Client-&gt;&gt;Transactions: POST /transactions/transfer\n    Transactions-&gt;&gt;Transactions: Create PENDING transaction\n    Transactions-&gt;&gt;RabbitMQ: Publish transaction.created\n    Transactions-&gt;&gt;Client: Return transaction ID\n\n    RabbitMQ-&gt;&gt;Transactions: Consume transaction.created\n    Transactions-&gt;&gt;Transactions: Validate sender balance\n    Transactions-&gt;&gt;Transactions: Update to PROCESSING\n    Transactions-&gt;&gt;RabbitMQ: Publish transaction.completed\n\n    RabbitMQ-&gt;&gt;Wallet: Consume transaction.completed\n    Wallet-&gt;&gt;Wallet: Deduct from sender\n    Wallet-&gt;&gt;Wallet: Add to recipient\n    Wallet-&gt;&gt;RabbitMQ: Publish wallet.transactionFinalized\n\n    RabbitMQ-&gt;&gt;Transactions: Consume wallet.transactionFinalized\n    Transactions-&gt;&gt;Transactions: Update to COMPLETED\n\n    RabbitMQ-&gt;&gt;Notifications: Consume transaction.completed\n    Notifications-&gt;&gt;Notifications: Send success email</code></pre>"},{"location":"events/#transfer-transaction-flow-failure","title":"Transfer Transaction Flow (Failure)","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant Transactions\n    participant RabbitMQ\n    participant Wallet\n    participant Notifications\n\n    Client-&gt;&gt;Transactions: POST /transactions/transfer\n    Transactions-&gt;&gt;Transactions: Create PENDING transaction\n    Transactions-&gt;&gt;RabbitMQ: Publish transaction.created\n    Transactions-&gt;&gt;Client: Return transaction ID\n\n    RabbitMQ-&gt;&gt;Transactions: Consume transaction.created\n    Transactions-&gt;&gt;Transactions: Validate sender balance\n    Transactions-&gt;&gt;Transactions: Insufficient balance!\n    Transactions-&gt;&gt;RabbitMQ: Publish transaction.failed\n\n    RabbitMQ-&gt;&gt;Wallet: Consume transaction.failed\n    Wallet-&gt;&gt;Wallet: Revert any changes (if any)\n\n    Transactions-&gt;&gt;Transactions: Update to FAILED\n\n    RabbitMQ-&gt;&gt;Notifications: Consume transaction.failed\n    Notifications-&gt;&gt;Notifications: Send failure email</code></pre>"},{"location":"events/#transaction-lifecycle","title":"Transaction Lifecycle","text":""},{"location":"events/#state-transitions","title":"State Transitions","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 PENDING \u2502  Transaction created, queued for processing\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 PROCESSING \u2502  Being validated and processed\n\u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n      \u2502\n      \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n      \u2502              \u2502\n      \u25bc              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 COMPLETED \u2502  \u2502 FAILED  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"events/#processing-steps","title":"Processing Steps","text":"<ol> <li>Create Transaction (PENDING)</li> <li>Validate request</li> <li>Store in database</li> <li>Publish <code>transaction.created</code></li> <li> <p>Return to client</p> </li> <li> <p>Process Transaction (PROCESSING)</p> </li> <li>Validate business rules</li> <li>Check balances</li> <li>Determine success/failure</li> <li> <p>Publish <code>transaction.completed</code> or <code>transaction.failed</code></p> </li> <li> <p>Update Wallets</p> </li> <li>Apply balance changes</li> <li>Handle concurrency with optimistic locking</li> <li> <p>Publish <code>wallet.transactionFinalized</code></p> </li> <li> <p>Finalize Transaction (COMPLETED/FAILED)</p> </li> <li>Update final state</li> <li> <p>Store completion timestamp</p> </li> <li> <p>Notify User</p> </li> <li>Send email notification</li> <li>Log notification delivery</li> </ol>"},{"location":"events/#best-practices","title":"Best Practices","text":""},{"location":"events/#message-publishing","title":"Message Publishing","text":"<pre><code>// \u2705 Good: Include all necessary data\nawait publishEvent('transaction.completed', {\n  transactionId,\n  type,\n  userId,\n  recipientId,\n  amount,\n  description,\n  completedAt: new Date()\n});\n\n// \u274c Bad: Missing data, consumers need to query\nawait publishEvent('transaction.completed', {\n  transactionId\n});\n</code></pre>"},{"location":"events/#message-consumption","title":"Message Consumption","text":"<pre><code>// \u2705 Good: Acknowledge after successful processing\nchannel.consume(queue, async (msg) =&gt; {\n  try {\n    const data = JSON.parse(msg.content.toString());\n    await processEvent(data);\n    channel.ack(msg); // Only ack on success\n  } catch (error) {\n    channel.nack(msg, false, true); // Requeue on error\n  }\n});\n\n// \u274c Bad: Acknowledge immediately\nchannel.consume(queue, async (msg) =&gt; {\n  channel.ack(msg); // Message lost if processing fails!\n  await processEvent(msg);\n});\n</code></pre>"},{"location":"events/#idempotency","title":"Idempotency","text":"<p>Events may be delivered more than once. Make consumers idempotent:</p> <pre><code>// \u2705 Good: Check if already processed\nasync function createWallet(event: UserSignupEvent) {\n  const existing = await Wallet.findOne({ userId: event.userId });\n  if (existing) {\n    logger.info('Wallet already exists, skipping');\n    return; // Idempotent\n  }\n\n  await Wallet.create({\n    userId: event.userId,\n    balance: INITIAL_BALANCE\n  });\n}\n\n// \u274c Bad: Duplicate wallets possible\nasync function createWallet(event: UserSignupEvent) {\n  await Wallet.create({\n    userId: event.userId,\n    balance: INITIAL_BALANCE\n  }); // Will fail or create duplicate\n}\n</code></pre>"},{"location":"events/#error-handling","title":"Error Handling","text":"<pre><code>// \u2705 Good: Nack with requeue for transient errors\ntry {\n  await processEvent(data);\n  channel.ack(msg);\n} catch (error) {\n  if (isTransientError(error)) {\n    channel.nack(msg, false, true); // Requeue\n  } else {\n    channel.nack(msg, false, false); // Don't requeue\n    // Send to DLQ (future enhancement)\n  }\n}\n</code></pre>"},{"location":"events/#event-schema-versioning","title":"Event Schema Versioning","text":"<pre><code>// \u2705 Good: Include version for future compatibility\n{\n  version: '1.0',\n  transactionId: '...',\n  // ... other fields\n}\n\n// Future: Handle multiple versions\nif (event.version === '1.0') {\n  // Handle v1\n} else if (event.version === '2.0') {\n  // Handle v2\n}\n</code></pre>"},{"location":"events/#monitoring-debugging","title":"Monitoring &amp; Debugging","text":""},{"location":"events/#key-metrics-to-monitor","title":"Key Metrics to Monitor","text":"<ol> <li>Queue Depth: Messages waiting to be processed</li> <li>Consumer Rate: Messages processed per second</li> <li>Publish Rate: Messages published per second</li> <li>Unacked Messages: Messages awaiting acknowledgment</li> <li>Redelivery Rate: Messages being redelivered (possible errors)</li> </ol>"},{"location":"events/#rabbitmq-management-ui","title":"RabbitMQ Management UI","text":"<p>View real-time metrics:</p> <pre><code>open http://localhost:15672\n</code></pre> <p>Check: - Queues \u2192 Message rates - Exchanges \u2192 Incoming message rate - Connections \u2192 Active connections - Channels \u2192 Open channels</p>"},{"location":"events/#debugging-events","title":"Debugging Events","text":"<p>View messages in a queue (without consuming):</p> <ol> <li>Go to RabbitMQ Management UI</li> <li>Click on Queues</li> <li>Click on specific queue</li> <li>Scroll to \"Get messages\"</li> <li>Click \"Get Message(s)\"</li> </ol>"},{"location":"events/#purge-queue","title":"Purge Queue","text":"<p>To clear all messages (useful in development):</p> <pre><code># Via Management UI: Queues \u2192 &lt;queue-name&gt; \u2192 Purge\n\n# Or via CLI:\ndocker exec mint-rabbitmq rabbitmqadmin purge queue name=transaction.created.q\n</code></pre>"},{"location":"events/#future-enhancements","title":"Future Enhancements","text":""},{"location":"events/#dead-letter-queues-dlq","title":"Dead Letter Queues (DLQ)","text":"<p>Handle permanently failed messages:</p> <pre><code>// Messages that fail N times go to DLQ\nqueue.bind('transaction.events.dlq', 'transaction.failed');\n</code></pre>"},{"location":"events/#message-priority","title":"Message Priority","text":"<p>Prioritize critical transactions:</p> <pre><code>channel.publish(exchange, routingKey, Buffer.from(JSON.stringify(data)), {\n  priority: 5 // Higher priority\n});\n</code></pre>"},{"location":"events/#message-ttl","title":"Message TTL","text":"<p>Expire old messages:</p> <pre><code>channel.assertQueue(queue, {\n  messageTtl: 3600000 // 1 hour\n});\n</code></pre>"},{"location":"events/#event-replay","title":"Event Replay","text":"<p>Store events for replay/audit:</p> <pre><code>// Store all events in event_store collection\nawait EventStore.create({\n  eventType: 'user.signup',\n  payload: data,\n  publishedAt: new Date()\n});\n</code></pre>"},{"location":"events/#related-documentation","title":"Related Documentation","text":"<ul> <li>Architecture Overview - System architecture</li> <li>Transactions API - Transaction endpoints</li> <li>Wallet API - Wallet endpoints</li> <li>Troubleshooting - Common issues</li> </ul>"},{"location":"monitoring/","title":"Monitoring &amp; Observability","text":"<p>Mint includes a comprehensive observability stack with Prometheus for metrics collection and Grafana for visualization. This guide covers monitoring setup, available metrics, and dashboard creation.</p>"},{"location":"monitoring/#overview","title":"Overview","text":"<p>The monitoring stack consists of:</p> <ul> <li>Prometheus: Scrapes metrics from all services via <code>/metrics</code> endpoints</li> <li>Grafana: Provides real-time dashboards and alerting</li> <li>Prom-client: Node.js library for metrics instrumentation</li> <li>Redis: In-memory cache with performance metrics</li> </ul> <p> Real-time Grafana dashboard showing service metrics, cache performance, and system health</p>"},{"location":"monitoring/#quick-start","title":"Quick Start","text":""},{"location":"monitoring/#access-monitoring-tools","title":"Access Monitoring Tools","text":"<pre><code># Start all services including monitoring\ndocker compose up -d\n\n# Access Prometheus\nopen http://localhost:9090\n\n# Access Grafana\nopen http://localhost:3000\n# Login: admin/admin (default)\n</code></pre>"},{"location":"monitoring/#view-service-metrics","title":"View Service Metrics","text":"<p>Each service exposes metrics at <code>/metrics</code>:</p> <pre><code># Auth service metrics\ncurl http://localhost/metrics/auth\n\n# Wallet service metrics\ncurl http://localhost/metrics/wallet\n\n# Transactions service metrics\ncurl http://localhost/metrics/transactions\n\n# Notifications service metrics\ncurl http://localhost/metrics/notifications\n</code></pre>"},{"location":"monitoring/#metrics-categories","title":"Metrics Categories","text":""},{"location":"monitoring/#1-http-metrics","title":"1. HTTP Metrics","text":"<p>Request Duration (<code>http_request_duration_seconds</code>) - Histogram with buckets: [0.01, 0.05, 0.1, 0.5, 1, 2, 5] - Labels: <code>method</code>, <code>route</code>, <code>status_code</code> - Tracks API response times</p> <p>Total Requests (<code>http_requests_total</code>) - Counter tracking all HTTP requests - Labels: <code>method</code>, <code>route</code>, <code>status_code</code></p> <p>Active Connections (<code>active_connections</code>) - Gauge showing current concurrent connections - Increases on request start, decreases on completion</p>"},{"location":"monitoring/#2-database-metrics","title":"2. Database Metrics","text":"<p>Query Duration (<code>db_query_duration_seconds</code>) - Histogram for MongoDB operations - Labels: <code>operation</code> (find, create, update, delete), <code>collection</code> - Buckets: [0.001, 0.005, 0.01, 0.05, 0.1, 0.5, 1]</p> <p>Query Counts (implicit) - Derived from query duration histogram counts - Use <code>rate()</code> function in PromQL</p>"},{"location":"monitoring/#3-cache-metrics","title":"3. Cache Metrics","text":"<p>Cache Hits (<code>cache_hits_total</code>) - Counter for successful cache retrievals - Labels: <code>cache_key_prefix</code> (e.g., \"auth:user\", \"transactions:list\")</p> <p>Cache Misses (<code>cache_misses_total</code>) - Counter for cache misses requiring DB fetch - Labels: <code>cache_key_prefix</code></p> <p>Cache Errors (<code>cache_errors_total</code>) - Counter for cache operation failures - Labels: <code>operation</code> (get, set, delete, delete_pattern)</p> <p>Cache Hit Rate Calculation: <pre><code>sum(rate(cache_hits_total[5m])) /\n(sum(rate(cache_hits_total[5m])) + sum(rate(cache_misses_total[5m]))) * 100\n</code></pre></p>"},{"location":"monitoring/#4-transaction-specific-metrics","title":"4. Transaction-Specific Metrics","text":"<p>Transaction Counter (<code>transactions_total</code>) - Counter for created transactions - Labels: <code>type</code> (TopUp, Transfer), <code>status</code> (Pending, Completed, Failed)</p> <p>Transaction Amounts (<code>transaction_amount</code>) - Histogram of transaction amounts - Labels: <code>type</code> - Buckets: [1, 10, 50, 100, 500, 1000, 5000, 10000, 50000, 100000]</p> <p>Transaction Processing Duration (<code>transaction_processing_duration_seconds</code>) - Histogram for transaction processing time - Labels: <code>type</code>, <code>status</code> - Buckets: [0.1, 0.5, 1, 2, 5, 10]</p>"},{"location":"monitoring/#5-authentication-metrics","title":"5. Authentication Metrics","text":"<p>Auth Attempts (<code>auth_attempts_total</code>) - Counter for login attempts - Labels: <code>type</code> (login), <code>result</code> (success, failure)</p> <p>Signup Attempts (<code>signup_attempts_total</code>) - Counter for signup attempts - Labels: <code>result</code> (success, failure)</p>"},{"location":"monitoring/#6-system-metrics-default","title":"6. System Metrics (Default)","text":"<p>Collected automatically by <code>prom-client</code>:</p> <ul> <li>Process CPU (<code>process_cpu_user_seconds_total</code>, <code>process_cpu_system_seconds_total</code>)</li> <li>Memory Usage (<code>process_resident_memory_bytes</code>, <code>process_heap_bytes</code>)</li> <li>Event Loop Lag (<code>nodejs_eventloop_lag_seconds</code>)</li> <li>GC Duration (<code>nodejs_gc_duration_seconds</code>)</li> <li>Active Handles (<code>nodejs_active_handles_total</code>)</li> </ul>"},{"location":"monitoring/#grafana-dashboards","title":"Grafana Dashboards","text":""},{"location":"monitoring/#pre-configured-panels","title":"Pre-configured Panels","text":"<p>The default Grafana dashboard includes:</p> <ol> <li>Service Health Overview</li> <li>Uptime metrics</li> <li>Active connections</li> <li> <p>Error rates</p> </li> <li> <p>HTTP Performance</p> </li> <li>Request rate (req/s)</li> <li>P50, P95, P99 latencies</li> <li> <p>Status code distribution</p> </li> <li> <p>Cache Performance</p> </li> <li>Hit rate % by key prefix</li> <li>Total hits/misses</li> <li> <p>Cache errors</p> </li> <li> <p>Database Performance</p> </li> <li>Query duration by operation</li> <li>Slowest collections</li> <li> <p>Query rate</p> </li> <li> <p>Transaction Metrics</p> </li> <li>Transaction creation rate</li> <li>Success vs failure ratio</li> <li> <p>Amount distribution</p> </li> <li> <p>System Resources</p> </li> <li>Memory usage</li> <li>CPU utilization</li> <li>Event loop lag</li> </ol>"},{"location":"monitoring/#creating-custom-dashboards","title":"Creating Custom Dashboards","text":"<ol> <li> <p>Access Grafana:    <pre><code>open http://localhost:3000\n</code></pre></p> </li> <li> <p>Add Data Source (if not auto-configured):</p> </li> <li>Navigate to Configuration \u2192 Data Sources</li> <li> <p>Add Prometheus: <code>http://prometheus:9090</code></p> </li> <li> <p>Create Dashboard:</p> </li> <li>Click \"+\" \u2192 Dashboard</li> <li>Add Panel</li> <li> <p>Select metric and visualization</p> </li> <li> <p>Example Panel Queries:</p> </li> </ol> <p>API Request Rate:    <pre><code>sum(rate(http_requests_total[5m])) by (service)\n</code></pre></p> <p>P95 Latency:    <pre><code>histogram_quantile(0.95,\n  sum(rate(http_request_duration_seconds_bucket[5m])) by (le, service)\n)\n</code></pre></p> <p>Cache Hit Rate:    <pre><code>sum(rate(cache_hits_total[5m])) /\n(sum(rate(cache_hits_total[5m])) + sum(rate(cache_misses_total[5m]))) * 100\n</code></pre></p> <p>Top 5 Slowest Endpoints:    <pre><code>topk(5,\n  histogram_quantile(0.95,\n    sum(rate(http_request_duration_seconds_bucket[5m])) by (le, route)\n  )\n)\n</code></pre></p>"},{"location":"monitoring/#alerting","title":"Alerting","text":""},{"location":"monitoring/#prometheus-alerts","title":"Prometheus Alerts","text":"<p>Configure alerts in <code>prometheus/alerts.yml</code>:</p> <pre><code>groups:\n  - name: service_alerts\n    interval: 30s\n    rules:\n      - alert: HighErrorRate\n        expr: |\n          sum(rate(http_requests_total{status_code=~\"5..\"}[5m]))\n          / sum(rate(http_requests_total[5m])) &gt; 0.05\n        for: 5m\n        labels:\n          severity: critical\n        annotations:\n          summary: \"High error rate detected\"\n          description: \"Error rate is {{ $value }}%\"\n\n      - alert: LowCacheHitRate\n        expr: |\n          sum(rate(cache_hits_total[5m])) /\n          (sum(rate(cache_hits_total[5m])) + sum(rate(cache_misses_total[5m]))) &lt; 0.70\n        for: 10m\n        labels:\n          severity: warning\n        annotations:\n          summary: \"Cache hit rate below threshold\"\n          description: \"Hit rate is {{ $value }}%\"\n\n      - alert: SlowDatabaseQueries\n        expr: |\n          histogram_quantile(0.95,\n            sum(rate(db_query_duration_seconds_bucket[5m])) by (le, collection)\n          ) &gt; 1\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: \"Slow database queries detected\"\n          description: \"P95 query time is {{ $value }}s for {{ $labels.collection }}\"\n</code></pre>"},{"location":"monitoring/#grafana-alerts","title":"Grafana Alerts","text":"<ol> <li>Create Alert Rule:</li> <li>Edit panel \u2192 Alert tab</li> <li>Set condition (e.g., cache hit rate &lt; 70%)</li> <li> <p>Configure notification channel</p> </li> <li> <p>Notification Channels:</p> </li> <li>Email, Slack, PagerDuty, Webhook</li> <li>Configure in Alerting \u2192 Notification channels</li> </ol>"},{"location":"monitoring/#performance-benchmarks","title":"Performance Benchmarks","text":""},{"location":"monitoring/#expected-metrics","title":"Expected Metrics","text":"Metric Target Current API Response Time (P95) &lt; 100ms ~50ms API Response Time (P99) &lt; 200ms ~120ms Cache Hit Rate (User Data) &gt; 70% 85% Cache Hit Rate (Transactions) &gt; 60% 80% Database Query Time (P95) &lt; 50ms ~30ms Transaction Processing &lt; 2s ~1.2s Service Uptime &gt; 99.9% 99.95%"},{"location":"monitoring/#load-testing-results","title":"Load Testing Results","text":"<p>Using k6 for load testing:</p> <pre><code># Install k6\nbrew install k6  # macOS\n# or\nchoco install k6  # Windows\n\n# Run load test\nk6 run scripts/load-test.js\n</code></pre> <p>Results (100 VUs, 5 min): - Total Requests: 150,000 - Avg Response Time: 48ms - P95: 85ms - P99: 150ms - Error Rate: 0.02% - Throughput: 500 req/s</p>"},{"location":"monitoring/#troubleshooting","title":"Troubleshooting","text":""},{"location":"monitoring/#metrics-not-appearing","title":"Metrics Not Appearing","text":"<ol> <li> <p>Check service is running:    <pre><code>docker compose ps\n</code></pre></p> </li> <li> <p>Verify metrics endpoint:    <pre><code>curl http://localhost:4001/metrics  # Auth service\n</code></pre></p> </li> <li> <p>Check Prometheus targets:</p> </li> <li>Open http://localhost:9090/targets</li> <li> <p>All services should be \"UP\"</p> </li> <li> <p>Review Prometheus logs:    <pre><code>docker compose logs prometheus\n</code></pre></p> </li> </ol>"},{"location":"monitoring/#low-cache-hit-rate","title":"Low Cache Hit Rate","text":"<ol> <li>Check cache TTL settings:</li> <li>User data: 5 minutes</li> <li> <p>Transactions: 3 minutes</p> </li> <li> <p>Verify Redis is running:    <pre><code>docker compose ps redis\ndocker logs mint-redis\n</code></pre></p> </li> <li> <p>Monitor cache errors:    <pre><code>sum(rate(cache_errors_total[5m])) by (operation)\n</code></pre></p> </li> <li> <p>Check cache key distribution:    <pre><code>sum(cache_hits_total) by (cache_key_prefix)\nsum(cache_misses_total) by (cache_key_prefix)\n</code></pre></p> </li> </ol>"},{"location":"monitoring/#high-database-latency","title":"High Database Latency","text":"<ol> <li> <p>Identify slow queries:    <pre><code>topk(5,\n  histogram_quantile(0.95,\n    sum(rate(db_query_duration_seconds_bucket[5m])) by (le, collection, operation)\n  )\n)\n</code></pre></p> </li> <li> <p>Check MongoDB indexes:    <pre><code>docker exec -it mint-mongodb mongosh -u root -p example\nuse mint_txns\ndb.transactions.getIndexes()\n</code></pre></p> </li> <li> <p>Monitor connection pool:</p> </li> <li>Default pool size: 10</li> <li>Increase if seeing connection exhaustion</li> </ol>"},{"location":"monitoring/#memory-leaks","title":"Memory Leaks","text":"<ol> <li> <p>Monitor heap growth:    <pre><code>process_heap_bytes\n</code></pre></p> </li> <li> <p>Check event loop lag:    <pre><code>nodejs_eventloop_lag_seconds\n</code></pre></p> </li> <li> <p>Profile with Node.js:    <pre><code>docker exec -it mint-auth node --inspect\n</code></pre></p> </li> </ol>"},{"location":"monitoring/#best-practices","title":"Best Practices","text":""},{"location":"monitoring/#1-metric-naming","title":"1. Metric Naming","text":"<ul> <li>Use snake_case: <code>http_request_duration_seconds</code></li> <li>Include unit suffix: <code>_seconds</code>, <code>_bytes</code>, <code>_total</code></li> <li>Use descriptive names: <code>cache_hits_total</code> not <code>hits</code></li> </ul>"},{"location":"monitoring/#2-label-cardinality","title":"2. Label Cardinality","text":"<ul> <li>Keep labels low cardinality (&lt;100 unique values)</li> <li>Avoid user IDs, timestamps, UUIDs as labels</li> <li>Use aggregation for high-cardinality data</li> </ul>"},{"location":"monitoring/#3-dashboard-design","title":"3. Dashboard Design","text":"<ul> <li>Group related metrics</li> <li>Use consistent time ranges</li> <li>Add annotations for deployments</li> <li>Set reasonable refresh intervals (30s-1m)</li> </ul>"},{"location":"monitoring/#4-alert-fatigue","title":"4. Alert Fatigue","text":"<ul> <li>Set appropriate thresholds</li> <li>Use <code>for:</code> clause to avoid flapping</li> <li>Group related alerts</li> <li>Include runbooks in annotations</li> </ul>"},{"location":"monitoring/#advanced-configuration","title":"Advanced Configuration","text":""},{"location":"monitoring/#custom-metrics","title":"Custom Metrics","text":"<p>Add custom metrics in your service:</p> <pre><code>import { Counter, Histogram } from 'prom-client';\n\n// Custom counter\nconst customCounter = new Counter({\n  name: 'custom_events_total',\n  help: 'Total custom events',\n  labelNames: ['event_type'],\n  registers: [register],\n});\n\n// Increment\ncustomCounter.inc({ event_type: 'user_action' });\n\n// Custom histogram\nconst customHistogram = new Histogram({\n  name: 'custom_duration_seconds',\n  help: 'Custom operation duration',\n  buckets: [0.1, 0.5, 1, 2, 5],\n  registers: [register],\n});\n\n// Observe\nconst timer = customHistogram.startTimer();\nawait doSomething();\ntimer();\n</code></pre>"},{"location":"monitoring/#metric-persistence","title":"Metric Persistence","text":"<p>Prometheus stores data for 15 days by default. To extend:</p> <pre><code># docker-compose.yml\nprometheus:\n  command:\n    - '--storage.tsdb.retention.time=30d'\n</code></pre>"},{"location":"monitoring/#grafana-provisioning","title":"Grafana Provisioning","text":"<p>Auto-configure dashboards and data sources:</p> <pre><code># grafana/provisioning/datasources/prometheus.yml\napiVersion: 1\ndatasources:\n  - name: Prometheus\n    type: prometheus\n    access: proxy\n    url: http://prometheus:9090\n    isDefault: true\n\n# grafana/provisioning/dashboards/dashboard.yml\napiVersion: 1\nproviders:\n  - name: 'Mint Dashboards'\n    folder: 'Mint'\n    type: file\n    options:\n      path: /etc/grafana/provisioning/dashboards\n</code></pre>"},{"location":"monitoring/#logging","title":"Logging","text":"<p>Mint implements centralized logging using Loki for log aggregation, Grafana Alloy for log collection, and Winston for structured logging in all services.</p> <p> Centralized log aggregation in Grafana with Loki, showing structured JSON logs with filtering and search</p>"},{"location":"monitoring/#logging-stack","title":"Logging Stack","text":"<p>Winston (Application Layer): - Structured JSON logging format - Multiple log levels: error, warn, info, debug - Contextual metadata (service, version, userId, etc.) - Console and file transports</p> <p>Grafana Alloy (Collection Layer): - Collects logs from Docker containers - Parses JSON log format - Adds labels (service name, container, environment) - Forwards to Loki</p> <p>Loki (Storage &amp; Query Layer): - Stores logs with label-based indexing - LogQL query language - Efficient compression - 7-day retention (configurable)</p> <p>Grafana (Visualization Layer): - Log exploration interface - LogQL query builder - Live log tailing - Log context and correlation with metrics</p>"},{"location":"monitoring/#log-structure","title":"Log Structure","text":"<p>All services produce structured JSON logs:</p> <pre><code>{\n  \"level\": \"info\",\n  \"message\": \"User login successful\",\n  \"service\": \"@mint/auth\",\n  \"version\": \"0.0.1\",\n  \"timestamp\": \"2025-12-31T12:00:00.000Z\",\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"method\": \"POST\",\n  \"url\": \"/api/v1/auth/login\",\n  \"statusCode\": 200,\n  \"duration\": 45\n}\n</code></pre> <p>Standard Fields: - <code>level</code>: Log level (error, warn, info, debug) - <code>message</code>: Human-readable message - <code>service</code>: Service identifier - <code>version</code>: Service version - <code>timestamp</code>: ISO 8601 timestamp</p> <p>Contextual Fields (varies by service): - <code>userId</code>: User identifier - <code>transactionId</code>: Transaction identifier - <code>method</code>: HTTP method - <code>url</code>: Request URL - <code>statusCode</code>: HTTP status code - <code>duration</code>: Request duration in ms - <code>error</code>: Error details (stack trace, message)</p>"},{"location":"monitoring/#accessing-logs","title":"Accessing Logs","text":"<ol> <li> <p>Via Grafana:    <pre><code>open http://localhost:3000\n# Navigate to Explore \u2192 Select Loki data source\n</code></pre></p> </li> <li> <p>Direct Loki API:    <pre><code># Query logs\ncurl -G http://localhost:3100/loki/api/v1/query \\\n  --data-urlencode 'query={job=\"auth\"}' \\\n  --data-urlencode 'limit=100'\n</code></pre></p> </li> <li> <p>Docker Logs (fallback):    <pre><code>docker logs mint-auth-dev --tail 100 --follow\n</code></pre></p> </li> </ol>"},{"location":"monitoring/#logql-query-examples","title":"LogQL Query Examples","text":""},{"location":"monitoring/#basic-queries","title":"Basic Queries","text":"<pre><code># All logs from auth service\n{job=\"auth\"}\n\n# All error logs\n{level=\"error\"}\n\n# Logs from multiple services\n{job=~\"auth|wallet|transactions\"}\n\n# Logs in time range\n{job=\"auth\"}[5m]\n</code></pre>"},{"location":"monitoring/#text-filtering","title":"Text Filtering","text":"<pre><code># Logs containing \"login\"\n{job=\"auth\"} |= \"login\"\n\n# Logs NOT containing \"health\"\n{job=\"auth\"} != \"health\"\n\n# Regex match\n{job=\"auth\"} |~ \"login|signup\"\n\n# Case-insensitive\n{job=\"auth\"} |~ `(?i)error`\n</code></pre>"},{"location":"monitoring/#json-parsing","title":"JSON Parsing","text":"<pre><code># Parse JSON and filter by field\n{job=\"auth\"} | json | userId=\"507f1f77bcf86cd799439011\"\n\n# Filter by status code\n{job=\"auth\"} | json | statusCode &gt;= 400\n\n# Multiple conditions\n{job=\"auth\"} | json | level=\"error\" | statusCode &gt;= 500\n</code></pre>"},{"location":"monitoring/#metrics-from-logs","title":"Metrics from Logs","text":"<pre><code># Count error logs per service\nsum(count_over_time({level=\"error\"}[5m])) by (job)\n\n# Rate of requests per service\nrate({job=~\"auth|transactions\"}[1m])\n\n# P95 latency from logs\nquantile_over_time(0.95, {job=\"auth\"} | json | unwrap duration [5m]) by (job)\n\n# Top 10 error messages\ntopk(10, sum by(message) (count_over_time({level=\"error\"}[1h])))\n</code></pre>"},{"location":"monitoring/#log-levels","title":"Log Levels","text":"Level Usage Examples error Errors requiring attention Failed transactions, authentication errors, DB connection failures warn Warnings that may need investigation Deprecated API usage, high response times, retry attempts info Important events User signups, transaction creation, successful payments debug Detailed debugging info Function entry/exit, variable values, flow control"},{"location":"monitoring/#best-practices_1","title":"Best Practices","text":""},{"location":"monitoring/#1-use-structured-logging","title":"1. Use Structured Logging","text":"<p>\u2705 Good: <pre><code>logger.info('User login successful', {\n  userId: user.id,\n  method: req.method,\n  duration: Date.now() - start\n});\n</code></pre></p> <p>\u274c Bad: <pre><code>console.log(`User ${user.id} logged in`);\n</code></pre></p>"},{"location":"monitoring/#2-include-contextual-information","title":"2. Include Contextual Information","text":"<p>Always include: - Request ID for tracing - User ID for user actions - Transaction ID for financial operations - Duration for performance tracking</p>"},{"location":"monitoring/#3-appropriate-log-levels","title":"3. Appropriate Log Levels","text":"<pre><code>// Error - Something failed\nlogger.error('Failed to create transaction', { error, transactionId });\n\n// Warn - Potential issues\nlogger.warn('High response time detected', { duration, threshold });\n\n// Info - Important events\nlogger.info('Transaction completed', { transactionId, amount });\n\n// Debug - Detailed debugging\nlogger.debug('Validating transaction', { transactionId, rules });\n</code></pre>"},{"location":"monitoring/#4-avoid-logging-sensitive-data","title":"4. Avoid Logging Sensitive Data","text":"<p>Never log: - Passwords or password hashes - Credit card numbers - API keys or secrets - Full JWT tokens - Personal identifiable information (PII)</p> <p>Use redaction: <pre><code>logger.info('User created', {\n  email: user.email.replace(/(?&lt;=.{2}).(?=.*@)/g, '*'),\n  // email: 'jo***@example.com'\n});\n</code></pre></p>"},{"location":"monitoring/#log-retention","title":"Log Retention","text":"Environment Retention Period Compression Development 7 days Enabled Staging 14 days Enabled Production 30 days Enabled <p>Adjust in <code>loki/config.yml</code>:</p> <pre><code>limits_config:\n  retention_period: 720h  # 30 days\n</code></pre>"},{"location":"monitoring/#troubleshooting-logs","title":"Troubleshooting Logs","text":""},{"location":"monitoring/#no-logs-appearing","title":"No Logs Appearing","text":"<ol> <li> <p>Check Alloy is running:    <pre><code>docker compose ps alloy\ndocker logs mint-alloy\n</code></pre></p> </li> <li> <p>Verify Loki connection:    <pre><code>curl http://localhost:3100/ready\n</code></pre></p> </li> <li> <p>Check service logs are JSON:    <pre><code>docker logs mint-auth-dev --tail 10\n# Should see JSON formatted logs\n</code></pre></p> </li> <li> <p>Verify Grafana data source:</p> </li> <li>Navigate to Configuration \u2192 Data Sources</li> <li>Test Loki connection</li> </ol>"},{"location":"monitoring/#logs-not-parseable","title":"Logs Not Parseable","text":"<p>If logs appear as plain text instead of parsed JSON:</p> <ol> <li> <p>Check Winston format:    <pre><code>format: winston.format.combine(\n  winston.format.timestamp(),\n  winston.format.json()  // Must be JSON\n)\n</code></pre></p> </li> <li> <p>Verify Alloy parsing:    Check <code>alloy/config.alloy</code> has JSON parser enabled</p> </li> </ol>"},{"location":"monitoring/#high-log-volume","title":"High Log Volume","text":"<p>If experiencing performance issues due to high log volume:</p> <ol> <li> <p>Increase debug log filtering:    <pre><code>const logger = winston.createLogger({\n  level: process.env.LOG_LEVEL || 'info'  // Filter debug logs\n});\n</code></pre></p> </li> <li> <p>Add sampling for high-frequency logs:    <pre><code>if (Math.random() &lt; 0.1) {  // 10% sampling\n  logger.debug('Detailed debug info');\n}\n</code></pre></p> </li> <li> <p>Reduce retention period in Loki config</p> </li> </ol>"},{"location":"monitoring/#related-documentation","title":"Related Documentation","text":"<ul> <li>Architecture Overview</li> <li>Service Documentation</li> <li>Deployment Guide</li> <li>Troubleshooting</li> </ul>"},{"location":"monitoring/#next-steps","title":"Next Steps","text":"<ol> <li>Explore Dashboards: Access Grafana and explore pre-built panels</li> <li>Query Logs: Practice LogQL queries in Grafana Explore</li> <li>Set Up Alerts: Configure alerts for critical metrics and error logs</li> <li>Create Custom Dashboards: Build dashboards for your specific needs</li> <li>Integrate with CI/CD: Add metric checks to deployment pipelines</li> <li>Load Test: Run k6 tests to validate performance under load</li> <li>Log Correlation: Link logs to traces (future: distributed tracing)</li> </ol>"},{"location":"testing/","title":"Testing Guide","text":"<p>This guide covers the testing infrastructure for the Mint microservices wallet system.</p>"},{"location":"testing/#overview","title":"Overview","text":"<p>Mint includes 112 comprehensive tests using Vitest as the testing framework with Supertest for API integration testing. Each service has its own test suite including:</p> <ul> <li>Unit Tests (59): Testing individual functions and services in isolation</li> <li>Integration Tests (45): Testing API endpoints end-to-end</li> <li>Consumer Tests (8): Testing RabbitMQ event handlers</li> <li>Database Tests: Using MongoDB Memory Server for isolated database testing</li> <li>Mock Testing: RabbitMQ and external dependencies are mocked</li> </ul> <p>All tests passing | CI/CD integrated with GitHub Actions</p>"},{"location":"testing/#test-stack","title":"Test Stack","text":"<ul> <li>Vitest: Fast, modern test framework with excellent TypeScript support</li> <li>Supertest: HTTP assertion library for API testing</li> <li>MongoDB Memory Server: In-memory MongoDB for isolated testing</li> <li>Vitest UI: Interactive test UI for development</li> <li>V8 Coverage: Built-in code coverage reports</li> </ul>"},{"location":"testing/#running-tests","title":"Running Tests","text":""},{"location":"testing/#run-all-tests-across-all-services","title":"Run all tests across all services","text":"<pre><code>pnpm test\n</code></pre>"},{"location":"testing/#run-tests-for-a-specific-service","title":"Run tests for a specific service","text":"<pre><code># Auth service\npnpm test:auth\n\n# Wallet service\npnpm test:wallet\n\n# Transactions service\npnpm test:transactions\n\n# Notifications service\npnpm test:notifications\n</code></pre>"},{"location":"testing/#run-tests-in-watch-mode","title":"Run tests in watch mode","text":"<pre><code># All services (runs in parallel)\npnpm test:watch\n\n# Single service\ncd auth\npnpm test:watch\n</code></pre>"},{"location":"testing/#run-tests-with-coverage","title":"Run tests with coverage","text":"<pre><code># All services\npnpm test:coverage\n\n# Single service\ncd auth\npnpm test:coverage\n</code></pre>"},{"location":"testing/#run-tests-with-ui","title":"Run tests with UI","text":"<pre><code>cd auth\npnpm test:ui\n</code></pre>"},{"location":"testing/#test-structure","title":"Test Structure","text":"<p>Each service follows a consistent test structure:</p> <pre><code>src/\n\u251c\u2500\u2500 __tests__/\n\u2502   \u251c\u2500\u2500 setup.ts              # Global test setup (MongoDB, mocks)\n\u2502   \u251c\u2500\u2500 helpers/\n\u2502   \u2502   \u251c\u2500\u2500 test-helpers.ts   # Utility functions for creating test data\n\u2502   \u2502   \u2514\u2500\u2500 mock-rabbitmq.ts  # RabbitMQ mocks\n\u2502   \u251c\u2500\u2500 unit/                 # Unit tests\n\u2502   \u2502   \u251c\u2500\u2500 *.service.test.ts\n\u2502   \u2502   \u2514\u2500\u2500 *.model.test.ts\n\u2502   \u2514\u2500\u2500 integration/          # Integration/API tests\n\u2502       \u2514\u2500\u2500 *.api.test.ts\n\u2514\u2500\u2500 ... (application code)\n</code></pre>"},{"location":"testing/#writing-tests","title":"Writing Tests","text":""},{"location":"testing/#unit-test-example","title":"Unit Test Example","text":"<pre><code>import { describe, it, expect } from \"vitest\";\nimport * as authService from \"~/services/auth.service\";\nimport { createTestUser } from \"../helpers/test-helpers\";\n\ndescribe(\"Auth Service\", () =&gt; {\n  describe(\"login\", () =&gt; {\n    it(\"should login user with correct credentials\", async () =&gt; {\n      await createTestUser({\n        email: \"test@example.com\",\n        password: \"password123\",\n      });\n\n      const result = await authService.login({\n        email: \"test@example.com\",\n        password: \"password123\",\n      });\n\n      expect(result).toHaveProperty(\"id\");\n      expect(result.email).toBe(\"test@example.com\");\n    });\n  });\n});\n</code></pre>"},{"location":"testing/#integration-test-example","title":"Integration Test Example","text":"<pre><code>import { describe, it, expect, vi } from \"vitest\";\nimport request from \"supertest\";\nimport { app } from \"~/app\";\n\n// Mock RabbitMQ\nvi.mock(\"~/rabbitmq/publisher\", () =&gt; ({\n  publishEvent: vi.fn().mockResolvedValue(undefined),\n}));\n\ndescribe(\"Auth API\", () =&gt; {\n  it(\"should register a new user\", async () =&gt; {\n    const response = await request(app)\n      .post(\"/api/v1/auth/signup\")\n      .send({\n        firstName: \"John\",\n        lastName: \"Doe\",\n        email: \"john@example.com\",\n        password: \"password123\",\n      })\n      .expect(201);\n\n    expect(response.body).toHaveProperty(\"user\");\n    expect(response.body).toHaveProperty(\"accessToken\");\n  });\n});\n</code></pre>"},{"location":"testing/#test-environment","title":"Test Environment","text":""},{"location":"testing/#environment-configuration","title":"Environment Configuration","text":"<p>Each service has a <code>.env.test</code> file with test-specific configuration:</p> <pre><code>NODE_ENV=test\nPORT=4001\nDATABASE_URL=mongodb://localhost:27017/mint-auth-test\nRABBITMQ_URL=amqp://localhost:5672\nJWT_ISS=mint-auth\nJWT_AUD=mint-services\nJWKS_ENDPOINT=http://localhost:4001/.well-known/jwks.json\n</code></pre> <p>Note: Database URL is overridden by MongoDB Memory Server in tests, so actual MongoDB connection is not required.</p>"},{"location":"testing/#jwt-keys-for-testing","title":"JWT Keys for Testing","text":"<p>The auth service automatically generates RSA key pairs for JWT signing during test setup:</p> <pre><code>// auth/src/__tests__/setup.ts\nfunction ensureJWTKeys() {\n  const keysDir = path.join(__dirname, \"..\", \"..\", \"keys\");\n  const publicKeyPath = path.join(keysDir, \"public.pem\");\n  const privateKeyPath = path.join(keysDir, \"private.pem\");\n\n  if (!fs.existsSync(publicKeyPath) || !fs.existsSync(privateKeyPath)) {\n    const { publicKey, privateKey } = generateKeyPairSync(\"rsa\", {\n      modulusLength: 2048,\n      publicKeyEncoding: { type: \"spki\", format: \"pem\" },\n      privateKeyEncoding: { type: \"pkcs8\", format: \"pem\" },\n    });\n\n    fs.writeFileSync(publicKeyPath, publicKey);\n    fs.writeFileSync(privateKeyPath, privateKey);\n  }\n}\n</code></pre> <p>This ensures JWT functionality works in tests without committing sensitive keys to version control. Keys are gitignored (<code>**/keys/*.pem</code>).</p>"},{"location":"testing/#mocking-external-dependencies","title":"Mocking External Dependencies","text":""},{"location":"testing/#rabbitmq","title":"RabbitMQ","text":"<p>RabbitMQ is mocked in all tests to prevent actual message publishing:</p> <pre><code>vi.mock(\"~/rabbitmq/publisher\", () =&gt; ({\n  publishEvent: vi.fn().mockResolvedValue(undefined),\n}));\n</code></pre>"},{"location":"testing/#email-service-notifications","title":"Email Service (Notifications)","text":"<p>The nodemailer transport is mocked:</p> <pre><code>vi.mock(\"~/utils/mail\", () =&gt; ({\n  mailer: {\n    sendMail: vi.fn().mockResolvedValue({\n      messageId: \"test-message-id\",\n      accepted: [\"test@example.com\"],\n    }),\n  },\n}));\n</code></pre>"},{"location":"testing/#coverage-reports","title":"Coverage Reports","text":"<p>Coverage reports are generated in the <code>coverage/</code> directory of each service:</p> <ul> <li><code>coverage/index.html</code>: Interactive HTML coverage report</li> <li><code>coverage/coverage-final.json</code>: JSON coverage data</li> <li>Console output shows coverage summary</li> </ul>"},{"location":"testing/#coverage-metrics","title":"Coverage Metrics","text":"<p>Current test coverage across all services:</p> Service Tests Coverage Details Auth 35 59.31% User authentication, JWT, password hashing Wallet 20 50.25% Balance operations, transactions, event handlers Transactions 44 63.41% Transaction lifecycle, state management, validation Notifications 13 15.91% Email service, consumer handlers Total 112 - All passing \u2713 <p>Coverage Breakdown by Test Type: - Unit Tests: 59 tests (models, services, utilities) - Integration Tests: 45 tests (API endpoints, full request/response) - Consumer Tests: 8 tests (RabbitMQ event handlers)</p>"},{"location":"testing/#coverage-exclusions","title":"Coverage Exclusions","text":"<p>The following are excluded from coverage:</p> <ul> <li><code>node_modules/</code></li> <li><code>src/__tests__/</code></li> <li><code>*.config.ts</code></li> <li><code>*.d.ts</code></li> <li>Type definition files</li> <li>Infrastructure code (server startup, RabbitMQ bootstrap)</li> </ul>"},{"location":"testing/#continuous-integration","title":"Continuous Integration","text":"<p>Tests run automatically on every push via GitHub Actions. See <code>.github/workflows/test.yml</code> for CI configuration.</p>"},{"location":"testing/#test-coverage-details","title":"Test Coverage Details","text":""},{"location":"testing/#auth-service-35-tests","title":"Auth Service (35 tests)","text":"<ul> <li>Unit Tests: User model validation, password hashing, JWT generation</li> <li>Integration Tests: Signup, login, logout, token refresh, JWKS endpoint</li> <li>Security Tests: Rate limiting, invalid credentials, duplicate email</li> <li>Features: Auto-generated RSA keys for JWT signing in test environment</li> </ul>"},{"location":"testing/#wallet-service-20-tests","title":"Wallet Service (20 tests)","text":"<ul> <li>Unit Tests (15): Wallet creation, balance updates, transaction processing</li> <li>Integration Tests (5): Get wallet, balance queries, user authorization</li> <li>Features: MongoDB Memory Server for isolated testing</li> </ul>"},{"location":"testing/#transactions-service-44-tests","title":"Transactions Service (44 tests)","text":"<ul> <li>Unit Tests (27): Transaction model, service layer, validation logic</li> <li>Transaction creation (TopUp, Transfer)</li> <li>Self-transfer validation</li> <li>Transaction state management</li> <li>Event publishing</li> <li>Integration Tests (17): Full API endpoint testing</li> <li>TopUp/Transfer creation</li> <li>Transaction listing with pagination</li> <li>Transaction retrieval and authorization</li> <li>Input validation and error handling</li> </ul>"},{"location":"testing/#notifications-service-13-tests","title":"Notifications Service (13 tests)","text":"<ul> <li>Unit Tests (7): Email service, consumer handlers</li> <li>Integration Tests (6): Email sending for various events</li> <li>Features: Nodemailer mocking, event-driven testing</li> </ul>"},{"location":"testing/#best-practices","title":"Best Practices","text":"<ol> <li>Test Isolation: Each test should be independent and not rely on other tests</li> <li>Clean State: Database is cleared after each test via <code>afterEach</code> hooks in setup.ts</li> <li>Descriptive Names: Use clear, descriptive test names that explain what's being tested</li> <li>Arrange-Act-Assert: Follow the AAA pattern in tests</li> <li>Mock External Services: Always mock RabbitMQ, email services, and external APIs</li> <li>Test Both Success and Failure: Include tests for error cases, validation failures, and edge cases</li> <li>Use Type Safety: Leverage TypeScript for type-safe test data</li> <li>Coverage Goals: Aim for 60%+ overall coverage, 100% for critical business logic</li> <li>Integration &gt; Unit: Prefer integration tests for APIs to ensure full request/response cycle</li> <li>Mock Authentication: Use helper functions to mock JWT middleware in integration tests</li> </ol>"},{"location":"testing/#troubleshooting","title":"Troubleshooting","text":""},{"location":"testing/#mongodb-memory-server-issues","title":"MongoDB Memory Server Issues","text":"<p>If MongoDB Memory Server fails to download:</p> <pre><code># Set download mirror\nexport MONGOMS_DOWNLOAD_MIRROR=https://fastdl.mongodb.org\n</code></pre>"},{"location":"testing/#port-conflicts","title":"Port Conflicts","text":"<p>If you see EADDRINUSE errors, ensure no services are running on test ports (4001-4004).</p>"},{"location":"testing/#timeout-errors","title":"Timeout Errors","text":"<p>Tests have a 30-second timeout. If tests are timing out:</p> <ul> <li>Check for unresolved promises</li> <li>Ensure async operations use <code>await</code></li> <li>Verify MongoDB Memory Server is starting correctly</li> </ul>"},{"location":"testing/#additional-resources","title":"Additional Resources","text":"<ul> <li>Vitest Documentation</li> <li>Supertest Documentation</li> <li>MongoDB Memory Server</li> </ul>"},{"location":"troubleshooting/","title":"Troubleshooting Guide","text":""},{"location":"troubleshooting/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Services Won't Start</li> <li>Database Issues</li> <li>RabbitMQ Connection Issues</li> <li>Authentication Problems</li> <li>Transaction Issues</li> <li>Wallet Issues</li> <li>Network &amp; Port Conflicts</li> <li>Performance Issues</li> <li>Docker Issues</li> <li>General Debugging</li> </ul>"},{"location":"troubleshooting/#services-wont-start","title":"Services Won't Start","text":""},{"location":"troubleshooting/#problem-container-exits-immediately","title":"Problem: Container exits immediately","text":"<p>Symptoms: <pre><code>$ docker compose ps\nNAME           STATUS\nmint-auth      Exited (1)\n</code></pre></p> <p>Diagnosis: <pre><code>docker compose logs auth\n</code></pre></p> <p>Common Causes &amp; Solutions:</p>"},{"location":"troubleshooting/#1-missing-environment-variables","title":"1. Missing Environment Variables","text":"<p>Error: <pre><code>Error: DATABASE_URL is required\n</code></pre></p> <p>Solution: <pre><code># Check .env.docker exists\nls auth/.env.docker\n\n# Verify required variables\ncat auth/.env.docker | grep DATABASE_URL\n</code></pre></p>"},{"location":"troubleshooting/#2-invalid-database-url","title":"2. Invalid Database URL","text":"<p>Error: <pre><code>MongoServerError: Authentication failed\n</code></pre></p> <p>Solution: <pre><code># Ensure correct format in .env.docker\nDATABASE_URL=mongodb://root:example@mongodb:27017/auth_db?authSource=admin\n#                     ^^^^        ^^^^^ Must match docker-compose.yml\n</code></pre></p>"},{"location":"troubleshooting/#3-missing-jwt-keys","title":"3. Missing JWT Keys","text":"<p>Error: <pre><code>Error: ENOENT: no such file or directory, open '/app/keys/private_key.pem'\n</code></pre></p> <p>Solution: <pre><code>cd auth\nmkdir -p keys\ncd keys\nopenssl genrsa -out private_key.pem 2048\nopenssl rsa -in private_key.pem -pubout -out public_key.pem\n</code></pre></p>"},{"location":"troubleshooting/#4-port-already-in-use","title":"4. Port Already in Use","text":"<p>Error: <pre><code>Error: bind: address already in use\n</code></pre></p> <p>Solution: <pre><code># Find process using port\nlsof -i :4001  # or netstat -ano | findstr :4001 on Windows\n\n# Kill process or change port in docker-compose.yml\n</code></pre></p>"},{"location":"troubleshooting/#database-issues","title":"Database Issues","text":""},{"location":"troubleshooting/#problem-cannot-connect-to-mongodb","title":"Problem: Cannot connect to MongoDB","text":"<p>Symptoms: - Services exit with connection errors - \"MongoServerError: Authentication failed\" - \"ECONNREFUSED 127.0.0.1:27017\"</p> <p>Diagnosis: <pre><code># Check MongoDB is running\ndocker compose ps mongodb\n\n# Check MongoDB logs\ndocker compose logs mongodb\n\n# Try connecting manually\ndocker exec -it mint-mongodb mongosh -u root -p example\n</code></pre></p> <p>Solutions:</p>"},{"location":"troubleshooting/#mongodb-not-started","title":"MongoDB Not Started","text":"<pre><code># Start MongoDB\ndocker compose up mongodb -d\n\n# Wait for it to be healthy\ndocker compose ps | grep mongodb\n</code></pre>"},{"location":"troubleshooting/#wrong-credentials","title":"Wrong Credentials","text":"<pre><code># Match these in .env.docker and docker-compose.yml\nDATABASE_URL=mongodb://root:example@mongodb:27017/...\n#                     ^^^^        ^^^^\n#                     user        password\n</code></pre>"},{"location":"troubleshooting/#service-name-resolution","title":"Service Name Resolution","text":"<p>When running services locally (not in Docker):</p> <pre><code># \u274c Won't work outside Docker\nDATABASE_URL=mongodb://root:example@mongodb:27017/...\n\n# \u2705 Use localhost\nDATABASE_URL=mongodb://root:example@localhost:27017/...\n</code></pre>"},{"location":"troubleshooting/#problem-database-is-full-or-corrupted","title":"Problem: Database is full or corrupted","text":"<p>Symptoms: - Slow queries - Random crashes - \"No space left on device\"</p> <p>Solutions:</p>"},{"location":"troubleshooting/#reset-database","title":"Reset Database","text":"<pre><code># Stop all services\ndocker compose down\n\n# Remove volumes (deletes all data)\ndocker compose down -v\n\n# Restart\ndocker compose up -d\n</code></pre>"},{"location":"troubleshooting/#repair-database","title":"Repair Database","text":"<pre><code>docker exec -it mint-mongodb mongosh -u root -p example\n\n# In mongo shell\nuse auth_db\ndb.repairDatabase()\n</code></pre>"},{"location":"troubleshooting/#rabbitmq-connection-issues","title":"RabbitMQ Connection Issues","text":""},{"location":"troubleshooting/#problem-cannot-connect-to-rabbitmq","title":"Problem: Cannot connect to RabbitMQ","text":"<p>Symptoms: - \"ECONNREFUSED ::1:5672\" - \"Error: Channel closed\" - Events not being consumed</p> <p>Diagnosis: <pre><code># Check RabbitMQ is running\ndocker compose ps rabbitmq\n\n# Check logs\ndocker compose logs rabbitmq\n\n# Check management UI\nopen http://localhost:15672\n</code></pre></p> <p>Solutions:</p>"},{"location":"troubleshooting/#rabbitmq-not-ready","title":"RabbitMQ Not Ready","text":"<pre><code># Wait for RabbitMQ to be fully started\ndocker compose logs rabbitmq | grep \"Server startup complete\"\n\n# Takes 10-15 seconds on first start\n# Services should retry connection\n</code></pre>"},{"location":"troubleshooting/#wrong-url","title":"Wrong URL","text":"<pre><code># \u274c Outside Docker\nRABBITMQ_URL=amqp://guest:guest@rabbitmq:5672\n\n# \u2705 Use localhost when running locally\nRABBITMQ_URL=amqp://guest:guest@localhost:5672\n</code></pre>"},{"location":"troubleshooting/#connection-limits","title":"Connection Limits","text":"<pre><code># Check connection count\ndocker exec mint-rabbitmq rabbitmqctl list_connections\n\n# Restart services if too many stale connections\ndocker compose restart auth wallet transactions\n</code></pre>"},{"location":"troubleshooting/#problem-events-not-being-consumed","title":"Problem: Events not being consumed","text":"<p>Symptoms: - Wallet not created after signup - Balance not updated after transaction - No emails sent</p> <p>Diagnosis: <pre><code># Check RabbitMQ UI\nopen http://localhost:15672\n\n# Look at:\n# - Queue depths (should be 0 or low)\n# - Consumer count (should be &gt; 0)\n# - Message rates\n</code></pre></p> <p>Solutions:</p>"},{"location":"troubleshooting/#no-consumers-running","title":"No Consumers Running","text":"<pre><code># Check service logs for errors\ndocker compose logs wallet\ndocker compose logs notifications\n\n# Restart consumer service\ndocker compose restart wallet\n</code></pre>"},{"location":"troubleshooting/#wrong-queue-bindings","title":"Wrong Queue Bindings","text":"<pre><code># Check queue bindings in RabbitMQ UI\n# Queues \u2192 &lt;queue-name&gt; \u2192 Bindings\n\n# Should match routing key patterns\n</code></pre>"},{"location":"troubleshooting/#message-stuck-in-queue","title":"Message Stuck in Queue","text":"<pre><code># Purge queue (development only!)\ndocker exec mint-rabbitmq rabbitmqadmin purge queue name=wallet.user.q\n\n# Or via UI: Queues \u2192 &lt;queue-name&gt; \u2192 Purge\n</code></pre>"},{"location":"troubleshooting/#authentication-problems","title":"Authentication Problems","text":""},{"location":"troubleshooting/#problem-login-fails-with-401-unauthorized","title":"Problem: Login fails with 401 Unauthorized","text":"<p>Symptoms: - \"Invalid email or password\" - User exists but cannot log in</p> <p>Diagnosis: <pre><code># Check user exists\ndocker exec -it mint-mongodb mongosh -u root -p example\n\nuse auth_db\ndb.users.findOne({ email: \"user@example.com\" })\n</code></pre></p> <p>Solutions:</p>"},{"location":"troubleshooting/#user-doesnt-exist","title":"User Doesn't Exist","text":"<pre><code># Register user first\ncurl -X POST http://localhost/api/v1/auth/signup \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\":\"Test\",\"email\":\"test@example.com\",\"password\":\"pass123\"}'\n</code></pre>"},{"location":"troubleshooting/#wrong-password","title":"Wrong Password","text":"<ul> <li>Passwords are case-sensitive</li> <li>Ensure no extra spaces</li> <li>Minimum 8 characters</li> </ul>"},{"location":"troubleshooting/#password-hash-issue","title":"Password Hash Issue","text":"<p>If user was created without proper hashing:</p> <pre><code>// In MongoDB shell\nuse auth_db\ndb.users.deleteOne({ email: \"user@example.com\" })\n// Re-register through API\n</code></pre>"},{"location":"troubleshooting/#problem-jwt-verification-fails","title":"Problem: JWT verification fails","text":"<p>Symptoms: - \"401 Unauthorized\" on protected routes - \"Invalid signature\" - \"Token expired\"</p> <p>Diagnosis: <pre><code># Check JWKS endpoint is accessible\ncurl http://localhost/.well-known/jwks.json\n\n# Check wallet/transactions can reach auth service\ndocker compose exec wallet curl http://auth:4001/.well-known/jwks.json\n</code></pre></p> <p>Solutions:</p>"},{"location":"troubleshooting/#jwks-endpoint-not-accessible","title":"JWKS Endpoint Not Accessible","text":"<pre><code># In wallet/.env.docker and transactions/.env.docker\nJWKS_URI=http://auth:4001/.well-known/jwks.json\n#              ^^^^\n#              Service name, not localhost\n</code></pre>"},{"location":"troubleshooting/#token-expired","title":"Token Expired","text":"<p>Tokens expire after 7 days. Login again:</p> <pre><code>curl -X POST http://localhost/api/v1/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"email\":\"user@example.com\",\"password\":\"pass123\"}' \\\n  -c cookies.txt\n</code></pre>"},{"location":"troubleshooting/#key-mismatch","title":"Key Mismatch","text":"<p>Auth service public/private keys don't match:</p> <pre><code># Regenerate keys\ncd auth/keys\nrm *.pem\nopenssl genrsa -out private_key.pem 2048\nopenssl rsa -in private_key.pem -pubout -out public_key.pem\n\n# Restart auth service\ndocker compose restart auth\n</code></pre>"},{"location":"troubleshooting/#transaction-issues","title":"Transaction Issues","text":""},{"location":"troubleshooting/#problem-transaction-stuck-in-pending","title":"Problem: Transaction stuck in PENDING","text":"<p>Symptoms: - Transaction created but never completes - Status stays \"pending\"</p> <p>Diagnosis: <pre><code># Check transaction status\ncurl http://localhost/api/v1/transactions/&lt;transaction-id&gt; \\\n  -b cookies.txt\n\n# Check RabbitMQ queue depths\nopen http://localhost:15672\n# Look at transaction.created.q\n</code></pre></p> <p>Solutions:</p>"},{"location":"troubleshooting/#transaction-service-not-consuming","title":"Transaction Service Not Consuming","text":"<pre><code># Check logs\ndocker compose logs transactions\n\n# Restart service\ndocker compose restart transactions\n</code></pre>"},{"location":"troubleshooting/#event-not-published","title":"Event Not Published","text":"<pre><code># Check RabbitMQ exchange\n# Exchanges \u2192 transaction.events \u2192 Publish message rate\n\n# Manually trigger processing (development)\ndocker exec mint-rabbitmq rabbitmqadmin publish \\\n  exchange=transaction.events \\\n  routing_key=transaction.created \\\n  payload='{\"transactionId\":\"&lt;id&gt;\"}'\n</code></pre>"},{"location":"troubleshooting/#problem-transfer-fails-with-insufficient-balance","title":"Problem: Transfer fails with insufficient balance","text":"<p>Symptoms: - Transaction status changes to FAILED - \"Insufficient balance\" error</p> <p>Diagnosis: <pre><code># Check wallet balance\ncurl http://localhost/api/v1/wallet/user -b cookies.txt\n</code></pre></p> <p>Solutions:</p>"},{"location":"troubleshooting/#add-funds-first","title":"Add Funds First","text":"<pre><code># Top-up wallet\ncurl -X POST http://localhost/api/v1/transactions/topup \\\n  -H \"Content-Type: application/json\" \\\n  -b cookies.txt \\\n  -d '{\"amount\": 100}'\n\n# Wait 1 second for processing\nsleep 1\n\n# Try transfer again\n</code></pre>"},{"location":"troubleshooting/#wallet-issues","title":"Wallet Issues","text":""},{"location":"troubleshooting/#problem-wallet-not-created-after-signup","title":"Problem: Wallet not created after signup","text":"<p>Symptoms: - User registered but GET /wallet/user returns 404 - \"Wallet not found\"</p> <p>Diagnosis: <pre><code># Check wallet exists\ndocker exec -it mint-mongodb mongosh -u root -p example\n\nuse wallet_db\ndb.wallets.findOne({ userId: ObjectId(\"&lt;user-id&gt;\") })\n\n# Check RabbitMQ for pending messages\nopen http://localhost:15672\n# Check wallet.user.q depth\n</code></pre></p> <p>Solutions:</p>"},{"location":"troubleshooting/#wallet-service-not-running","title":"Wallet Service Not Running","text":"<pre><code># Check service status\ndocker compose ps wallet\n\n# Start if stopped\ndocker compose up wallet -d\n</code></pre>"},{"location":"troubleshooting/#event-not-consumed","title":"Event Not Consumed","text":"<pre><code># Check wallet service logs\ndocker compose logs wallet | grep \"user.signup\"\n\n# Restart wallet service\ndocker compose restart wallet\n</code></pre>"},{"location":"troubleshooting/#manually-trigger-wallet-creation","title":"Manually Trigger Wallet Creation","text":"<pre><code># Publish event manually\ndocker exec mint-rabbitmq rabbitmqadmin publish \\\n  exchange=auth.events \\\n  routing_key=user.signup \\\n  payload='{\"userId\":\"&lt;user-id&gt;\",\"email\":\"user@example.com\"}'\n</code></pre>"},{"location":"troubleshooting/#problem-balance-not-updating","title":"Problem: Balance not updating","text":"<p>Symptoms: - Transaction completed but balance unchanged - Balance updates slowly</p> <p>Diagnosis: <pre><code># Check transaction status\ncurl http://localhost/api/v1/transactions/&lt;id&gt; -b cookies.txt\n\n# Check wallet service logs\ndocker compose logs wallet\n</code></pre></p> <p>Solutions:</p>"},{"location":"troubleshooting/#wait-for-processing","title":"Wait for Processing","text":"<p>Transactions process asynchronously (100-500ms):</p> <pre><code># Create transaction\ncurl -X POST http://localhost/api/v1/transactions/topup \\\n  -H \"Content-Type: application/json\" \\\n  -b cookies.txt \\\n  -d '{\"amount\": 100}'\n\n# Wait\nsleep 2\n\n# Check balance\ncurl http://localhost/api/v1/wallet/user -b cookies.txt\n</code></pre>"},{"location":"troubleshooting/#wallet-service-not-consuming","title":"Wallet Service Not Consuming","text":"<pre><code># Restart wallet service\ndocker compose restart wallet\n</code></pre>"},{"location":"troubleshooting/#network-port-conflicts","title":"Network &amp; Port Conflicts","text":""},{"location":"troubleshooting/#problem-port-already-in-use","title":"Problem: Port already in use","text":"<p>Error: <pre><code>Error starting userland proxy: bind: address already in use\n</code></pre></p> <p>Find Process Using Port:</p>"},{"location":"troubleshooting/#linuxmac","title":"Linux/Mac","text":"<pre><code># Find process\nlsof -i :80\nlsof -i :4001\n\n# Kill process\nkill -9 &lt;PID&gt;\n</code></pre>"},{"location":"troubleshooting/#windows","title":"Windows","text":"<pre><code># Find process\nnetstat -ano | findstr :80\n\n# Kill process\ntaskkill /PID &lt;PID&gt; /F\n</code></pre> <p>Change Port:</p> <p>Edit <code>docker-compose.yml</code>: <pre><code>nginx:\n  ports:\n    - \"8080:80\"  # Change 80 to 8080\n</code></pre></p>"},{"location":"troubleshooting/#problem-services-cant-reach-each-other","title":"Problem: Services can't reach each other","text":"<p>Symptoms: - \"ECONNREFUSED\" between services - Wallet can't reach auth service</p> <p>Diagnosis: <pre><code># Check network\ndocker network ls\ndocker network inspect mint_default\n\n# Test connectivity\ndocker compose exec wallet ping auth\ndocker compose exec wallet curl http://auth:4001/api/v1/auth/health\n</code></pre></p> <p>Solutions:</p>"},{"location":"troubleshooting/#use-service-names","title":"Use Service Names","text":"<p>Inside Docker, use service names (not localhost):</p> <pre><code># \u2705 Correct\nJWKS_URI=http://auth:4001/.well-known/jwks.json\n\n# \u274c Wrong (won't work in Docker)\nJWKS_URI=http://localhost:4001/.well-known/jwks.json\n</code></pre>"},{"location":"troubleshooting/#restart-networking","title":"Restart Networking","text":"<pre><code>docker compose down\ndocker compose up -d\n</code></pre>"},{"location":"troubleshooting/#performance-issues","title":"Performance Issues","text":""},{"location":"troubleshooting/#problem-slow-api-responses","title":"Problem: Slow API responses","text":"<p>Diagnosis: <pre><code># Check resource usage\ndocker stats\n\n# Check service logs for slow queries\ndocker compose logs | grep \"slow\"\n</code></pre></p> <p>Solutions:</p>"},{"location":"troubleshooting/#high-cpumemory","title":"High CPU/Memory","text":"<pre><code># Add resource limits in docker-compose.yml\nservices:\n  auth:\n    deploy:\n      resources:\n        limits:\n          cpus: '1.0'\n          memory: 512M\n</code></pre>"},{"location":"troubleshooting/#database-indexes","title":"Database Indexes","text":"<p>Add indexes for frequently queried fields:</p> <pre><code>// In MongoDB shell\nuse wallet_db\ndb.wallets.createIndex({ userId: 1 })\n\nuse transactions_db\ndb.transactions.createIndex({ userId: 1 })\ndb.transactions.createIndex({ createdAt: -1 })\n</code></pre>"},{"location":"troubleshooting/#docker-issues","title":"Docker Issues","text":""},{"location":"troubleshooting/#problem-out-of-disk-space","title":"Problem: Out of disk space","text":"<p>Error: <pre><code>no space left on device\n</code></pre></p> <p>Solutions:</p> <pre><code># Remove unused containers\ndocker container prune\n\n# Remove unused images\ndocker image prune -a\n\n# Remove unused volumes\ndocker volume prune\n\n# Nuclear option - remove everything\ndocker system prune -a --volumes\n</code></pre>"},{"location":"troubleshooting/#problem-build-fails","title":"Problem: Build fails","text":"<p>Error: <pre><code>failed to solve with frontend dockerfile\n</code></pre></p> <p>Solutions:</p> <pre><code># Clear build cache\ndocker builder prune\n\n# Rebuild without cache\ndocker compose build --no-cache\n\n# Check Dockerfile syntax\ndocker compose config\n</code></pre>"},{"location":"troubleshooting/#general-debugging","title":"General Debugging","text":""},{"location":"troubleshooting/#check-service-health","title":"Check Service Health","text":"<pre><code># All services\ndocker compose ps\n\n# Gateway\ncurl http://localhost/health\n\n# Individual services\ncurl http://localhost/api/v1/auth/health\n</code></pre>"},{"location":"troubleshooting/#view-logs","title":"View Logs","text":"<pre><code># All services\ndocker compose logs -f\n\n# Specific service\ndocker compose logs -f auth\n\n# Last 100 lines\ndocker compose logs --tail=100 wallet\n\n# Filter errors\ndocker compose logs | grep ERROR\n</code></pre>"},{"location":"troubleshooting/#access-service-shell","title":"Access Service Shell","text":"<pre><code># Access container\ndocker exec -it mint-auth sh\n\n# Run commands inside\nls\nenv | grep DATABASE\n</code></pre>"},{"location":"troubleshooting/#check-environment-variables","title":"Check Environment Variables","text":"<pre><code># View service environment\ndocker compose exec auth env\n\n# Check specific variable\ndocker compose exec auth printenv DATABASE_URL\n</code></pre>"},{"location":"troubleshooting/#reset-everything","title":"Reset Everything","text":"<p>When all else fails:</p> <pre><code># Nuclear option - reset everything\ndocker compose down -v --rmi all\n\n# Remove networks\ndocker network prune\n\n# Rebuild and start\ndocker compose up --build\n</code></pre>"},{"location":"troubleshooting/#getting-help","title":"Getting Help","text":"<p>If you're still stuck:</p> <ol> <li> <p>Check logs thoroughly:    <pre><code>docker compose logs &gt; logs.txt\n</code></pre></p> </li> <li> <p>Gather information:</p> </li> <li>Error messages</li> <li>Docker compose ps output</li> <li>Environment configuration</li> <li> <p>Steps to reproduce</p> </li> <li> <p>Search issues: Check GitHub issues for similar problems</p> </li> <li> <p>Create issue: Open a new issue with:</p> </li> <li>Clear description</li> <li>Error messages</li> <li>Logs</li> <li>Environment details</li> </ol>"},{"location":"troubleshooting/#related-documentation","title":"Related Documentation","text":"<ul> <li>Architecture Overview - System design</li> <li>Deployment Guide - Setup instructions</li> <li>Development Guide - Local development</li> <li>API Documentation - API reference</li> </ul>"},{"location":"about/contributing/","title":"Contributing to Mint","text":"<p>Thank you for your interest in contributing to Mint! This guide will help you get started.</p>"},{"location":"about/contributing/#ways-to-contribute","title":"Ways to Contribute","text":"<p>There are many ways to contribute to Mint:</p> <ul> <li>\ud83d\udc1b Report bugs - Help us identify and fix issues</li> <li>\ud83d\udca1 Suggest features - Share ideas for improvements</li> <li>\ud83d\udcd6 Improve documentation - Make docs clearer and more comprehensive</li> <li>\ud83d\udd27 Submit pull requests - Fix bugs or add features</li> <li>\u2b50 Star the repository - Show your support</li> </ul>"},{"location":"about/contributing/#getting-started","title":"Getting Started","text":""},{"location":"about/contributing/#1-fork-the-repository","title":"1. Fork the Repository","text":"<p>Fork the Mint repository to your GitHub account.</p>"},{"location":"about/contributing/#2-clone-your-fork","title":"2. Clone Your Fork","text":"<pre><code>git clone https://github.com/YOUR_USERNAME/mint.git\ncd mint\n</code></pre>"},{"location":"about/contributing/#3-set-up-development-environment","title":"3. Set Up Development Environment","text":"<p>Follow the Development Guide to set up your local environment.</p>"},{"location":"about/contributing/#4-create-a-branch","title":"4. Create a Branch","text":"<pre><code>git checkout -b feature/your-feature-name\n# or\ngit checkout -b fix/your-bug-fix\n</code></pre>"},{"location":"about/contributing/#development-workflow","title":"Development Workflow","text":""},{"location":"about/contributing/#running-services-locally","title":"Running Services Locally","text":"<pre><code># Start infrastructure\ndocker compose up mongodb rabbitmq\n\n# Run services with hot-reload\ncd auth &amp;&amp; pnpm dev\ncd wallet &amp;&amp; pnpm dev\ncd transactions &amp;&amp; pnpm dev\ncd notifications &amp;&amp; pnpm dev\n</code></pre>"},{"location":"about/contributing/#code-quality","title":"Code Quality","text":"<p>Before submitting changes:</p> <pre><code># Format code\npnpm format\n\n# Lint code\npnpm lint\n\n# Fix linting issues\npnpm lint --fix\n</code></pre>"},{"location":"about/contributing/#commit-guidelines","title":"Commit Guidelines","text":""},{"location":"about/contributing/#commit-message-format","title":"Commit Message Format","text":"<p>Use conventional commits:</p> <pre><code>type(scope): description\n\n[optional body]\n\n[optional footer]\n</code></pre> <p>Types: - <code>feat</code>: New feature - <code>fix</code>: Bug fix - <code>docs</code>: Documentation changes - <code>style</code>: Code style changes (formatting, etc.) - <code>refactor</code>: Code refactoring - <code>test</code>: Adding or updating tests - <code>chore</code>: Build process or tooling changes</p> <p>Examples: <pre><code>feat(auth): add password reset functionality\nfix(wallet): resolve race condition in balance updates\ndocs(api): update transaction endpoint examples\nrefactor(transactions): simplify event handling logic\n</code></pre></p>"},{"location":"about/contributing/#best-practices","title":"Best Practices","text":"<ul> <li>Write clear, descriptive commit messages</li> <li>Keep commits focused and atomic</li> <li>Reference issue numbers when applicable (<code>Closes #123</code>)</li> <li>Test your changes before committing</li> </ul>"},{"location":"about/contributing/#pull-request-process","title":"Pull Request Process","text":""},{"location":"about/contributing/#1-update-your-branch","title":"1. Update Your Branch","text":"<pre><code>git fetch upstream\ngit rebase upstream/main\n</code></pre>"},{"location":"about/contributing/#2-push-to-your-fork","title":"2. Push to Your Fork","text":"<pre><code>git push origin feature/your-feature-name\n</code></pre>"},{"location":"about/contributing/#3-create-pull-request","title":"3. Create Pull Request","text":"<ol> <li>Go to the Mint repository</li> <li>Click \"New Pull Request\"</li> <li>Select your fork and branch</li> <li>Fill out the PR template</li> </ol>"},{"location":"about/contributing/#pr-checklist","title":"PR Checklist","text":"<ul> <li>[ ] Code follows the existing style</li> <li>[ ] Commits follow conventional commit format</li> <li>[ ] Code has been tested locally</li> <li>[ ] Documentation has been updated</li> <li>[ ] No console.log or debug code left in</li> <li>[ ] All linting passes</li> <li>[ ] PR description clearly describes changes</li> </ul>"},{"location":"about/contributing/#code-style","title":"Code Style","text":""},{"location":"about/contributing/#typescript","title":"TypeScript","text":"<ul> <li>Use TypeScript for all new code</li> <li>Define proper types (avoid <code>any</code>)</li> <li>Use interfaces for object shapes</li> <li>Prefer <code>const</code> over <code>let</code></li> </ul>"},{"location":"about/contributing/#file-structure","title":"File Structure","text":"<pre><code>// 1. Imports\nimport { Request, Response } from 'express';\nimport { UserService } from '~/services/user.service';\n\n// 2. Types/Interfaces\ninterface CreateUserRequest {\n  name: string;\n  email: string;\n}\n\n// 3. Functions\nexport async function createUser(req: Request, res: Response) {\n  // Implementation\n}\n</code></pre>"},{"location":"about/contributing/#naming-conventions","title":"Naming Conventions","text":"<ul> <li>Files: kebab-case (<code>user-service.ts</code>)</li> <li>Classes: PascalCase (<code>UserService</code>)</li> <li>Functions: camelCase (<code>createUser</code>)</li> <li>Constants: UPPER_CASE (<code>MAX_RETRIES</code>)</li> <li>Interfaces: PascalCase (<code>IUser</code> or <code>User</code>)</li> </ul>"},{"location":"about/contributing/#testing","title":"Testing","text":""},{"location":"about/contributing/#manual-testing","title":"Manual Testing","text":"<p>Test your changes:</p> <pre><code># Register user\ncurl -X POST http://localhost/api/v1/auth/signup \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\": \"Test\", \"email\": \"test@example.com\", \"password\": \"Test123!\"}'\n\n# Verify functionality works\n</code></pre>"},{"location":"about/contributing/#integration-testing","title":"Integration Testing","text":"<p>Ensure existing functionality still works:</p> <ol> <li>Run the full system with Docker Compose</li> <li>Test the complete user flow</li> <li>Check RabbitMQ for proper event flow</li> <li>Verify all services remain healthy</li> </ol>"},{"location":"about/contributing/#documentation","title":"Documentation","text":""},{"location":"about/contributing/#update-documentation","title":"Update Documentation","text":"<p>If your change affects:</p> <ul> <li>API: Update <code>docs/api/*.md</code></li> <li>Configuration: Update <code>docs/getting-started/configuration.md</code></li> <li>Architecture: Update <code>docs/architecture.md</code></li> <li>Events: Update <code>docs/events.md</code></li> </ul>"},{"location":"about/contributing/#documentation-style","title":"Documentation Style","text":"<ul> <li>Use clear, concise language</li> <li>Include code examples</li> <li>Add diagrams where helpful (Mermaid)</li> <li>Keep formatting consistent</li> </ul>"},{"location":"about/contributing/#reporting-bugs","title":"Reporting Bugs","text":""},{"location":"about/contributing/#before-reporting","title":"Before Reporting","text":"<ol> <li>Check existing issues</li> <li>Try the latest version</li> <li>Test in a clean environment</li> </ol>"},{"location":"about/contributing/#bug-report-template","title":"Bug Report Template","text":"<p><pre><code>**Description**\nA clear description of the bug.\n\n**Steps to Reproduce**\n1. Start services\n2. Call endpoint X\n3. Observe error Y\n\n**Expected Behavior**\nWhat should happen.\n\n**Actual Behavior**\nWhat actually happens.\n\n**Environment**\n- OS: [e.g., macOS 14.1]\n- Docker version: [e.g., 24.0.7]\n- Node version: [e.g., 22.x]\n\n**Logs**\n</code></pre> Paste relevant logs here <pre><code>\n</code></pre></p>"},{"location":"about/contributing/#suggesting-features","title":"Suggesting Features","text":""},{"location":"about/contributing/#feature-request-template","title":"Feature Request Template","text":"<pre><code>**Problem Statement**\nWhat problem does this solve?\n\n**Proposed Solution**\nHow should this work?\n\n**Alternatives Considered**\nOther approaches you've thought about.\n\n**Additional Context**\nAny other relevant information.\n</code></pre>"},{"location":"about/contributing/#code-review","title":"Code Review","text":""},{"location":"about/contributing/#what-we-look-for","title":"What We Look For","text":"<ul> <li>\u2705 Code quality and readability</li> <li>\u2705 Test coverage</li> <li>\u2705 Documentation updates</li> <li>\u2705 Performance implications</li> <li>\u2705 Security considerations</li> <li>\u2705 Breaking changes clearly noted</li> </ul>"},{"location":"about/contributing/#review-process","title":"Review Process","text":"<ol> <li>Automated checks run (linting, etc.)</li> <li>Maintainer reviews code</li> <li>Feedback provided</li> <li>Changes requested or approved</li> <li>PR merged</li> </ol>"},{"location":"about/contributing/#community-guidelines","title":"Community Guidelines","text":""},{"location":"about/contributing/#be-respectful","title":"Be Respectful","text":"<ul> <li>Be welcoming to newcomers</li> <li>Respect different viewpoints</li> <li>Accept constructive criticism</li> <li>Focus on the code, not the person</li> </ul>"},{"location":"about/contributing/#communication","title":"Communication","text":"<ul> <li>Ask questions if unclear</li> <li>Provide context in discussions</li> <li>Be patient with responses</li> <li>Help others when you can</li> </ul>"},{"location":"about/contributing/#recognition","title":"Recognition","text":"<p>Contributors will be:</p> <ul> <li>Listed in release notes</li> <li>Acknowledged in the README</li> <li>Mentioned in commit history</li> </ul>"},{"location":"about/contributing/#questions","title":"Questions?","text":"<ul> <li>GitHub Issues: Report bugs or ask questions</li> <li>Documentation: Check the docs</li> <li>Email: Contact the maintainer</li> </ul>"},{"location":"about/contributing/#thank-you","title":"Thank You!","text":"<p>Every contribution helps make Mint better. Thank you for being part of the project! \ud83c\udf89</p>"},{"location":"about/contributing/#quick-links","title":"Quick Links","text":"<ul> <li>Development Guide</li> <li>Architecture Overview</li> <li>API Reference</li> <li>License</li> </ul>"},{"location":"about/license/","title":"License","text":"<p>Mint is licensed under the MIT License.</p>"},{"location":"about/license/#mit-license","title":"MIT License","text":"<pre><code>MIT License\n\nCopyright (c) 2025 Sreekar Venkata Nutulapati\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n</code></pre>"},{"location":"about/license/#what-this-means","title":"What This Means","text":"<p>The MIT License is a permissive license that allows you to:</p> <ul> <li>\u2705 Use the software for any purpose</li> <li>\u2705 Modify the source code</li> <li>\u2705 Distribute copies</li> <li>\u2705 Sublicense under different terms</li> <li>\u2705 Use commercially without restrictions</li> </ul>"},{"location":"about/license/#conditions","title":"Conditions","text":"<p>You must include:</p> <ul> <li>The copyright notice</li> <li>The license text</li> </ul>"},{"location":"about/license/#limitations","title":"Limitations","text":"<p>The software is provided \"as is\" without warranty.</p>"},{"location":"about/license/#third-party-licenses","title":"Third-Party Licenses","text":"<p>Mint uses open-source libraries with their own licenses:</p> Library License Purpose Express.js MIT Web framework MongoDB/Mongoose SSPL/MIT Database RabbitMQ MPL 2.0 Message broker Node.js MIT Runtime TypeScript Apache 2.0 Language Argon2 MIT Password hashing Jose MIT JWT handling Zod MIT Validation <p>All third-party dependencies are listed in <code>package.json</code> files.</p>"},{"location":"about/license/#contributing","title":"Contributing","text":"<p>By contributing to Mint, you agree that your contributions will be licensed under the MIT License.</p> <p>See the Contributing Guide for more information.</p>"},{"location":"api/auth/","title":"Authentication API","text":""},{"location":"api/auth/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Overview</li> <li>Base URL</li> <li>Authentication</li> <li>Endpoints</li> <li>Register User</li> <li>Login</li> <li>Logout</li> <li>Get Current User</li> <li>List All Users</li> <li>Search Users</li> <li>Get User Profile</li> <li>Update Current User</li> <li>JWKS Endpoint</li> <li>Health Check</li> <li>Error Responses</li> </ul>"},{"location":"api/auth/#overview","title":"Overview","text":"<p>The Authentication API handles user registration, login, session management, and user profile operations. It uses JWT tokens with RS256 asymmetric encryption, stored in HTTP-only cookies for security.</p>"},{"location":"api/auth/#base-url","title":"Base URL","text":"<pre><code>http://localhost/api/v1/auth\n</code></pre> <p>All authentication endpoints are prefixed with <code>/api/v1/auth</code>.</p>"},{"location":"api/auth/#authentication","title":"Authentication","text":""},{"location":"api/auth/#public-endpoints-no-auth-required","title":"Public Endpoints (No Auth Required)","text":"<ul> <li><code>POST /signup</code> - Register new user</li> <li><code>POST /login</code> - Login user</li> <li><code>GET /.well-known/jwks.json</code> - Public keys</li> </ul>"},{"location":"api/auth/#protected-endpoints-auth-required","title":"Protected Endpoints (Auth Required)","text":"<p>All other endpoints require authentication via HTTP-only cookie set during login.</p> <p>Cookie Name: <code>mint_session</code></p> <p>Headers: Cookies are sent automatically by the browser. For manual testing: <pre><code>Cookie: mint_session=&lt;jwt-token&gt;\n</code></pre></p>"},{"location":"api/auth/#endpoints","title":"Endpoints","text":""},{"location":"api/auth/#register-user","title":"Register User","text":"<p>Create a new user account.</p> <p>Endpoint: <code>POST /api/v1/auth/signup</code></p> <p>Authentication: None required</p>"},{"location":"api/auth/#request-body","title":"Request Body","text":"<pre><code>{\n  \"name\": \"string (required, min 2 chars)\",\n  \"email\": \"string (required, valid email)\",\n  \"password\": \"string (required, min 8 chars)\"\n}\n</code></pre>"},{"location":"api/auth/#example-request","title":"Example Request","text":"<pre><code>curl -X POST http://localhost/api/v1/auth/signup \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"John Doe\",\n    \"email\": \"john@example.com\",\n    \"password\": \"SecurePass123!\"\n  }'\n</code></pre>"},{"location":"api/auth/#success-response","title":"Success Response","text":"<p>Code: <code>201 Created</code></p> <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439011\",\n  \"name\": \"John Doe\",\n  \"email\": \"john@example.com\",\n  \"createdAt\": \"2025-01-15T10:30:00.000Z\"\n}\n</code></pre>"},{"location":"api/auth/#side-effects","title":"Side Effects","text":"<ol> <li>User is created in the database</li> <li>Password is hashed with Argon2</li> <li><code>user.signup</code> event is published to RabbitMQ</li> <li>Wallet is created asynchronously</li> <li>Welcome email is sent asynchronously</li> </ol>"},{"location":"api/auth/#error-responses","title":"Error Responses","text":"<p>400 Bad Request - Validation error <pre><code>{\n  \"error\": \"Validation error\",\n  \"details\": [\n    {\n      \"field\": \"email\",\n      \"message\": \"Invalid email\"\n    }\n  ]\n}\n</code></pre></p> <p>409 Conflict - Email already exists <pre><code>{\n  \"error\": \"User with this email already exists\"\n}\n</code></pre></p>"},{"location":"api/auth/#login","title":"Login","text":"<p>Authenticate a user and create a session.</p> <p>Endpoint: <code>POST /api/v1/auth/login</code></p> <p>Authentication: None required</p>"},{"location":"api/auth/#request-body_1","title":"Request Body","text":"<pre><code>{\n  \"email\": \"string (required)\",\n  \"password\": \"string (required)\"\n}\n</code></pre>"},{"location":"api/auth/#example-request_1","title":"Example Request","text":"<pre><code>curl -X POST http://localhost/api/v1/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"john@example.com\",\n    \"password\": \"SecurePass123!\"\n  }' \\\n  -c cookies.txt\n</code></pre>"},{"location":"api/auth/#success-response_1","title":"Success Response","text":"<p>Code: <code>200 OK</code></p> <p>Headers: <pre><code>Set-Cookie: mint_session=&lt;jwt-token&gt;; HttpOnly; Secure; SameSite=Strict; Max-Age=604800\n</code></pre></p> <p>Body: <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439011\",\n  \"name\": \"John Doe\",\n  \"email\": \"john@example.com\"\n}\n</code></pre></p>"},{"location":"api/auth/#jwt-token-details","title":"JWT Token Details","text":"<ul> <li>Algorithm: RS256 (asymmetric)</li> <li>Issuer: <code>mint-auth-service</code></li> <li>Audience: <code>mint-api</code></li> <li>Expires: 7 days</li> <li>Claims:   <pre><code>{\n  \"sub\": \"507f1f77bcf86cd799439011\",\n  \"email\": \"john@example.com\",\n  \"iat\": 1642248600,\n  \"exp\": 1642853400,\n  \"iss\": \"mint-auth-service\",\n  \"aud\": \"mint-api\"\n}\n</code></pre></li> </ul>"},{"location":"api/auth/#error-responses_1","title":"Error Responses","text":"<p>400 Bad Request - Missing fields <pre><code>{\n  \"error\": \"Email and password are required\"\n}\n</code></pre></p> <p>401 Unauthorized - Invalid credentials <pre><code>{\n  \"error\": \"Invalid email or password\"\n}\n</code></pre></p>"},{"location":"api/auth/#logout","title":"Logout","text":"<p>End the user's session.</p> <p>Endpoint: <code>POST /api/v1/auth/logout</code></p> <p>Authentication: Required</p>"},{"location":"api/auth/#example-request_2","title":"Example Request","text":"<pre><code>curl -X POST http://localhost/api/v1/auth/logout \\\n  -b cookies.txt\n</code></pre>"},{"location":"api/auth/#success-response_2","title":"Success Response","text":"<p>Code: <code>200 OK</code></p> <p>Headers: <pre><code>Set-Cookie: mint_session=; HttpOnly; Secure; SameSite=Strict; Max-Age=0\n</code></pre></p> <p>Body: <pre><code>{\n  \"message\": \"Logged out successfully\"\n}\n</code></pre></p>"},{"location":"api/auth/#get-current-user","title":"Get Current User","text":"<p>Retrieve the authenticated user's information.</p> <p>Endpoint: <code>GET /api/v1/auth/user</code></p> <p>Authentication: Required</p>"},{"location":"api/auth/#example-request_3","title":"Example Request","text":"<pre><code>curl http://localhost/api/v1/auth/user \\\n  -b cookies.txt\n</code></pre>"},{"location":"api/auth/#success-response_3","title":"Success Response","text":"<p>Code: <code>200 OK</code></p> <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439011\",\n  \"name\": \"John Doe\",\n  \"email\": \"john@example.com\",\n  \"createdAt\": \"2025-01-15T10:30:00.000Z\"\n}\n</code></pre>"},{"location":"api/auth/#error-responses_2","title":"Error Responses","text":"<p>401 Unauthorized - Not logged in or token expired <pre><code>{\n  \"error\": \"Unauthorized\"\n}\n</code></pre></p>"},{"location":"api/auth/#list-all-users","title":"List All Users","text":"<p>Retrieve all users in the system.</p> <p>Endpoint: <code>GET /api/v1/users</code></p> <p>Authentication: Required</p>"},{"location":"api/auth/#example-request_4","title":"Example Request","text":"<pre><code>curl http://localhost/api/v1/users \\\n  -b cookies.txt\n</code></pre>"},{"location":"api/auth/#success-response_4","title":"Success Response","text":"<p>Code: <code>200 OK</code></p> <pre><code>{\n  \"users\": [\n    {\n      \"id\": \"507f1f77bcf86cd799439011\",\n      \"name\": \"John Doe\",\n      \"email\": \"john@example.com\"\n    },\n    {\n      \"id\": \"507f1f77bcf86cd799439012\",\n      \"name\": \"Jane Smith\",\n      \"email\": \"jane@example.com\"\n    }\n  ],\n  \"total\": 2\n}\n</code></pre> <p>Note: Passwords are never included in responses.</p>"},{"location":"api/auth/#search-users","title":"Search Users","text":"<p>Search for users by name or email.</p> <p>Endpoint: <code>GET /api/v1/users/search</code></p> <p>Authentication: Required</p>"},{"location":"api/auth/#query-parameters","title":"Query Parameters","text":"Parameter Type Required Description <code>q</code> string Yes Search query (min 1 char)"},{"location":"api/auth/#example-request_5","title":"Example Request","text":"<pre><code>curl \"http://localhost/api/v1/users/search?q=john\" \\\n  -b cookies.txt\n</code></pre>"},{"location":"api/auth/#success-response_5","title":"Success Response","text":"<p>Code: <code>200 OK</code></p> <pre><code>{\n  \"users\": [\n    {\n      \"id\": \"507f1f77bcf86cd799439011\",\n      \"name\": \"John Doe\",\n      \"email\": \"john@example.com\"\n    }\n  ],\n  \"total\": 1\n}\n</code></pre>"},{"location":"api/auth/#search-behavior","title":"Search Behavior","text":"<ul> <li>Case-insensitive</li> <li>Searches in both <code>name</code> and <code>email</code> fields</li> <li>Partial match (uses regex)</li> </ul>"},{"location":"api/auth/#error-responses_3","title":"Error Responses","text":"<p>400 Bad Request - Missing query parameter <pre><code>{\n  \"error\": \"Search query is required\"\n}\n</code></pre></p>"},{"location":"api/auth/#get-user-profile","title":"Get User Profile","text":"<p>Retrieve a specific user's profile by ID.</p> <p>Endpoint: <code>GET /api/v1/users/:id</code></p> <p>Authentication: Required</p>"},{"location":"api/auth/#path-parameters","title":"Path Parameters","text":"Parameter Type Description <code>id</code> string User's MongoDB ObjectId"},{"location":"api/auth/#example-request_6","title":"Example Request","text":"<pre><code>curl http://localhost/api/v1/users/507f1f77bcf86cd799439011 \\\n  -b cookies.txt\n</code></pre>"},{"location":"api/auth/#success-response_6","title":"Success Response","text":"<p>Code: <code>200 OK</code></p> <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439011\",\n  \"name\": \"John Doe\",\n  \"email\": \"john@example.com\",\n  \"createdAt\": \"2025-01-15T10:30:00.000Z\"\n}\n</code></pre>"},{"location":"api/auth/#error-responses_4","title":"Error Responses","text":"<p>404 Not Found - User doesn't exist <pre><code>{\n  \"error\": \"User not found\"\n}\n</code></pre></p>"},{"location":"api/auth/#update-current-user","title":"Update Current User","text":"<p>Update the authenticated user's profile.</p> <p>Endpoint: <code>PUT /api/v1/users/me</code></p> <p>Authentication: Required</p>"},{"location":"api/auth/#request-body_2","title":"Request Body","text":"<pre><code>{\n  \"name\": \"string (optional, min 2 chars)\",\n  \"email\": \"string (optional, valid email)\"\n}\n</code></pre> <p>Note: At least one field must be provided.</p>"},{"location":"api/auth/#example-request_7","title":"Example Request","text":"<pre><code>curl -X PUT http://localhost/api/v1/users/me \\\n  -H \"Content-Type: application/json\" \\\n  -b cookies.txt \\\n  -d '{\n    \"name\": \"John Smith\"\n  }'\n</code></pre>"},{"location":"api/auth/#success-response_7","title":"Success Response","text":"<p>Code: <code>200 OK</code></p> <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439011\",\n  \"name\": \"John Smith\",\n  \"email\": \"john@example.com\",\n  \"createdAt\": \"2025-01-15T10:30:00.000Z\",\n  \"updatedAt\": \"2025-01-15T14:30:00.000Z\"\n}\n</code></pre>"},{"location":"api/auth/#error-responses_5","title":"Error Responses","text":"<p>400 Bad Request - Validation error <pre><code>{\n  \"error\": \"Name must be at least 2 characters\"\n}\n</code></pre></p> <p>409 Conflict - Email already in use <pre><code>{\n  \"error\": \"Email already in use\"\n}\n</code></pre></p>"},{"location":"api/auth/#jwks-endpoint","title":"JWKS Endpoint","text":"<p>Retrieve the JSON Web Key Set for JWT verification.</p> <p>Endpoint: <code>GET /.well-known/jwks.json</code></p> <p>Authentication: None required (public endpoint)</p>"},{"location":"api/auth/#example-request_8","title":"Example Request","text":"<pre><code>curl http://localhost/.well-known/jwks.json\n</code></pre>"},{"location":"api/auth/#success-response_8","title":"Success Response","text":"<p>Code: <code>200 OK</code></p> <pre><code>{\n  \"keys\": [\n    {\n      \"kty\": \"RSA\",\n      \"use\": \"sig\",\n      \"kid\": \"mint-auth-key-1\",\n      \"n\": \"0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2aiAFbWhM78LhWx...\",\n      \"e\": \"AQAB\",\n      \"alg\": \"RS256\"\n    }\n  ]\n}\n</code></pre>"},{"location":"api/auth/#usage","title":"Usage","text":"<p>Other services use this endpoint to: 1. Fetch the public key 2. Verify JWT signatures 3. Validate tokens without contacting auth service</p>"},{"location":"api/auth/#jwk-fields","title":"JWK Fields","text":"<ul> <li><code>kty</code>: Key type (RSA)</li> <li><code>use</code>: Key usage (sig = signature)</li> <li><code>kid</code>: Key ID for rotation</li> <li><code>n</code>: RSA modulus</li> <li><code>e</code>: RSA exponent</li> <li><code>alg</code>: Algorithm (RS256)</li> </ul>"},{"location":"api/auth/#health-check","title":"Health Check","text":"<p>Check if the auth service is healthy.</p> <p>Endpoint: <code>GET /api/v1/auth/health</code></p> <p>Authentication: None required</p>"},{"location":"api/auth/#example-request_9","title":"Example Request","text":"<pre><code>curl http://localhost/api/v1/auth/health\n</code></pre>"},{"location":"api/auth/#success-response_9","title":"Success Response","text":"<p>Code: <code>200 OK</code></p> <pre><code>{\n  \"status\": \"healthy\",\n  \"service\": \"auth-service\",\n  \"timestamp\": \"2025-01-15T10:30:00.000Z\"\n}\n</code></pre>"},{"location":"api/auth/#error-responses_6","title":"Error Responses","text":""},{"location":"api/auth/#standard-error-format","title":"Standard Error Format","text":"<p>All errors follow this format:</p> <pre><code>{\n  \"error\": \"Error message\",\n  \"details\": []  // Optional, for validation errors\n}\n</code></pre>"},{"location":"api/auth/#http-status-codes","title":"HTTP Status Codes","text":"Code Meaning When <code>200</code> OK Request succeeded <code>201</code> Created Resource created (signup) <code>400</code> Bad Request Validation error, malformed request <code>401</code> Unauthorized Missing/invalid authentication <code>403</code> Forbidden Valid auth but insufficient permissions <code>404</code> Not Found Resource doesn't exist <code>409</code> Conflict Resource already exists (duplicate email) <code>500</code> Internal Server Error Server error"},{"location":"api/auth/#common-error-messages","title":"Common Error Messages","text":"<p>Validation Errors: - \"Name is required\" - \"Email must be a valid email\" - \"Password must be at least 8 characters\"</p> <p>Authentication Errors: - \"Invalid email or password\" - \"Unauthorized\" - \"Token expired\"</p> <p>Resource Errors: - \"User not found\" - \"User with this email already exists\" - \"Email already in use\"</p>"},{"location":"api/auth/#security-considerations","title":"Security Considerations","text":""},{"location":"api/auth/#password-requirements","title":"Password Requirements","text":"<ul> <li>Minimum 8 characters</li> <li>Stored using Argon2 hashing</li> <li>Never returned in API responses</li> <li>Cannot be retrieved (only reset)</li> </ul>"},{"location":"api/auth/#cookie-security","title":"Cookie Security","text":"<ul> <li><code>HttpOnly</code>: JavaScript cannot access</li> <li><code>Secure</code>: Only sent over HTTPS (production)</li> <li><code>SameSite=Strict</code>: CSRF protection</li> <li><code>Max-Age=604800</code>: 7 days expiry</li> </ul>"},{"location":"api/auth/#rate-limiting","title":"Rate Limiting","text":"<p>The API Gateway enforces: - 10 requests/second per IP - Burst of 20 for occasional spikes</p> <p>Exceeding limits returns: <pre><code>HTTP 429 Too Many Requests\n</code></pre></p>"},{"location":"api/auth/#best-practices","title":"Best Practices","text":"<ol> <li>Always use HTTPS in production</li> <li>Never log passwords or tokens</li> <li>Validate email format on client side</li> <li>Handle 401 errors by redirecting to login</li> <li>Store cookies securely (browser handles this)</li> </ol>"},{"location":"api/auth/#integration-examples","title":"Integration Examples","text":""},{"location":"api/auth/#javascript-fetch-api","title":"JavaScript (Fetch API)","text":"<pre><code>// Register\nconst response = await fetch('http://localhost/api/v1/auth/signup', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    name: 'John Doe',\n    email: 'john@example.com',\n    password: 'SecurePass123!'\n  })\n});\n\nconst user = await response.json();\n\n// Login\nconst loginResponse = await fetch('http://localhost/api/v1/auth/login', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  credentials: 'include', // Important: Include cookies\n  body: JSON.stringify({\n    email: 'john@example.com',\n    password: 'SecurePass123!'\n  })\n});\n\nconst userData = await loginResponse.json();\n\n// Get current user\nconst userResponse = await fetch('http://localhost/api/v1/auth/user', {\n  credentials: 'include' // Important: Include cookies\n});\n\nconst currentUser = await userResponse.json();\n</code></pre>"},{"location":"api/auth/#python-requests","title":"Python (Requests)","text":"<pre><code>import requests\n\n# Register\nresponse = requests.post('http://localhost/api/v1/auth/signup', json={\n    'name': 'John Doe',\n    'email': 'john@example.com',\n    'password': 'SecurePass123!'\n})\n\nuser = response.json()\n\n# Login\nsession = requests.Session()\nlogin_response = session.post('http://localhost/api/v1/auth/login', json={\n    'email': 'john@example.com',\n    'password': 'SecurePass123!'\n})\n\n# Session automatically includes cookies\nuser_response = session.get('http://localhost/api/v1/auth/user')\ncurrent_user = user_response.json()\n</code></pre>"},{"location":"api/auth/#related-documentation","title":"Related Documentation","text":"<ul> <li>Architecture Overview</li> <li>Wallet API</li> <li>Transactions API</li> <li>Event Architecture</li> </ul>"},{"location":"api/transactions/","title":"Transactions API","text":""},{"location":"api/transactions/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Overview</li> <li>Base URL</li> <li>Authentication</li> <li>Endpoints</li> <li>Create Top-Up Transaction</li> <li>Create Transfer Transaction</li> <li>List Transactions</li> <li>Get Transaction Details</li> <li>Health Check</li> <li>Transaction Object</li> <li>Transaction States</li> <li>Transaction Lifecycle</li> <li>Error Responses</li> <li>Integration Examples</li> </ul>"},{"location":"api/transactions/#overview","title":"Overview","text":"<p>The Transactions API handles financial transactions including top-ups (adding funds) and transfers (sending money between users). Transactions are processed asynchronously through an event-driven workflow.</p>"},{"location":"api/transactions/#key-features","title":"Key Features","text":"<ul> <li>Top-up transactions to add funds</li> <li>Transfer transactions between users</li> <li>Event-driven processing</li> <li>Automatic rollback on failures</li> <li>Transaction history with filtering</li> <li>Idempotency support</li> </ul>"},{"location":"api/transactions/#base-url","title":"Base URL","text":"<pre><code>http://localhost/api/v1/transactions\n</code></pre> <p>All transaction endpoints are prefixed with <code>/api/v1/transactions</code>.</p>"},{"location":"api/transactions/#authentication","title":"Authentication","text":"<p>All transaction endpoints require authentication via HTTP-only cookie.</p> <p>Cookie Name: <code>mint_session</code></p> <p>Example: <pre><code>Cookie: mint_session=&lt;jwt-token&gt;\n</code></pre></p>"},{"location":"api/transactions/#endpoints","title":"Endpoints","text":""},{"location":"api/transactions/#create-top-up-transaction","title":"Create Top-Up Transaction","text":"<p>Add funds to your wallet.</p> <p>Endpoint: <code>POST /api/v1/transactions/topup</code></p> <p>Authentication: Required</p>"},{"location":"api/transactions/#request-body","title":"Request Body","text":"<pre><code>{\n  \"amount\": number,        // Required, &gt; 0\n  \"description\": string    // Optional\n}\n</code></pre>"},{"location":"api/transactions/#validation-rules","title":"Validation Rules","text":"<ul> <li><code>amount</code>: Must be a positive number (&gt; 0)</li> <li><code>description</code>: Optional string, max 500 characters</li> </ul>"},{"location":"api/transactions/#example-request","title":"Example Request","text":"<pre><code>curl -X POST http://localhost/api/v1/transactions/topup \\\n  -H \"Content-Type: application/json\" \\\n  -b cookies.txt \\\n  -d '{\n    \"amount\": 100.00,\n    \"description\": \"Adding funds to wallet\"\n  }'\n</code></pre>"},{"location":"api/transactions/#success-response","title":"Success Response","text":"<p>Code: <code>201 Created</code></p> <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439013\",\n  \"type\": \"topup\",\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"amount\": 100.00,\n  \"description\": \"Adding funds to wallet\",\n  \"status\": \"pending\",\n  \"createdAt\": \"2025-01-15T11:00:00.000Z\"\n}\n</code></pre>"},{"location":"api/transactions/#processing-flow","title":"Processing Flow","text":"<ol> <li>Transaction created with <code>pending</code> status</li> <li><code>transaction.created</code> event published</li> <li>Transaction validated and updated to <code>processing</code></li> <li><code>transaction.completed</code> event published</li> <li>Wallet balance updated</li> <li>Transaction finalized to <code>completed</code></li> <li>Success email sent</li> </ol> <p>Typical processing time: 100-500ms</p>"},{"location":"api/transactions/#error-responses","title":"Error Responses","text":"<p>400 Bad Request - Invalid amount <pre><code>{\n  \"error\": \"Amount must be greater than 0\"\n}\n</code></pre></p> <p>401 Unauthorized - Not logged in <pre><code>{\n  \"error\": \"Unauthorized\"\n}\n</code></pre></p>"},{"location":"api/transactions/#create-transfer-transaction","title":"Create Transfer Transaction","text":"<p>Transfer money to another user.</p> <p>Endpoint: <code>POST /api/v1/transactions/transfer</code></p> <p>Authentication: Required</p>"},{"location":"api/transactions/#request-body_1","title":"Request Body","text":"<pre><code>{\n  \"recipientId\": string,   // Required, valid user ID\n  \"amount\": number,        // Required, &gt; 0\n  \"description\": string    // Optional\n}\n</code></pre>"},{"location":"api/transactions/#validation-rules_1","title":"Validation Rules","text":"<ul> <li><code>recipientId</code>: Must be a valid MongoDB ObjectId of an existing user</li> <li><code>amount</code>: Must be positive (&gt; 0)</li> <li><code>description</code>: Optional string, max 500 characters</li> <li>Sender must have sufficient balance</li> </ul>"},{"location":"api/transactions/#example-request_1","title":"Example Request","text":"<pre><code>curl -X POST http://localhost/api/v1/transactions/transfer \\\n  -H \"Content-Type: application/json\" \\\n  -b cookies.txt \\\n  -d '{\n    \"recipientId\": \"507f1f77bcf86cd799439020\",\n    \"amount\": 50.00,\n    \"description\": \"Payment for services\"\n  }'\n</code></pre>"},{"location":"api/transactions/#success-response_1","title":"Success Response","text":"<p>Code: <code>201 Created</code></p> <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439014\",\n  \"type\": \"transfer\",\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"recipientId\": \"507f1f77bcf86cd799439020\",\n  \"amount\": 50.00,\n  \"description\": \"Payment for services\",\n  \"status\": \"pending\",\n  \"createdAt\": \"2025-01-15T11:15:00.000Z\"\n}\n</code></pre>"},{"location":"api/transactions/#processing-flow_1","title":"Processing Flow","text":"<ol> <li>Transaction created with <code>pending</code> status</li> <li><code>transaction.created</code> event published</li> <li>Sender balance validated</li> <li>If sufficient:</li> <li>Status updated to <code>processing</code></li> <li><code>transaction.completed</code> event published</li> <li>Sender balance decreased</li> <li>Recipient balance increased</li> <li>Status updated to <code>completed</code></li> <li>Success email sent</li> <li>If insufficient:</li> <li><code>transaction.failed</code> event published</li> <li>Status updated to <code>failed</code></li> <li>Failure email sent</li> </ol>"},{"location":"api/transactions/#error-responses_1","title":"Error Responses","text":"<p>400 Bad Request - Invalid recipient or amount <pre><code>{\n  \"error\": \"Recipient ID is required\"\n}\n</code></pre></p> <pre><code>{\n  \"error\": \"Amount must be greater than 0\"\n}\n</code></pre> <p>404 Not Found - Recipient doesn't exist <pre><code>{\n  \"error\": \"Recipient not found\"\n}\n</code></pre></p> <p>400 Bad Request - Insufficient balance (returned later after processing) <pre><code>{\n  \"error\": \"Insufficient balance\",\n  \"details\": {\n    \"required\": 50.00,\n    \"available\": 25.00\n  }\n}\n</code></pre></p> <p>Note: Insufficient balance is detected during async processing, not immediately.</p>"},{"location":"api/transactions/#list-transactions","title":"List Transactions","text":"<p>Retrieve transaction history for the authenticated user.</p> <p>Endpoint: <code>GET /api/v1/transactions</code></p> <p>Authentication: Required</p>"},{"location":"api/transactions/#query-parameters","title":"Query Parameters","text":"Parameter Type Default Description <code>limit</code> number 50 Number of transactions to return (1-100) <code>offset</code> number 0 Number of transactions to skip <code>type</code> string all Filter by type: <code>topup</code>, <code>transfer</code>, or <code>all</code> <code>status</code> string all Filter by status: <code>pending</code>, <code>processing</code>, <code>completed</code>, <code>failed</code>, or <code>all</code>"},{"location":"api/transactions/#example-request_2","title":"Example Request","text":"<pre><code># Get all transactions\ncurl http://localhost/api/v1/transactions \\\n  -b cookies.txt\n\n# Get only completed transfers\ncurl \"http://localhost/api/v1/transactions?type=transfer&amp;status=completed\" \\\n  -b cookies.txt\n\n# Pagination\ncurl \"http://localhost/api/v1/transactions?limit=10&amp;offset=20\" \\\n  -b cookies.txt\n</code></pre>"},{"location":"api/transactions/#success-response_2","title":"Success Response","text":"<p>Code: <code>200 OK</code></p> <pre><code>{\n  \"transactions\": [\n    {\n      \"id\": \"507f1f77bcf86cd799439014\",\n      \"type\": \"transfer\",\n      \"userId\": \"507f1f77bcf86cd799439011\",\n      \"recipientId\": \"507f1f77bcf86cd799439020\",\n      \"amount\": 50.00,\n      \"description\": \"Payment for services\",\n      \"status\": \"completed\",\n      \"createdAt\": \"2025-01-15T11:15:00.000Z\",\n      \"completedAt\": \"2025-01-15T11:15:02.000Z\"\n    },\n    {\n      \"id\": \"507f1f77bcf86cd799439013\",\n      \"type\": \"topup\",\n      \"userId\": \"507f1f77bcf86cd799439011\",\n      \"amount\": 100.00,\n      \"description\": \"Adding funds\",\n      \"status\": \"completed\",\n      \"createdAt\": \"2025-01-15T11:00:00.000Z\",\n      \"completedAt\": \"2025-01-15T11:00:01.000Z\"\n    }\n  ],\n  \"total\": 2,\n  \"limit\": 50,\n  \"offset\": 0\n}\n</code></pre>"},{"location":"api/transactions/#response-fields","title":"Response Fields","text":"Field Description <code>transactions</code> Array of transaction objects <code>total</code> Total number of transactions (for pagination) <code>limit</code> Number of transactions returned <code>offset</code> Number of transactions skipped"},{"location":"api/transactions/#sorting","title":"Sorting","text":"<p>Transactions are sorted by <code>createdAt</code> in descending order (newest first).</p>"},{"location":"api/transactions/#get-transaction-details","title":"Get Transaction Details","text":"<p>Retrieve details of a specific transaction.</p> <p>Endpoint: <code>GET /api/v1/transactions/:id</code></p> <p>Authentication: Required</p>"},{"location":"api/transactions/#path-parameters","title":"Path Parameters","text":"Parameter Type Description <code>id</code> string Transaction's MongoDB ObjectId"},{"location":"api/transactions/#example-request_3","title":"Example Request","text":"<pre><code>curl http://localhost/api/v1/transactions/507f1f77bcf86cd799439013 \\\n  -b cookies.txt\n</code></pre>"},{"location":"api/transactions/#success-response_3","title":"Success Response","text":"<p>Code: <code>200 OK</code></p> <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439013\",\n  \"type\": \"topup\",\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"amount\": 100.00,\n  \"description\": \"Adding funds\",\n  \"status\": \"completed\",\n  \"createdAt\": \"2025-01-15T11:00:00.000Z\",\n  \"completedAt\": \"2025-01-15T11:00:01.000Z\"\n}\n</code></pre>"},{"location":"api/transactions/#authorization","title":"Authorization","text":"<p>Users can only view their own transactions (where they are sender or recipient).</p>"},{"location":"api/transactions/#error-responses_2","title":"Error Responses","text":"<p>404 Not Found - Transaction doesn't exist or user doesn't have access <pre><code>{\n  \"error\": \"Transaction not found\"\n}\n</code></pre></p>"},{"location":"api/transactions/#health-check","title":"Health Check","text":"<p>Check if the transactions service is healthy.</p> <p>Endpoint: <code>GET /api/v1/transactions/health</code></p> <p>Authentication: None required</p>"},{"location":"api/transactions/#example-request_4","title":"Example Request","text":"<pre><code>curl http://localhost/api/v1/transactions/health\n</code></pre>"},{"location":"api/transactions/#success-response_4","title":"Success Response","text":"<p>Code: <code>200 OK</code></p> <pre><code>{\n  \"status\": \"healthy\",\n  \"service\": \"transactions-service\",\n  \"timestamp\": \"2025-01-15T10:30:00.000Z\"\n}\n</code></pre>"},{"location":"api/transactions/#transaction-object","title":"Transaction Object","text":""},{"location":"api/transactions/#transaction-schema","title":"Transaction Schema","text":"<pre><code>{\n  id: string;              // MongoDB ObjectId\n  type: 'topup' | 'transfer';\n  userId: string;          // Sender/initiator\n  recipientId?: string;    // Only for transfers\n  amount: number;          // Transaction amount\n  description?: string;    // Optional description\n  status: 'pending' | 'processing' | 'completed' | 'failed';\n  createdAt: Date;\n  completedAt?: Date;      // When finalized\n  failedAt?: Date;         // If failed\n  failureReason?: string;  // Why it failed\n}\n</code></pre>"},{"location":"api/transactions/#field-details","title":"Field Details","text":"<p>type: - <code>topup</code>: Add funds to own wallet - <code>transfer</code>: Send funds to another user</p> <p>userId: - For top-up: The user adding funds - For transfer: The sender</p> <p>recipientId: - Only present for transfers - The user receiving funds</p> <p>status: - <code>pending</code>: Just created, queued - <code>processing</code>: Being processed - <code>completed</code>: Successfully finished - <code>failed</code>: Failed (insufficient balance, etc.)</p> <p>amount: - Always positive - Stored as number with 2 decimal precision - Represents the transaction amount</p>"},{"location":"api/transactions/#transaction-states","title":"Transaction States","text":""},{"location":"api/transactions/#state-diagram","title":"State Diagram","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 PENDING \u2502  Created and queued\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 PROCESSING \u2502  Being validated\n\u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n      \u2502\n      \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n      \u2502              \u2502\n      \u25bc              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 COMPLETED \u2502  \u2502 FAILED  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"api/transactions/#state-descriptions","title":"State Descriptions","text":"<p>PENDING - Transaction just created - Queued for processing - Not yet validated - User sees this immediately after creation</p> <p>PROCESSING - Being validated - Balance checks happening - Wallet updates in progress - Typically lasts 100-500ms</p> <p>COMPLETED - Successfully processed - Wallet balances updated - Confirmation email sent - Terminal state (won't change)</p> <p>FAILED - Validation or processing failed - Common reasons:   - Insufficient balance   - Recipient doesn't exist   - System error - Failure email sent - Terminal state (won't change)</p>"},{"location":"api/transactions/#transaction-lifecycle","title":"Transaction Lifecycle","text":""},{"location":"api/transactions/#top-up-lifecycle","title":"Top-Up Lifecycle","text":"<pre><code>1. Client \u2192 POST /transactions/topup\n2. Create transaction (PENDING)\n3. Publish transaction.created event\n4. Return to client \u2705\n\n--- Async Processing Begins ---\n\n5. Consume transaction.created\n6. Validate transaction\n7. Update status (PROCESSING)\n8. Publish transaction.completed\n9. Wallet consumes event\n10. Wallet increases balance\n11. Wallet publishes wallet.transactionFinalized\n12. Transaction consumes event\n13. Update status (COMPLETED)\n14. Notification service sends email\n</code></pre>"},{"location":"api/transactions/#transfer-lifecycle-success","title":"Transfer Lifecycle (Success)","text":"<pre><code>1. Client \u2192 POST /transactions/transfer\n2. Create transaction (PENDING)\n3. Publish transaction.created event\n4. Return to client \u2705\n\n--- Async Processing Begins ---\n\n5. Consume transaction.created\n6. Validate sender balance\n7. Sufficient balance \u2713\n8. Update status (PROCESSING)\n9. Publish transaction.completed\n10. Wallet consumes event\n11. Wallet decreases sender balance\n12. Wallet increases recipient balance\n13. Wallet publishes wallet.transactionFinalized\n14. Transaction consumes event\n15. Update status (COMPLETED)\n16. Notification service sends emails\n</code></pre>"},{"location":"api/transactions/#transfer-lifecycle-failure","title":"Transfer Lifecycle (Failure)","text":"<pre><code>1. Client \u2192 POST /transactions/transfer\n2. Create transaction (PENDING)\n3. Publish transaction.created event\n4. Return to client \u2705\n\n--- Async Processing Begins ---\n\n5. Consume transaction.created\n6. Validate sender balance\n7. Insufficient balance \u2717\n8. Publish transaction.failed\n9. Wallet consumes event (revert if needed)\n10. Update status (FAILED)\n11. Notification service sends failure email\n</code></pre>"},{"location":"api/transactions/#error-responses_3","title":"Error Responses","text":""},{"location":"api/transactions/#standard-error-format","title":"Standard Error Format","text":"<pre><code>{\n  \"error\": \"Error message\",\n  \"details\": {}  // Optional additional info\n}\n</code></pre>"},{"location":"api/transactions/#http-status-codes","title":"HTTP Status Codes","text":"Code Meaning When <code>200</code> OK List/get succeeded <code>201</code> Created Transaction created <code>400</code> Bad Request Validation error <code>401</code> Unauthorized Not authenticated <code>404</code> Not Found Transaction/recipient not found <code>500</code> Internal Server Error Server error"},{"location":"api/transactions/#common-errors","title":"Common Errors","text":"<p>Validation Errors: <pre><code>{\n  \"error\": \"Amount must be greater than 0\"\n}\n</code></pre></p> <pre><code>{\n  \"error\": \"Recipient ID is required\"\n}\n</code></pre> <p>Not Found: <pre><code>{\n  \"error\": \"Recipient not found\"\n}\n</code></pre></p> <p>Insufficient Balance (async, check transaction status): <pre><code>{\n  \"error\": \"Insufficient balance\",\n  \"details\": {\n    \"required\": 50.00,\n    \"available\": 25.00\n  }\n}\n</code></pre></p>"},{"location":"api/transactions/#integration-examples","title":"Integration Examples","text":""},{"location":"api/transactions/#javascript-fetch-api","title":"JavaScript (Fetch API)","text":"<pre><code>// Top-up\nasync function topUp(amount, description) {\n  const response = await fetch('http://localhost/api/v1/transactions/topup', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    credentials: 'include',\n    body: JSON.stringify({ amount, description })\n  });\n\n  const transaction = await response.json();\n  return transaction;\n}\n\n// Transfer\nasync function transfer(recipientId, amount, description) {\n  const response = await fetch('http://localhost/api/v1/transactions/transfer', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    credentials: 'include',\n    body: JSON.stringify({ recipientId, amount, description })\n  });\n\n  const transaction = await response.json();\n  return transaction;\n}\n\n// List transactions\nasync function getTransactions(filters = {}) {\n  const params = new URLSearchParams(filters);\n  const response = await fetch(\n    `http://localhost/api/v1/transactions?${params}`,\n    { credentials: 'include' }\n  );\n\n  const data = await response.json();\n  return data.transactions;\n}\n\n// Usage\nconst transaction = await topUp(100, 'Adding funds');\nconsole.log(`Transaction ${transaction.id} created with status: ${transaction.status}`);\n\n// Wait for completion\nawait new Promise(resolve =&gt; setTimeout(resolve, 1000));\n\n// Check status\nconst updated = await fetch(`http://localhost/api/v1/transactions/${transaction.id}`, {\n  credentials: 'include'\n}).then(r =&gt; r.json());\n\nconsole.log(`Status: ${updated.status}`);\n</code></pre>"},{"location":"api/transactions/#react-component-example","title":"React Component Example","text":"<pre><code>import { useState } from 'react';\n\nfunction TransferForm() {\n  const [recipientId, setRecipientId] = useState('');\n  const [amount, setAmount] = useState('');\n  const [description, setDescription] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n\n  const handleSubmit = async (e) =&gt; {\n    e.preventDefault();\n    setLoading(true);\n    setError('');\n\n    try {\n      const response = await fetch('http://localhost/api/v1/transactions/transfer', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({\n          recipientId,\n          amount: parseFloat(amount),\n          description\n        })\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error);\n      }\n\n      const transaction = await response.json();\n      alert(`Transaction created: ${transaction.id}`);\n\n      // Reset form\n      setRecipientId('');\n      setAmount('');\n      setDescription('');\n    } catch (err) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    &lt;form onSubmit={handleSubmit}&gt;\n      &lt;input\n        placeholder=\"Recipient ID\"\n        value={recipientId}\n        onChange={(e) =&gt; setRecipientId(e.target.value)}\n        required\n      /&gt;\n\n      &lt;input\n        type=\"number\"\n        placeholder=\"Amount\"\n        value={amount}\n        onChange={(e) =&gt; setAmount(e.target.value)}\n        min=\"0.01\"\n        step=\"0.01\"\n        required\n      /&gt;\n\n      &lt;input\n        placeholder=\"Description (optional)\"\n        value={description}\n        onChange={(e) =&gt; setDescription(e.target.value)}\n      /&gt;\n\n      &lt;button type=\"submit\" disabled={loading}&gt;\n        {loading ? 'Processing...' : 'Send Money'}\n      &lt;/button&gt;\n\n      {error &amp;&amp; &lt;div className=\"error\"&gt;{error}&lt;/div&gt;}\n    &lt;/form&gt;\n  );\n}\n</code></pre>"},{"location":"api/transactions/#python-requests","title":"Python (Requests)","text":"<pre><code>import requests\nimport time\n\nsession = requests.Session()\n\n# Login\nsession.post('http://localhost/api/v1/auth/login', json={\n    'email': 'john@example.com',\n    'password': 'SecurePass123!'\n})\n\n# Top-up\nresponse = session.post('http://localhost/api/v1/transactions/topup', json={\n    'amount': 100.00,\n    'description': 'Adding funds'\n})\n\ntransaction = response.json()\nprint(f\"Created transaction: {transaction['id']}\")\nprint(f\"Status: {transaction['status']}\")\n\n# Wait for processing\ntime.sleep(1)\n\n# Check status\nupdated = session.get(f\"http://localhost/api/v1/transactions/{transaction['id']}\")\nprint(f\"Updated status: {updated.json()['status']}\")\n\n# List transactions\ntransactions = session.get('http://localhost/api/v1/transactions').json()\nprint(f\"Total transactions: {transactions['total']}\")\n</code></pre>"},{"location":"api/transactions/#best-practices","title":"Best Practices","text":""},{"location":"api/transactions/#1-wait-for-completion","title":"1. Wait for Completion","text":"<pre><code>// \u2705 Good: Wait and check status\nconst transaction = await createTransaction();\nawait new Promise(resolve =&gt; setTimeout(resolve, 1000));\nconst updated = await getTransaction(transaction.id);\n\nif (updated.status === 'completed') {\n  showSuccess();\n} else if (updated.status === 'failed') {\n  showError(updated.failureReason);\n}\n\n// \u274c Bad: Assume immediate completion\nconst transaction = await createTransaction();\nshowSuccess(); // Transaction might still be pending!\n</code></pre>"},{"location":"api/transactions/#2-handle-async-nature","title":"2. Handle Async Nature","text":"<pre><code>// Poll for status\nasync function waitForCompletion(transactionId) {\n  for (let i = 0; i &lt; 10; i++) {\n    const tx = await getTransaction(transactionId);\n\n    if (tx.status === 'completed' || tx.status === 'failed') {\n      return tx;\n    }\n\n    await new Promise(resolve =&gt; setTimeout(resolve, 500));\n  }\n\n  throw new Error('Transaction timeout');\n}\n</code></pre>"},{"location":"api/transactions/#3-validate-before-sending","title":"3. Validate Before Sending","text":"<pre><code>// Check balance before transfer\nconst wallet = await getWallet();\n\nif (wallet.balance &lt; amount) {\n  alert('Insufficient balance');\n  return;\n}\n\nawait createTransfer(recipientId, amount);\n</code></pre>"},{"location":"api/transactions/#4-display-amount-correctly","title":"4. Display Amount Correctly","text":"<pre><code>// Always format to 2 decimal places\nconst formatted = `$${transaction.amount.toFixed(2)}`;\n</code></pre>"},{"location":"api/transactions/#5-handle-errors-gracefully","title":"5. Handle Errors Gracefully","text":"<pre><code>try {\n  await createTransaction();\n} catch (error) {\n  if (error.message.includes('Insufficient balance')) {\n    alert('You don't have enough funds');\n  } else if (error.message.includes('Recipient not found')) {\n    alert('Invalid recipient ID');\n  } else {\n    alert('Transaction failed. Please try again.');\n  }\n}\n</code></pre>"},{"location":"api/transactions/#security-considerations","title":"Security Considerations","text":"<ul> <li>Authorization: Users can only create transactions for themselves</li> <li>Balance Validation: Checked before transfers</li> <li>Idempotency: Duplicate submissions create separate transactions (future: add idempotency keys)</li> <li>Rate Limiting: Enforced at API gateway level</li> </ul>"},{"location":"api/transactions/#related-documentation","title":"Related Documentation","text":"<ul> <li>Authentication API - Login and user management</li> <li>Wallet API - Check balance</li> <li>Event Architecture - Transaction processing flow</li> <li>Architecture Overview - System design</li> </ul>"},{"location":"api/wallet/","title":"Wallet API","text":""},{"location":"api/wallet/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Overview</li> <li>Base URL</li> <li>Authentication</li> <li>Endpoints</li> <li>Get User Wallet</li> <li>Health Check</li> <li>Wallet Object</li> <li>Error Responses</li> <li>Integration Examples</li> </ul>"},{"location":"api/wallet/#overview","title":"Overview","text":"<p>The Wallet API manages user wallet balances and transaction history. Wallets are automatically created when users register, and balances are updated through the event-driven transaction system.</p>"},{"location":"api/wallet/#key-features","title":"Key Features","text":"<ul> <li>Automatic wallet creation on user signup</li> <li>Real-time balance updates via events</li> <li>Optimistic locking for concurrent transactions</li> <li>Automatic rollback on failed transactions</li> <li>Balance integrity guarantees</li> </ul>"},{"location":"api/wallet/#base-url","title":"Base URL","text":"<pre><code>http://localhost/api/v1/wallet\n</code></pre> <p>All wallet endpoints are prefixed with <code>/api/v1/wallet</code>.</p>"},{"location":"api/wallet/#authentication","title":"Authentication","text":"<p>All wallet endpoints require authentication via HTTP-only cookie.</p> <p>Cookie Name: <code>mint_session</code></p> <p>Example: <pre><code>Cookie: mint_session=&lt;jwt-token&gt;\n</code></pre></p> <p>The JWT token is obtained by logging in through the Auth API.</p>"},{"location":"api/wallet/#endpoints","title":"Endpoints","text":""},{"location":"api/wallet/#get-user-wallet","title":"Get User Wallet","text":"<p>Retrieve the authenticated user's wallet information.</p> <p>Endpoint: <code>GET /api/v1/wallet/user</code></p> <p>Authentication: Required</p>"},{"location":"api/wallet/#example-request","title":"Example Request","text":"<pre><code>curl http://localhost/api/v1/wallet/user \\\n  -b cookies.txt\n</code></pre>"},{"location":"api/wallet/#success-response","title":"Success Response","text":"<p>Code: <code>200 OK</code></p> <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439012\",\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"balance\": 150.00,\n  \"createdAt\": \"2025-01-15T10:30:05.000Z\",\n  \"updatedAt\": \"2025-01-15T12:45:30.000Z\"\n}\n</code></pre>"},{"location":"api/wallet/#response-fields","title":"Response Fields","text":"Field Type Description <code>id</code> string Wallet's unique identifier <code>userId</code> string User who owns the wallet <code>balance</code> number Current balance (always &gt;= 0) <code>createdAt</code> string ISO 8601 timestamp of creation <code>updatedAt</code> string ISO 8601 timestamp of last update"},{"location":"api/wallet/#balance-precision","title":"Balance Precision","text":"<ul> <li>Stored as floating-point number</li> <li>2 decimal places for currency</li> <li>Minimum: <code>0.00</code></li> <li>Maximum: No limit (in practice, JavaScript safe integer limit)</li> </ul>"},{"location":"api/wallet/#error-responses","title":"Error Responses","text":"<p>401 Unauthorized - Not logged in <pre><code>{\n  \"error\": \"Unauthorized\"\n}\n</code></pre></p> <p>404 Not Found - Wallet not found (shouldn't happen if user exists) <pre><code>{\n  \"error\": \"Wallet not found\"\n}\n</code></pre></p>"},{"location":"api/wallet/#health-check","title":"Health Check","text":"<p>Check if the wallet service is healthy.</p> <p>Endpoint: <code>GET /api/v1/wallet/health</code></p> <p>Authentication: None required</p>"},{"location":"api/wallet/#example-request_1","title":"Example Request","text":"<pre><code>curl http://localhost/api/v1/wallet/health\n</code></pre>"},{"location":"api/wallet/#success-response_1","title":"Success Response","text":"<p>Code: <code>200 OK</code></p> <pre><code>{\n  \"status\": \"healthy\",\n  \"service\": \"wallet-service\",\n  \"timestamp\": \"2025-01-15T10:30:00.000Z\"\n}\n</code></pre>"},{"location":"api/wallet/#wallet-object","title":"Wallet Object","text":""},{"location":"api/wallet/#wallet-schema","title":"Wallet Schema","text":"<pre><code>{\n  id: string;           // MongoDB ObjectId\n  userId: string;       // Reference to User\n  balance: number;      // Current balance\n  createdAt: Date;      // Creation timestamp\n  updatedAt: Date;      // Last update timestamp\n  version: number;      // For optimistic locking (internal)\n}\n</code></pre>"},{"location":"api/wallet/#wallet-lifecycle","title":"Wallet Lifecycle","text":"<ol> <li>Creation</li> <li>Triggered by <code>user.signup</code> event</li> <li>Initial balance: <code>0.00</code> (configurable via <code>INITIAL_WALLET_BALANCE</code>)</li> <li> <p>Happens asynchronously after user registration</p> </li> <li> <p>Updates</p> </li> <li>Top-up: Balance increases</li> <li>Transfer (sender): Balance decreases</li> <li>Transfer (recipient): Balance increases</li> <li> <p>All updates are event-driven</p> </li> <li> <p>Constraints</p> </li> <li>Balance cannot go negative</li> <li>Concurrent updates handled with optimistic locking</li> <li>Updates are atomic</li> </ol>"},{"location":"api/wallet/#balance-updates","title":"Balance Updates","text":"<p>Balance updates happen through the event system, not direct API calls.</p>"},{"location":"api/wallet/#update-flow","title":"Update Flow","text":"<pre><code>1. User creates transaction via Transactions API\n2. Transaction service publishes transaction.completed\n3. Wallet service consumes event\n4. Wallet service updates balance(s)\n5. Wallet service publishes wallet.transactionFinalized\n</code></pre>"},{"location":"api/wallet/#concurrency-handling","title":"Concurrency Handling","text":"<p>The wallet service uses optimistic locking to handle concurrent transactions:</p> <pre><code>// Pseudocode\nasync function updateBalance(userId, amount) {\n  const wallet = await Wallet.findOne({ userId });\n\n  // Update with version check\n  const result = await Wallet.updateOne(\n    { _id: wallet.id, version: wallet.version },\n    {\n      balance: wallet.balance + amount,\n      version: wallet.version + 1\n    }\n  );\n\n  if (result.modifiedCount === 0) {\n    // Version conflict - retry\n    throw new ConcurrencyError();\n  }\n}\n</code></pre>"},{"location":"api/wallet/#balance-validation","title":"Balance Validation","text":"<ul> <li>Before Transfer: Transaction service validates sender has sufficient balance</li> <li>During Update: Wallet service ensures balance &gt;= 0</li> <li>After Update: Balance is never negative</li> </ul>"},{"location":"api/wallet/#error-responses_1","title":"Error Responses","text":""},{"location":"api/wallet/#standard-error-format","title":"Standard Error Format","text":"<pre><code>{\n  \"error\": \"Error message\"\n}\n</code></pre>"},{"location":"api/wallet/#http-status-codes","title":"HTTP Status Codes","text":"Code Meaning When <code>200</code> OK Request succeeded <code>401</code> Unauthorized Missing/invalid authentication <code>404</code> Not Found Wallet doesn't exist <code>500</code> Internal Server Error Server error"},{"location":"api/wallet/#common-errors","title":"Common Errors","text":"<p>Wallet Not Found: <pre><code>{\n  \"error\": \"Wallet not found\"\n}\n</code></pre></p> <p>Unauthorized: <pre><code>{\n  \"error\": \"Unauthorized\"\n}\n</code></pre></p>"},{"location":"api/wallet/#integration-examples","title":"Integration Examples","text":""},{"location":"api/wallet/#javascript-fetch-api","title":"JavaScript (Fetch API)","text":"<pre><code>// Get wallet\nconst response = await fetch('http://localhost/api/v1/wallet/user', {\n  credentials: 'include' // Include auth cookie\n});\n\nconst wallet = await response.json();\nconsole.log(`Balance: $${wallet.balance}`);\n\n// Poll for balance updates (simple approach)\nasync function pollBalance() {\n  const response = await fetch('http://localhost/api/v1/wallet/user', {\n    credentials: 'include'\n  });\n  const wallet = await response.json();\n  updateUI(wallet.balance);\n}\n\n// Poll every 5 seconds\nsetInterval(pollBalance, 5000);\n</code></pre>"},{"location":"api/wallet/#react-hook-example","title":"React Hook Example","text":"<pre><code>import { useState, useEffect } from 'react';\n\ninterface Wallet {\n  id: string;\n  userId: string;\n  balance: number;\n  createdAt: string;\n  updatedAt: string;\n}\n\nfunction useWallet() {\n  const [wallet, setWallet] = useState&lt;Wallet | null&gt;(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  const fetchWallet = async () =&gt; {\n    try {\n      const response = await fetch('http://localhost/api/v1/wallet/user', {\n        credentials: 'include'\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to fetch wallet');\n      }\n\n      const data = await response.json();\n      setWallet(data);\n      setError(null);\n    } catch (err) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() =&gt; {\n    fetchWallet();\n\n    // Poll every 5 seconds\n    const interval = setInterval(fetchWallet, 5000);\n\n    return () =&gt; clearInterval(interval);\n  }, []);\n\n  return { wallet, loading, error, refetch: fetchWallet };\n}\n\n// Usage\nfunction WalletDisplay() {\n  const { wallet, loading, error } = useWallet();\n\n  if (loading) return &lt;div&gt;Loading...&lt;/div&gt;;\n  if (error) return &lt;div&gt;Error: {error}&lt;/div&gt;;\n  if (!wallet) return null;\n\n  return (\n    &lt;div&gt;\n      &lt;h2&gt;Your Balance&lt;/h2&gt;\n      &lt;p&gt;${wallet.balance.toFixed(2)}&lt;/p&gt;\n    &lt;/div&gt;\n  );\n}\n</code></pre>"},{"location":"api/wallet/#python-requests","title":"Python (Requests)","text":"<pre><code>import requests\n\nsession = requests.Session()\n\n# Login first\nsession.post('http://localhost/api/v1/auth/login', json={\n    'email': 'john@example.com',\n    'password': 'SecurePass123!'\n})\n\n# Get wallet\nresponse = session.get('http://localhost/api/v1/wallet/user')\nwallet = response.json()\n\nprint(f\"Balance: ${wallet['balance']:.2f}\")\n</code></pre>"},{"location":"api/wallet/#curl-complete-flow","title":"cURL Complete Flow","text":"<pre><code># 1. Login\ncurl -X POST http://localhost/api/v1/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"john@example.com\",\n    \"password\": \"SecurePass123!\"\n  }' \\\n  -c cookies.txt\n\n# 2. Get wallet\ncurl http://localhost/api/v1/wallet/user \\\n  -b cookies.txt\n\n# 3. Top-up wallet\ncurl -X POST http://localhost/api/v1/transactions/topup \\\n  -H \"Content-Type: application/json\" \\\n  -b cookies.txt \\\n  -d '{\n    \"amount\": 100.00,\n    \"description\": \"Adding funds\"\n  }'\n\n# 4. Wait a moment for async processing\n\n# 5. Check updated balance\ncurl http://localhost/api/v1/wallet/user \\\n  -b cookies.txt\n</code></pre>"},{"location":"api/wallet/#real-time-updates","title":"Real-Time Updates","text":"<p>The wallet balance updates asynchronously. Here are strategies for keeping the UI in sync:</p>"},{"location":"api/wallet/#1-polling-simple","title":"1. Polling (Simple)","text":"<pre><code>// Poll every 5 seconds\nsetInterval(async () =&gt; {\n  const wallet = await fetchWallet();\n  updateUI(wallet.balance);\n}, 5000);\n</code></pre> <p>Pros: Simple, works everywhere Cons: Delayed updates, unnecessary requests</p>"},{"location":"api/wallet/#2-optimistic-updates-recommended","title":"2. Optimistic Updates (Recommended)","text":"<pre><code>async function topUp(amount) {\n  // Update UI immediately\n  setBalance(prevBalance =&gt; prevBalance + amount);\n\n  // Create transaction\n  await fetch('/api/v1/transactions/topup', {\n    method: 'POST',\n    body: JSON.stringify({ amount })\n  });\n\n  // Refresh after a delay\n  setTimeout(async () =&gt; {\n    const wallet = await fetchWallet();\n    setBalance(wallet.balance); // Sync with server\n  }, 2000);\n}\n</code></pre> <p>Pros: Immediate feedback, better UX Cons: Briefly out of sync</p>"},{"location":"api/wallet/#3-websockets-future-enhancement","title":"3. WebSockets (Future Enhancement)","text":"<pre><code>// Future: Real-time updates via WebSocket\nconst ws = new WebSocket('ws://localhost/wallet/updates');\n\nws.on('balance_updated', (data) =&gt; {\n  setBalance(data.newBalance);\n});\n</code></pre> <p>Pros: Real-time, efficient Cons: Requires WebSocket support (future feature)</p>"},{"location":"api/wallet/#best-practices","title":"Best Practices","text":""},{"location":"api/wallet/#1-handle-loading-states","title":"1. Handle Loading States","text":"<pre><code>if (loading) {\n  return &lt;Spinner /&gt;;\n}\n</code></pre>"},{"location":"api/wallet/#2-display-balance-correctly","title":"2. Display Balance Correctly","text":"<pre><code>// Always format to 2 decimal places\nconst formatted = wallet.balance.toFixed(2);\n</code></pre>"},{"location":"api/wallet/#3-refresh-after-transactions","title":"3. Refresh After Transactions","text":"<pre><code>await createTransaction();\nawait new Promise(resolve =&gt; setTimeout(resolve, 1000)); // Wait 1s\nawait refreshWallet(); // Get updated balance\n</code></pre>"},{"location":"api/wallet/#4-handle-errors-gracefully","title":"4. Handle Errors Gracefully","text":"<pre><code>try {\n  const wallet = await fetchWallet();\n} catch (error) {\n  if (error.status === 401) {\n    redirectToLogin();\n  } else {\n    showErrorMessage('Failed to load wallet');\n  }\n}\n</code></pre>"},{"location":"api/wallet/#5-cache-wallet-data","title":"5. Cache Wallet Data","text":"<pre><code>// Don't fetch on every render\nconst { data: wallet } = useQuery('wallet', fetchWallet, {\n  staleTime: 5000, // Cache for 5 seconds\n  refetchInterval: 10000 // Refresh every 10 seconds\n});\n</code></pre>"},{"location":"api/wallet/#limitations","title":"Limitations","text":""},{"location":"api/wallet/#current-limitations","title":"Current Limitations","text":"<ol> <li>No Transaction History: Use Transactions API for history</li> <li>Single Currency: Only one balance per user (no multi-currency)</li> <li>No Manual Balance Adjustment: Balances only change via transactions</li> <li>No Balance Locks: Cannot lock funds for pending transactions</li> </ol>"},{"location":"api/wallet/#future-enhancements","title":"Future Enhancements","text":"<ul> <li>[ ] Transaction history in wallet response</li> <li>[ ] Multi-currency support</li> <li>[ ] Balance holds for pending transactions</li> <li>[ ] WebSocket real-time updates</li> <li>[ ] Wallet statements/exports</li> </ul>"},{"location":"api/wallet/#security-considerations","title":"Security Considerations","text":""},{"location":"api/wallet/#authentication_1","title":"Authentication","text":"<ul> <li>All endpoints require valid JWT token</li> <li>Tokens expire after 7 days</li> <li>Users can only access their own wallet</li> </ul>"},{"location":"api/wallet/#authorization","title":"Authorization","text":"<ul> <li>No cross-user wallet access</li> <li>Admin endpoints not yet implemented</li> <li>Balance cannot be directly modified (only via transactions)</li> </ul>"},{"location":"api/wallet/#data-validation","title":"Data Validation","text":"<ul> <li>Balance is always non-negative</li> <li>Concurrent updates are handled safely</li> <li>Version conflicts are retried automatically</li> </ul>"},{"location":"api/wallet/#troubleshooting","title":"Troubleshooting","text":""},{"location":"api/wallet/#wallet-not-found","title":"Wallet Not Found","text":"<p>Problem: <code>404 Wallet not found</code></p> <p>Cause: Wallet creation event may not have processed yet</p> <p>Solution: - Wait a few seconds after signup - Check RabbitMQ for pending messages - Verify wallet service is running</p>"},{"location":"api/wallet/#balance-not-updating","title":"Balance Not Updating","text":"<p>Problem: Balance hasn't changed after transaction</p> <p>Cause: Async event processing delay</p> <p>Solution: - Wait 1-2 seconds for events to process - Check transaction status via Transactions API - Verify wallet service is consuming events</p>"},{"location":"api/wallet/#unauthorized-errors","title":"Unauthorized Errors","text":"<p>Problem: <code>401 Unauthorized</code></p> <p>Cause: Missing or expired JWT token</p> <p>Solution: - Login again to get fresh token - Ensure cookies are enabled - Check token expiration (7 days)</p>"},{"location":"api/wallet/#related-documentation","title":"Related Documentation","text":"<ul> <li>Authentication API - Login and user management</li> <li>Transactions API - Create transactions</li> <li>Event Architecture - How balance updates work</li> <li>Architecture Overview - System design</li> </ul>"},{"location":"getting-started/configuration/","title":"Configuration Guide","text":"<p>This guide covers advanced configuration options for Mint services.</p>"},{"location":"getting-started/configuration/#environment-variables","title":"Environment Variables","text":"<p>Each service uses environment variables for configuration. All settings can be customized via <code>.env.docker</code> (production) or <code>.env.local</code> (development) files.</p>"},{"location":"getting-started/configuration/#auth-service-configuration","title":"Auth Service Configuration","text":""},{"location":"getting-started/configuration/#required-variables","title":"Required Variables","text":"Variable Description Example <code>NODE_ENV</code> Environment mode <code>production</code>, <code>development</code> <code>PORT</code> Service port <code>4001</code> <code>DATABASE_URL</code> MongoDB connection string <code>mongodb://root:example@mongodb:27017/mint_auth?authSource=admin</code> <code>RABBITMQ_URL</code> RabbitMQ connection string <code>amqp://guest:guest@rabbitmq:5672</code>"},{"location":"getting-started/configuration/#jwt-configuration","title":"JWT Configuration","text":"Variable Description Default <code>JWT_ISS</code> JWT issuer <code>\"auth-service\"</code> <code>JWT_AUD</code> JWT audience (space-separated) <code>\"wallet-service transaction-service notification-service\"</code>"},{"location":"getting-started/configuration/#cors-configuration","title":"CORS Configuration","text":"Variable Description Default <code>CORS_ORIGIN</code> Allowed CORS origins (comma-separated) <code>*</code>"},{"location":"getting-started/configuration/#rate-limiting","title":"Rate Limiting","text":"Variable Description Default <code>RATE_LIMIT_WINDOW_MS</code> Time window in milliseconds <code>900000</code> (15 min) <code>RATE_LIMIT_MAX</code> Max requests per window <code>100</code>"},{"location":"getting-started/configuration/#wallet-service-configuration","title":"Wallet Service Configuration","text":""},{"location":"getting-started/configuration/#required-variables_1","title":"Required Variables","text":"Variable Description Example <code>NODE_ENV</code> Environment mode <code>production</code> <code>PORT</code> Service port <code>4003</code> <code>DATABASE_URL</code> MongoDB connection string <code>mongodb://root:example@mongodb:27017/mint_wallet?authSource=admin</code> <code>RABBITMQ_URL</code> RabbitMQ connection string <code>amqp://guest:guest@rabbitmq:5672</code> <code>JWKS_ENDPOINT</code> Auth service JWKS URL <code>http://auth:4001/.well-known/jwks.json</code>"},{"location":"getting-started/configuration/#jwt-configuration_1","title":"JWT Configuration","text":"Variable Description Default <code>JWT_ISS</code> Expected JWT issuer <code>\"auth-service\"</code> <code>JWT_AUD</code> Expected JWT audience <code>\"wallet-service\"</code>"},{"location":"getting-started/configuration/#transactions-service-configuration","title":"Transactions Service Configuration","text":""},{"location":"getting-started/configuration/#required-variables_2","title":"Required Variables","text":"Variable Description Example <code>NODE_ENV</code> Environment mode <code>production</code> <code>PORT</code> Service port <code>4004</code> <code>DATABASE_URL</code> MongoDB connection string <code>mongodb://root:example@mongodb:27017/mint_txns?authSource=admin</code> <code>RABBITMQ_URL</code> RabbitMQ connection string <code>amqp://guest:guest@rabbitmq:5672</code> <code>JWKS_ENDPOINT</code> Auth service JWKS URL <code>http://auth:4001/.well-known/jwks.json</code>"},{"location":"getting-started/configuration/#jwt-configuration_2","title":"JWT Configuration","text":"Variable Description Default <code>JWT_ISS</code> Expected JWT issuer <code>\"auth-service\"</code> <code>JWT_AUD</code> Expected JWT audience <code>\"transaction-service\"</code>"},{"location":"getting-started/configuration/#notifications-service-configuration","title":"Notifications Service Configuration","text":""},{"location":"getting-started/configuration/#required-variables_3","title":"Required Variables","text":"Variable Description Example <code>NODE_ENV</code> Environment mode <code>production</code> <code>PORT</code> Service port <code>4002</code> <code>RABBITMQ_URL</code> RabbitMQ connection string <code>amqp://guest:guest@rabbitmq:5672</code>"},{"location":"getting-started/configuration/#smtp-configuration","title":"SMTP Configuration","text":"Variable Description Example <code>SMTP_HOST</code> SMTP server hostname <code>sandbox.smtp.mailtrap.io</code> <code>SMTP_PORT</code> SMTP server port <code>2525</code> <code>SMTP_USER</code> SMTP username <code>your-mailtrap-user</code> <code>SMTP_PASS</code> SMTP password <code>your-mailtrap-password</code> <p>Email Testing</p> <p>For development, use Mailtrap to test email notifications without sending real emails.</p>"},{"location":"getting-started/configuration/#docker-environment","title":"Docker Environment","text":""},{"location":"getting-started/configuration/#development-vs-production","title":"Development vs Production","text":"<p>Development (<code>docker-compose.dev.yml</code>): - Hot-reloading enabled - Volume mounts for source code - Debug logging - Service ports exposed</p> <p>Production (<code>docker-compose.yml</code>): - Optimized builds - No volume mounts - Production logging - Only gateway port exposed</p>"},{"location":"getting-started/configuration/#service-dependencies","title":"Service Dependencies","text":"<p>Services start in this order:</p> <ol> <li>Infrastructure (MongoDB, RabbitMQ)</li> <li>Auth Service (provides JWT keys)</li> <li>Wallet, Transactions, Notifications (consume events)</li> <li>NGINX Gateway (routes to all services)</li> </ol>"},{"location":"getting-started/configuration/#nginx-gateway-configuration","title":"NGINX Gateway Configuration","text":"<p>The NGINX gateway is configured in <code>nginx/nginx.conf</code>:</p>"},{"location":"getting-started/configuration/#rate-limiting_1","title":"Rate Limiting","text":"<pre><code>limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;\nlimit_req zone=api_limit burst=20 nodelay;\n</code></pre> <ul> <li>Rate: 10 requests/second</li> <li>Burst: Allow up to 20 requests in a burst</li> <li>Zone Size: 10MB (stores ~160K IP addresses)</li> </ul>"},{"location":"getting-started/configuration/#routes","title":"Routes","text":"Path Backend Service Port <code>/api/v1/auth/*</code> Auth Service 4001 <code>/api/v1/users/*</code> Auth Service 4001 <code>/api/v1/wallet/*</code> Wallet Service 4003 <code>/api/v1/transactions/*</code> Transactions Service 4004 <code>/.well-known/*</code> Auth Service 4001"},{"location":"getting-started/configuration/#timeouts","title":"Timeouts","text":"<ul> <li>Proxy Connect Timeout: 60s</li> <li>Proxy Send Timeout: 60s</li> <li>Proxy Read Timeout: 60s</li> </ul>"},{"location":"getting-started/configuration/#mongodb-configuration","title":"MongoDB Configuration","text":""},{"location":"getting-started/configuration/#database-names","title":"Database Names","text":"Service Database Name Auth <code>mint_auth</code> Wallet <code>mint_wallet</code> Transactions <code>mint_txns</code>"},{"location":"getting-started/configuration/#connection-string-format","title":"Connection String Format","text":"<pre><code>mongodb://&lt;username&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;database&gt;?authSource=admin\n</code></pre> <p>Example: <pre><code>mongodb://root:example@mongodb:27017/mint_auth?authSource=admin\n</code></pre></p>"},{"location":"getting-started/configuration/#indexes","title":"Indexes","text":"<p>Each service automatically creates indexes on startup:</p> <ul> <li>Auth: <code>users.email</code> (unique)</li> <li>Wallet: <code>wallets.userId</code> (unique)</li> <li>Transactions: <code>transactions.userId</code>, <code>transactions.type</code></li> </ul>"},{"location":"getting-started/configuration/#rabbitmq-configuration","title":"RabbitMQ Configuration","text":""},{"location":"getting-started/configuration/#exchanges","title":"Exchanges","text":"Exchange Type Description <code>auth.events</code> topic User and auth events <code>transaction.events</code> topic Transaction lifecycle events"},{"location":"getting-started/configuration/#queue-configuration","title":"Queue Configuration","text":"<p>All queues are: - Durable: Survive broker restarts - Auto-delete: No - Exclusive: No</p>"},{"location":"getting-started/configuration/#connection-settings","title":"Connection Settings","text":"<p>Default connection string: <pre><code>amqp://guest:guest@rabbitmq:5672\n</code></pre></p> <p>Production Security</p> <p>Change the default RabbitMQ credentials in production!</p>"},{"location":"getting-started/configuration/#security-best-practices","title":"Security Best Practices","text":""},{"location":"getting-started/configuration/#production-checklist","title":"Production Checklist","text":"<ul> <li>[ ] Change MongoDB credentials</li> <li>[ ] Change RabbitMQ credentials</li> <li>[ ] Use strong JWT secrets</li> <li>[ ] Configure real SMTP server</li> <li>[ ] Set proper CORS origins</li> <li>[ ] Enable HTTPS in NGINX</li> <li>[ ] Use environment-specific <code>.env</code> files</li> <li>[ ] Never commit <code>.env</code> files to Git</li> <li>[ ] Use Docker secrets for sensitive data</li> <li>[ ] Enable MongoDB authentication</li> <li>[ ] Configure firewall rules</li> <li>[ ] Set up monitoring and alerts</li> </ul>"},{"location":"getting-started/configuration/#cookie-security","title":"Cookie Security","text":"<p>In production, ensure cookies are: - <code>HttpOnly</code>: Yes (prevent XSS) - <code>Secure</code>: Yes (HTTPS only) - <code>SameSite</code>: Strict (CSRF protection) - <code>MaxAge</code>: 7 days (604800 seconds)</p>"},{"location":"getting-started/configuration/#logging-configuration","title":"Logging Configuration","text":""},{"location":"getting-started/configuration/#log-levels","title":"Log Levels","text":"<p>Set <code>LOG_LEVEL</code> in environment:</p> <ul> <li><code>error</code>: Only errors</li> <li><code>warn</code>: Warnings and errors</li> <li><code>info</code>: General information (default)</li> <li><code>debug</code>: Detailed debugging</li> </ul>"},{"location":"getting-started/configuration/#winston-logger","title":"Winston Logger","text":"<p>Each service uses Winston for structured logging:</p> <pre><code>{\n  level: process.env.LOG_LEVEL || 'info',\n  format: winston.format.json(),\n  transports: [\n    new winston.transports.Console(),\n    new winston.transports.File({ filename: 'error.log', level: 'error' }),\n    new winston.transports.File({ filename: 'combined.log' })\n  ]\n}\n</code></pre>"},{"location":"getting-started/configuration/#performance-tuning","title":"Performance Tuning","text":""},{"location":"getting-started/configuration/#mongodb","title":"MongoDB","text":"<ul> <li>Enable connection pooling</li> <li>Create indexes for frequent queries</li> <li>Use lean queries when possible</li> <li>Limit result sets with pagination</li> </ul>"},{"location":"getting-started/configuration/#rabbitmq","title":"RabbitMQ","text":"<ul> <li>Use prefetch count to limit concurrent messages</li> <li>Enable message acknowledgments</li> <li>Set appropriate TTL for messages</li> <li>Monitor queue depths</li> </ul>"},{"location":"getting-started/configuration/#nginx","title":"NGINX","text":"<ul> <li>Adjust worker processes based on CPU cores</li> <li>Enable keepalive connections</li> <li>Configure buffer sizes appropriately</li> <li>Enable gzip compression</li> </ul>"},{"location":"getting-started/configuration/#monitoring","title":"Monitoring","text":""},{"location":"getting-started/configuration/#health-checks","title":"Health Checks","text":"<p>All services expose <code>/health</code> endpoints:</p> <pre><code>curl http://localhost/api/v1/auth/health\ncurl http://localhost/api/v1/wallet/health  # Through gateway\ncurl http://localhost/api/v1/transactions/health\n</code></pre>"},{"location":"getting-started/configuration/#rabbitmq-monitoring","title":"RabbitMQ Monitoring","text":"<p>Access the management UI at http://localhost:15672</p> <p>Monitor: - Queue depths - Message rates - Consumer status - Connection health</p>"},{"location":"getting-started/configuration/#docker-health-checks","title":"Docker Health Checks","text":"<p>Each service has built-in Docker health checks:</p> <pre><code>healthcheck:\n  test: [\"CMD\", \"wget\", \"--quiet\", \"--tries=1\", \"--spider\", \"http://localhost:4001/health\"]\n  interval: 30s\n  timeout: 10s\n  retries: 3\n  start_period: 40s\n</code></pre>"},{"location":"getting-started/configuration/#advanced-topics","title":"Advanced Topics","text":""},{"location":"getting-started/configuration/#custom-environment-files","title":"Custom Environment Files","text":"<p>Create service-specific environment files:</p> <pre><code># Local development\nauth/.env.local\n\n# Docker development\nauth/.env.docker\n\n# Production\nauth/.env.production\n</code></pre>"},{"location":"getting-started/configuration/#override-docker-compose","title":"Override Docker Compose","text":"<p>Create <code>docker-compose.override.yml</code> for local customizations:</p> <pre><code>services:\n  auth:\n    ports:\n      - \"4001:4001\"  # Expose auth port locally\n    environment:\n      LOG_LEVEL: debug\n</code></pre>"},{"location":"getting-started/configuration/#volume-mounts","title":"Volume Mounts","text":"<p>In development, mount source code for hot-reloading:</p> <pre><code>volumes:\n  - ./auth/src:/app/src\n  - ./auth/tsconfig.json:/app/tsconfig.json:ro\n  - /app/node_modules\n</code></pre>"},{"location":"getting-started/configuration/#next-steps","title":"Next Steps","text":"<ul> <li>Development Guide - Local development setup</li> <li>Deployment Guide - Production deployment</li> <li>Troubleshooting - Common issues and solutions</li> </ul>"},{"location":"getting-started/installation/","title":"Installation Guide","text":"<p>This guide will help you install and set up Mint on your local machine.</p>"},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"<p>Before you begin, ensure you have the following installed:</p> <ul> <li>Docker (v20.10 or higher) - Install Docker</li> <li>Docker Compose (v2.0 or higher) - Install Docker Compose</li> <li>Git - Install Git</li> </ul> <p>Verify Installation</p> <p>Check if Docker and Docker Compose are installed correctly: <pre><code>docker --version\ndocker compose version\n</code></pre></p>"},{"location":"getting-started/installation/#clone-the-repository","title":"Clone the Repository","text":"<ol> <li>Clone the repository</li> </ol> <pre><code>git clone https://github.com/sreekarnv/mint.git\ncd mint\n</code></pre>"},{"location":"getting-started/installation/#environment-configuration","title":"Environment Configuration","text":"<p>Each service requires environment variables. Create <code>.env.docker</code> files for each service:</p>"},{"location":"getting-started/installation/#quick-setup-copy-from-examples","title":"Quick Setup (Copy from Examples)","text":"<pre><code># Auth Service\ncp auth/.env.docker.example auth/.env.docker\n\n# Wallet Service\ncp wallet/.env.docker.example wallet/.env.docker\n\n# Transactions Service\ncp transactions/.env.docker.example transactions/.env.docker\n\n# Notifications Service\ncp notifications/.env.docker.example notifications/.env.docker\n</code></pre>"},{"location":"getting-started/installation/#manual-configuration","title":"Manual Configuration","text":"<p>If the example files don't exist, create <code>.env.docker</code> files manually:</p>"},{"location":"getting-started/installation/#auth-service-authenvdocker","title":"Auth Service (<code>auth/.env.docker</code>)","text":"<pre><code>NODE_ENV=production\nPORT=4001\nDATABASE_URL=mongodb://root:example@mongodb:27017/mint_auth?authSource=admin\nJWT_ISS=\"auth-service\"\nJWT_AUD=\"wallet-service transaction-service notification-service\"\nRABBITMQ_URL=amqp://guest:guest@rabbitmq:5672\n</code></pre>"},{"location":"getting-started/installation/#wallet-service-walletenvdocker","title":"Wallet Service (<code>wallet/.env.docker</code>)","text":"<pre><code>NODE_ENV=production\nPORT=4003\nDATABASE_URL=mongodb://root:example@mongodb:27017/mint_wallet?authSource=admin\nRABBITMQ_URL=amqp://guest:guest@rabbitmq:5672\nJWKS_ENDPOINT=http://auth:4001/.well-known/jwks.json\nJWT_ISS=\"auth-service\"\nJWT_AUD=\"wallet-service\"\n</code></pre>"},{"location":"getting-started/installation/#transactions-service-transactionsenvdocker","title":"Transactions Service (<code>transactions/.env.docker</code>)","text":"<pre><code>NODE_ENV=production\nPORT=4004\nRABBITMQ_URL=amqp://guest:guest@rabbitmq:5672\nDATABASE_URL=mongodb://root:example@mongodb:27017/mint_txns?authSource=admin\nJWKS_ENDPOINT=http://auth:4001/.well-known/jwks.json\nJWT_AUD=transaction-service\nJWT_ISS=auth-service\n</code></pre>"},{"location":"getting-started/installation/#notifications-service-notificationsenvdocker","title":"Notifications Service (<code>notifications/.env.docker</code>)","text":"<pre><code>NODE_ENV=production\nPORT=4002\n\nSMTP_HOST=sandbox.smtp.mailtrap.io\nSMTP_PORT=2525\nSMTP_USER=your-mailtrap-user\nSMTP_PASS=your-mailtrap-password\n\nRABBITMQ_URL=amqp://guest:guest@rabbitmq:5672\n</code></pre> <p>Email Configuration</p> <p>For the notifications service to send emails, you need to configure SMTP settings. For testing, use Mailtrap or any SMTP service.</p>"},{"location":"getting-started/installation/#generate-rsa-keys-for-jwt","title":"Generate RSA Keys for JWT","text":"<p>The auth service requires RSA keys for JWT signing:</p> <pre><code>cd auth\nmkdir -p keys\ncd keys\n\n# Generate private key\nopenssl genrsa -out private_key.pem 2048\n\n# Generate public key\nopenssl rsa -in private_key.pem -pubout -out public_key.pem\n\ncd ../..\n</code></pre> <p>Key Location</p> <p>The keys should be in <code>auth/keys/</code> directory. The Dockerfile will copy them during build.</p>"},{"location":"getting-started/installation/#build-and-run","title":"Build and Run","text":""},{"location":"getting-started/installation/#production-mode","title":"Production Mode","text":"<p>Run the application in production mode:</p> <pre><code>docker compose up --build\n</code></pre> <p>This will:</p> <ul> <li>Build all service images</li> <li>Start MongoDB and RabbitMQ</li> <li>Launch all microservices</li> <li>Start the NGINX gateway</li> </ul> <p>Expected Output</p> <p>You should see logs from all services indicating they've started successfully. Look for messages like: <pre><code>mint-auth       | Server running on port 4001\nmint-wallet     | Server running on port 4003\nmint-transactions | Server running on port 4004\nmint-notifications | Server running on port 4002\n</code></pre></p>"},{"location":"getting-started/installation/#development-mode","title":"Development Mode","text":"<p>For development with hot-reloading:</p> <pre><code>docker compose -f docker-compose.dev.yml up --build\n</code></pre> <p>Development mode features:</p> <ul> <li>\u2705 Volume mounts for source code</li> <li>\u2705 Automatic restart on file changes</li> <li>\u2705 Debug logging enabled</li> <li>\u2705 Service stdout/stderr visible</li> </ul>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<p>Once all services are running, verify they're healthy:</p>"},{"location":"getting-started/installation/#check-gateway-health","title":"Check Gateway Health","text":"<pre><code>curl http://localhost/health\n</code></pre> <p>Expected Response: <pre><code>{\n  \"status\": \"healthy\"\n}\n</code></pre></p>"},{"location":"getting-started/installation/#check-auth-service","title":"Check Auth Service","text":"<pre><code>curl http://localhost/api/v1/auth/health\n</code></pre>"},{"location":"getting-started/installation/#check-jwks-endpoint","title":"Check JWKS Endpoint","text":"<pre><code>curl http://localhost/.well-known/jwks.json\n</code></pre>"},{"location":"getting-started/installation/#check-docker-containers","title":"Check Docker Containers","text":"<pre><code>docker compose ps\n</code></pre> <p>All containers should show status as <code>healthy</code> or <code>running</code>.</p>"},{"location":"getting-started/installation/#access-services","title":"Access Services","text":"<p>Once running, the services are available at:</p> Service URL Credentials API Gateway http://localhost - Auth Service http://localhost:4001 (internal) - Wallet Service http://localhost:4003 (internal) - Transactions Service http://localhost:4004 (internal) - Notifications Service http://localhost:4002 (internal) - RabbitMQ Management http://localhost:15672 guest/guest MongoDB mongodb://localhost:27017 root/example <p>Gateway vs Direct Access</p> <p>All client requests should go through the API Gateway at <code>http://localhost</code>. Direct service ports are for internal communication and debugging only.</p>"},{"location":"getting-started/installation/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/installation/#port-already-in-use","title":"Port Already in Use","text":"<p>Error: <code>Error: bind: address already in use</code></p> <p>Solution: <pre><code># Find process using the port\nlsof -i :80  # or :4001, :5672, etc.\n\n# Kill the process\nkill -9 &lt;PID&gt;\n</code></pre></p>"},{"location":"getting-started/installation/#services-wont-start","title":"Services Won't Start","text":"<p>Error: Containers exit immediately</p> <p>Solution: <pre><code># Check logs\ndocker compose logs &lt;service-name&gt;\n\n# Rebuild containers\ndocker compose down -v\ndocker compose up --build\n</code></pre></p>"},{"location":"getting-started/installation/#database-connection-issues","title":"Database Connection Issues","text":"<p>Error: <code>MongoServerError: Authentication failed</code></p> <p>Solution:</p> <ul> <li>Verify <code>DATABASE_URL</code> in <code>.env.docker</code> files</li> <li>Ensure MongoDB is healthy: <code>docker compose ps</code></li> <li>Reset MongoDB: <code>docker compose down -v mongodb &amp;&amp; docker compose up mongodb</code></li> </ul> <p>For more troubleshooting tips, see the Troubleshooting Guide.</p>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<p>Now that Mint is installed:</p> <ol> <li>Quick Start Guide - Complete your first transaction flow</li> <li>Configuration Guide - Learn about advanced configuration options</li> <li>API Reference - Explore the API endpoints</li> </ol>"},{"location":"getting-started/installation/#clean-up","title":"Clean Up","text":"<p>To stop and remove all containers:</p> <pre><code># Stop containers\ndocker compose down\n\n# Remove containers and volumes\ndocker compose down -v\n\n# Remove containers, volumes, and images\ndocker compose down --rmi all -v\n</code></pre>"},{"location":"getting-started/quick-start/","title":"Quick Start Guide","text":"<p>This guide will walk you through creating your first user and completing a transaction flow.</p>"},{"location":"getting-started/quick-start/#prerequisites","title":"Prerequisites","text":"<ul> <li>Mint is installed and running</li> <li>All services show as <code>healthy</code> in <code>docker compose ps</code></li> <li>curl or similar HTTP client installed</li> </ul>"},{"location":"getting-started/quick-start/#step-1-register-a-user","title":"Step 1: Register a User","text":"<p>Create a new user account:</p> <pre><code>curl -X POST http://localhost/api/v1/auth/signup \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"John Doe\",\n    \"email\": \"john@example.com\",\n    \"password\": \"SecurePass123!\"\n  }'\n</code></pre> <p>Response: <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439011\",\n  \"name\": \"John Doe\",\n  \"email\": \"john@example.com\",\n  \"createdAt\": \"2025-01-15T10:30:00.000Z\"\n}\n</code></pre></p> <p>What Happened?</p> <ul> <li>User account was created</li> <li>Password was hashed with Argon2</li> <li><code>user.signup</code> event was published to RabbitMQ</li> <li>Wallet was created automatically (event-driven)</li> <li>Welcome email was sent (if SMTP is configured)</li> </ul>"},{"location":"getting-started/quick-start/#step-2-login","title":"Step 2: Login","text":"<p>Login to get an authentication cookie:</p> <pre><code>curl -X POST http://localhost/api/v1/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"john@example.com\",\n    \"password\": \"SecurePass123!\"\n  }' \\\n  -c cookies.txt\n</code></pre> <p>Response: <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439011\",\n  \"name\": \"John Doe\",\n  \"email\": \"john@example.com\"\n}\n</code></pre></p> <p>Authentication</p> <p>The <code>-c cookies.txt</code> flag saves the HTTP-only cookie containing your JWT token. Use <code>-b cookies.txt</code> in subsequent requests to authenticate.</p>"},{"location":"getting-started/quick-start/#step-3-get-your-wallet","title":"Step 3: Get Your Wallet","text":"<p>Check your wallet balance:</p> <pre><code>curl http://localhost/api/v1/wallet/user \\\n  -b cookies.txt\n</code></pre> <p>Response: <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439012\",\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"balance\": 0.00,\n  \"createdAt\": \"2025-01-15T10:30:05.000Z\",\n  \"updatedAt\": \"2025-01-15T10:30:05.000Z\"\n}\n</code></pre></p> <p>Note</p> <p>Your wallet starts with a balance of $0.00</p>"},{"location":"getting-started/quick-start/#step-4-top-up-your-wallet","title":"Step 4: Top-Up Your Wallet","text":"<p>Add funds to your wallet:</p> <pre><code>curl -X POST http://localhost/api/v1/transactions/topup \\\n  -H \"Content-Type: application/json\" \\\n  -b cookies.txt \\\n  -d '{\n    \"amount\": 100.00,\n    \"description\": \"Initial top-up\"\n  }'\n</code></pre> <p>Response: <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439013\",\n  \"type\": \"topup\",\n  \"amount\": 100.00,\n  \"description\": \"Initial top-up\",\n  \"status\": \"pending\",\n  \"createdAt\": \"2025-01-15T11:00:00.000Z\"\n}\n</code></pre></p> <p>Transaction Flow</p> <p>The transaction goes through these states:</p> <ol> <li>PENDING - Transaction created</li> <li>PROCESSING - Being processed by the system</li> <li>COMPLETED - Balance updated successfully</li> </ol> <p>This happens asynchronously via RabbitMQ events!</p>"},{"location":"getting-started/quick-start/#step-5-verify-your-balance","title":"Step 5: Verify Your Balance","text":"<p>Wait a moment for the transaction to process, then check your balance again:</p> <pre><code>curl http://localhost/api/v1/wallet/user \\\n  -b cookies.txt\n</code></pre> <p>Response: <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439012\",\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"balance\": 100.00,\n  \"createdAt\": \"2025-01-15T10:30:05.000Z\",\n  \"updatedAt\": \"2025-01-15T11:00:02.000Z\"\n}\n</code></pre></p> <p>Success</p> <p>Your balance is now $100.00!</p>"},{"location":"getting-started/quick-start/#step-6-create-another-user","title":"Step 6: Create Another User","text":"<p>To test transfers, create a second user:</p> <pre><code>curl -X POST http://localhost/api/v1/auth/signup \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"Jane Smith\",\n    \"email\": \"jane@example.com\",\n    \"password\": \"SecurePass123!\"\n  }'\n</code></pre> <p>Save the user ID from the response: <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439020\",  // &lt;- Save this\n  \"name\": \"Jane Smith\",\n  \"email\": \"jane@example.com\"\n}\n</code></pre></p>"},{"location":"getting-started/quick-start/#step-7-transfer-money","title":"Step 7: Transfer Money","text":"<p>Transfer money from John to Jane:</p> <pre><code>curl -X POST http://localhost/api/v1/transactions/transfer \\\n  -H \"Content-Type: application/json\" \\\n  -b cookies.txt \\\n  -d '{\n    \"recipientId\": \"507f1f77bcf86cd799439020\",\n    \"amount\": 50.00,\n    \"description\": \"Payment for services\"\n  }'\n</code></pre> <p>Response: <pre><code>{\n  \"id\": \"507f1f77bcf86cd799439014\",\n  \"type\": \"transfer\",\n  \"senderId\": \"507f1f77bcf86cd799439011\",\n  \"recipientId\": \"507f1f77bcf86cd799439020\",\n  \"amount\": 50.00,\n  \"description\": \"Payment for services\",\n  \"status\": \"pending\",\n  \"createdAt\": \"2025-01-15T11:15:00.000Z\"\n}\n</code></pre></p>"},{"location":"getting-started/quick-start/#step-8-view-transaction-history","title":"Step 8: View Transaction History","text":"<p>List all your transactions:</p> <pre><code>curl http://localhost/api/v1/transactions \\\n  -b cookies.txt\n</code></pre> <p>Response: <pre><code>{\n  \"transactions\": [\n    {\n      \"id\": \"507f1f77bcf86cd799439013\",\n      \"type\": \"topup\",\n      \"amount\": 100.00,\n      \"status\": \"completed\",\n      \"description\": \"Initial top-up\",\n      \"createdAt\": \"2025-01-15T11:00:00.000Z\",\n      \"completedAt\": \"2025-01-15T11:00:02.000Z\"\n    },\n    {\n      \"id\": \"507f1f77bcf86cd799439014\",\n      \"type\": \"transfer\",\n      \"senderId\": \"507f1f77bcf86cd799439011\",\n      \"recipientId\": \"507f1f77bcf86cd799439020\",\n      \"amount\": 50.00,\n      \"status\": \"completed\",\n      \"description\": \"Payment for services\",\n      \"createdAt\": \"2025-01-15T11:15:00.000Z\",\n      \"completedAt\": \"2025-01-15T11:15:02.000Z\"\n    }\n  ],\n  \"total\": 2\n}\n</code></pre></p>"},{"location":"getting-started/quick-start/#step-9-check-final-balance","title":"Step 9: Check Final Balance","text":"<p>Verify your updated balance:</p> <pre><code>curl http://localhost/api/v1/wallet/user \\\n  -b cookies.txt\n</code></pre> <p>Response: <pre><code>{\n  \"balance\": 50.00\n}\n</code></pre></p> <p>Complete!</p> <p>You've successfully:</p> <ul> <li>\u2705 Created two users</li> <li>\u2705 Logged in</li> <li>\u2705 Topped up your wallet</li> <li>\u2705 Transferred money to another user</li> <li>\u2705 Viewed transaction history</li> </ul>"},{"location":"getting-started/quick-start/#understanding-the-event-flow","title":"Understanding the Event Flow","text":"<p>Here's what happened behind the scenes during the transfer:</p> <pre><code>sequenceDiagram\n    participant You\n    participant Gateway\n    participant Transactions\n    participant RabbitMQ\n    participant Wallet\n    participant Notifications\n\n    You-&gt;&gt;Gateway: POST /transactions/transfer\n    Gateway-&gt;&gt;Transactions: Forward request\n    Transactions-&gt;&gt;Transactions: Create PENDING transaction\n    Transactions-&gt;&gt;RabbitMQ: Publish transaction.created\n    Transactions--&gt;&gt;You: Return transaction\n\n    RabbitMQ-&gt;&gt;Transactions: Consume transaction.created\n    Transactions-&gt;&gt;Transactions: Validate balance\n    Transactions-&gt;&gt;RabbitMQ: Publish transaction.completed\n\n    RabbitMQ-&gt;&gt;Wallet: Consume transaction.completed\n    Wallet-&gt;&gt;Wallet: Update both balances\n    Wallet-&gt;&gt;RabbitMQ: Publish wallet.transactionFinalized\n\n    RabbitMQ-&gt;&gt;Transactions: Consume wallet.transactionFinalized\n    Transactions-&gt;&gt;Transactions: Mark as COMPLETED\n\n    RabbitMQ-&gt;&gt;Notifications: Consume transaction.completed\n    Notifications-&gt;&gt;Notifications: Send email notification</code></pre>"},{"location":"getting-started/quick-start/#bonus-monitor-events-in-rabbitmq","title":"Bonus: Monitor Events in RabbitMQ","text":"<p>Open the RabbitMQ Management UI to see events in real-time:</p> <ol> <li>Go to http://localhost:15672</li> <li>Login with <code>guest</code> / <code>guest</code></li> <li>Click on Queues and Streams</li> <li>Watch messages flow through:</li> <li><code>wallet.update.q</code></li> <li><code>email.transactionCompleted.q</code></li> <li><code>transaction.created.q</code></li> </ol>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"<p>Now that you've completed the basics:</p> <ol> <li>Explore the API - Learn about all available endpoints</li> <li>Architecture Guide - Understand the system design</li> <li>Development Guide - Set up for local development</li> </ol>"},{"location":"getting-started/quick-start/#common-issues","title":"Common Issues","text":""},{"location":"getting-started/quick-start/#transaction-stuck-in-pending","title":"Transaction Stuck in PENDING","text":"<p>Wait 1-2 seconds for async processing. Check RabbitMQ logs: <pre><code>docker compose logs rabbitmq\n</code></pre></p>"},{"location":"getting-started/quick-start/#401-unauthorized","title":"401 Unauthorized","text":"<p>Your session may have expired. Login again: <pre><code>curl -X POST http://localhost/api/v1/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"email\": \"john@example.com\", \"password\": \"SecurePass123!\"}' \\\n  -c cookies.txt\n</code></pre></p>"},{"location":"getting-started/quick-start/#insufficient-balance","title":"Insufficient Balance","text":"<p>Ensure you have enough balance before transferring: <pre><code>curl http://localhost/api/v1/wallet/user -b cookies.txt\n</code></pre></p> <p>For more help, see the Troubleshooting Guide.</p>"},{"location":"services/auth/","title":"Auth Service","text":"<p>The Auth Service handles all authentication and user management operations.</p>"},{"location":"services/auth/#overview","title":"Overview","text":"<ul> <li>Port: 4001</li> <li>Database: <code>mint_auth</code> (MongoDB)</li> <li>Events Published: <code>user.signup</code></li> <li>Events Consumed: None</li> </ul>"},{"location":"services/auth/#features","title":"Features","text":""},{"location":"services/auth/#authentication","title":"Authentication","text":"<ul> <li>User registration with email validation</li> <li>Secure login with Argon2 password hashing</li> <li>JWT token generation using RS256 algorithm</li> <li>JWKS endpoint for public key distribution</li> <li>Session management with HTTP-only cookies</li> </ul>"},{"location":"services/auth/#user-management","title":"User Management","text":"<ul> <li>User profile CRUD operations</li> <li>User search functionality</li> <li>Current user information retrieval</li> <li>Profile updates</li> </ul>"},{"location":"services/auth/#technology-stack","title":"Technology Stack","text":"<ul> <li>Express.js - Web framework</li> <li>MongoDB/Mongoose - Database ORM</li> <li>Argon2 - Password hashing</li> <li>Jose - JWT handling (RS256)</li> <li>Zod - Request validation</li> <li>RabbitMQ - Event publishing</li> </ul>"},{"location":"services/auth/#key-endpoints","title":"Key Endpoints","text":"<p>For detailed API documentation, see Auth API Reference.</p> Endpoint Method Description Auth Required <code>/api/v1/auth/signup</code> POST Register new user No <code>/api/v1/auth/login</code> POST Login user No <code>/api/v1/auth/logout</code> POST Logout user Yes <code>/api/v1/auth/user</code> GET Get current user Yes <code>/api/v1/users</code> GET List all users Yes <code>/api/v1/users/search</code> GET Search users Yes <code>/api/v1/users/:id</code> GET Get user profile Yes <code>/api/v1/users/me</code> PUT Update current user Yes <code>/.well-known/jwks.json</code> GET JWKS endpoint No"},{"location":"services/auth/#event-publishing","title":"Event Publishing","text":""},{"location":"services/auth/#usersignup","title":"user.signup","text":"<p>Published when a new user registers.</p> <p>Routing Key: <code>user.signup</code></p> <p>Payload: <pre><code>{\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"email\": \"john@example.com\",\n  \"name\": \"John Doe\"\n}\n</code></pre></p> <p>Consumers: - Wallet Service - Creates wallet - Notifications Service - Sends welcome email</p>"},{"location":"services/auth/#security","title":"Security","text":""},{"location":"services/auth/#jwt-implementation","title":"JWT Implementation","text":"<ul> <li>Algorithm: RS256 (asymmetric encryption)</li> <li>Issuer: <code>auth-service</code></li> <li>Audience: Service-specific</li> <li>Expiration: 7 days</li> <li>Storage: HTTP-only cookies</li> </ul>"},{"location":"services/auth/#password-security","title":"Password Security","text":"<ul> <li>Hashing: Argon2 (industry standard)</li> <li>Validation: Minimum 8 characters</li> <li>Storage: Never returned in API responses</li> </ul>"},{"location":"services/auth/#cookie-security","title":"Cookie Security","text":"<ul> <li>HttpOnly: Prevents JavaScript access</li> <li>Secure: HTTPS only (production)</li> <li>SameSite: Strict (CSRF protection)</li> <li>MaxAge: 7 days</li> </ul>"},{"location":"services/auth/#configuration","title":"Configuration","text":"<p>See Configuration Guide for environment variables.</p>"},{"location":"services/auth/#related-documentation","title":"Related Documentation","text":"<ul> <li>Auth API Reference</li> <li>Event Architecture</li> <li>Getting Started</li> </ul>"},{"location":"services/notifications/","title":"Notifications Service","text":"<p>The Notifications Service handles all user notifications via email using event-driven architecture.</p>"},{"location":"services/notifications/#overview","title":"Overview","text":"<ul> <li>Port: 4002</li> <li>Database: None (stateless)</li> <li>Events Published: None</li> <li>Events Consumed: <code>user.signup</code>, <code>transaction.completed</code>, <code>transaction.failed</code></li> </ul>"},{"location":"services/notifications/#features","title":"Features","text":""},{"location":"services/notifications/#email-notifications","title":"Email Notifications","text":"<ul> <li>Welcome emails on user registration</li> <li>Transaction completion notifications</li> <li>Transaction failure alerts</li> <li>Event-driven notification delivery</li> </ul>"},{"location":"services/notifications/#email-templates","title":"Email Templates","text":"<ul> <li>Customizable HTML templates</li> <li>Dynamic content injection</li> <li>Professional formatting</li> </ul>"},{"location":"services/notifications/#technology-stack","title":"Technology Stack","text":"<ul> <li>Express.js - Web framework</li> <li>RabbitMQ - Event consumption</li> <li>Nodemailer - Email sending (SMTP)</li> <li>Winston - Logging</li> </ul>"},{"location":"services/notifications/#notification-types","title":"Notification Types","text":""},{"location":"services/notifications/#welcome-email","title":"Welcome Email","text":"<p>Trigger: User registration</p> <p>Template: <pre><code>Subject: Welcome to Mint!\n\nHi [Name],\n\nWelcome to Mint! Your wallet has been created and is ready to use.\n\nYour balance: $0.00\n\nGet started by adding funds to your wallet.\n\nBest regards,\nMint Team\n</code></pre></p>"},{"location":"services/notifications/#transaction-completed","title":"Transaction Completed","text":"<p>Trigger: Successful transaction</p> <p>Template: <pre><code>Subject: Transaction Completed\n\nHi [Name],\n\nYour [transaction type] transaction has been completed successfully.\n\nAmount: $[amount]\nDescription: [description]\nNew Balance: $[balance]\n\nTransaction ID: [id]\n\nBest regards,\nMint Team\n</code></pre></p>"},{"location":"services/notifications/#transaction-failed","title":"Transaction Failed","text":"<p>Trigger: Failed transaction</p> <p>Template: <pre><code>Subject: Transaction Failed\n\nHi [Name],\n\nYour [transaction type] transaction has failed.\n\nAmount: $[amount]\nReason: [failure reason]\n\nPlease try again or contact support if the issue persists.\n\nBest regards,\nMint Team\n</code></pre></p>"},{"location":"services/notifications/#event-consumption","title":"Event Consumption","text":""},{"location":"services/notifications/#usersignup","title":"user.signup","text":"<p>Sends welcome email to new users.</p> <p>Expected Payload: <pre><code>{\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"email\": \"john@example.com\",\n  \"name\": \"John Doe\"\n}\n</code></pre></p> <p>Action: Send welcome email</p>"},{"location":"services/notifications/#transactioncompleted","title":"transaction.completed","text":"<p>Sends success notification.</p> <p>Expected Payload: <pre><code>{\n  \"transactionId\": \"507f1f77bcf86cd799439013\",\n  \"type\": \"transfer\",\n  \"senderId\": \"507f1f77bcf86cd799439011\",\n  \"recipientId\": \"507f1f77bcf86cd799439020\",\n  \"amount\": 50.00,\n  \"description\": \"Payment for services\"\n}\n</code></pre></p> <p>Action: Send completion email to sender (and recipient for transfers)</p>"},{"location":"services/notifications/#transactionfailed","title":"transaction.failed","text":"<p>Sends failure notification.</p> <p>Expected Payload: <pre><code>{\n  \"transactionId\": \"507f1f77bcf86cd799439013\",\n  \"type\": \"transfer\",\n  \"senderId\": \"507f1f77bcf86cd799439011\",\n  \"amount\": 50.00,\n  \"reason\": \"Insufficient balance\"\n}\n</code></pre></p> <p>Action: Send failure email to sender</p>"},{"location":"services/notifications/#smtp-configuration","title":"SMTP Configuration","text":"<p>The service supports any SMTP server:</p>"},{"location":"services/notifications/#development-mailtrap","title":"Development (Mailtrap)","text":"<pre><code>SMTP_HOST=sandbox.smtp.mailtrap.io\nSMTP_PORT=2525\nSMTP_USER=your-mailtrap-user\nSMTP_PASS=your-mailtrap-password\n</code></pre>"},{"location":"services/notifications/#production-gmail","title":"Production (Gmail)","text":"<pre><code>SMTP_HOST=smtp.gmail.com\nSMTP_PORT=587\nSMTP_SECURE=false\nSMTP_USER=your-email@gmail.com\nSMTP_PASS=your-app-password\n</code></pre>"},{"location":"services/notifications/#production-sendgrid","title":"Production (SendGrid)","text":"<pre><code>SMTP_HOST=smtp.sendgrid.net\nSMTP_PORT=587\nSMTP_USER=apikey\nSMTP_PASS=your-sendgrid-api-key\n</code></pre> <p>Gmail App Passwords</p> <p>For Gmail, you must use an App Password, not your regular password.</p>"},{"location":"services/notifications/#error-handling","title":"Error Handling","text":""},{"location":"services/notifications/#failed-email-delivery","title":"Failed Email Delivery","text":"<p>If an email fails to send:</p> <ol> <li>Error is logged</li> <li>Message is acknowledged (to prevent infinite retries)</li> <li>Admin notification could be triggered (future enhancement)</li> </ol>"},{"location":"services/notifications/#smtp-connection-issues","title":"SMTP Connection Issues","text":"<ul> <li>Connection timeout: 30 seconds</li> <li>Automatic retry: Not implemented (single attempt)</li> <li>Graceful failure: Service continues processing other messages</li> </ul>"},{"location":"services/notifications/#monitoring","title":"Monitoring","text":""},{"location":"services/notifications/#email-sending-metrics","title":"Email Sending Metrics","text":"<p>Monitor in application logs:</p> <pre><code>{\n  \"level\": \"info\",\n  \"message\": \"Email sent successfully\",\n  \"type\": \"welcome\",\n  \"recipient\": \"john@example.com\",\n  \"timestamp\": \"2025-01-15T10:30:00Z\"\n}\n</code></pre>"},{"location":"services/notifications/#error-logs","title":"Error Logs","text":"<pre><code>{\n  \"level\": \"error\",\n  \"message\": \"Failed to send email\",\n  \"type\": \"transaction_completed\",\n  \"recipient\": \"john@example.com\",\n  \"error\": \"SMTP connection timeout\",\n  \"timestamp\": \"2025-01-15T10:30:00Z\"\n}\n</code></pre>"},{"location":"services/notifications/#testing","title":"Testing","text":""},{"location":"services/notifications/#local-testing-with-mailtrap","title":"Local Testing with Mailtrap","text":"<ol> <li>Sign up for Mailtrap</li> <li>Get SMTP credentials from your inbox</li> <li>Configure <code>.env.docker</code> with Mailtrap credentials</li> <li>All emails will be caught by Mailtrap (not sent to real addresses)</li> </ol>"},{"location":"services/notifications/#manual-testing","title":"Manual Testing","text":"<pre><code># Register user (triggers welcome email)\ncurl -X POST http://localhost/api/v1/auth/signup \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"Test User\",\n    \"email\": \"test@example.com\",\n    \"password\": \"Test123!\"\n  }'\n\n# Check Mailtrap inbox for welcome email\n</code></pre>"},{"location":"services/notifications/#configuration","title":"Configuration","text":"<p>See Configuration Guide for environment variables.</p>"},{"location":"services/notifications/#future-enhancements","title":"Future Enhancements","text":"<ul> <li>SMS Notifications - Text message alerts</li> <li>Push Notifications - Mobile app notifications</li> <li>Notification Preferences - User-configurable notification settings</li> <li>Email Templates - Advanced template engine</li> <li>Retry Logic - Automatic retry on failures</li> <li>Dead Letter Queue - Handle persistent failures</li> </ul>"},{"location":"services/notifications/#related-documentation","title":"Related Documentation","text":"<ul> <li>Event Architecture</li> <li>Getting Started</li> <li>Configuration Guide</li> </ul>"},{"location":"services/transactions/","title":"Transactions Service","text":"<p>The Transactions Service orchestrates all financial transactions between users with event-driven processing.</p>"},{"location":"services/transactions/#overview","title":"Overview","text":"<ul> <li>Port: 4004</li> <li>Database: <code>mint_txns</code> (MongoDB)</li> <li>Events Published: <code>transaction.created</code>, <code>transaction.completed</code>, <code>transaction.failed</code></li> <li>Events Consumed: <code>transaction.created</code>, <code>wallet.transactionFinalized</code></li> </ul>"},{"location":"services/transactions/#features","title":"Features","text":""},{"location":"services/transactions/#transaction-types","title":"Transaction Types","text":"<ul> <li>Top-up: Add funds to wallet</li> <li>Transfer: Send money to other users</li> </ul>"},{"location":"services/transactions/#transaction-lifecycle","title":"Transaction Lifecycle","text":"<ul> <li>State management: PENDING \u2192 PROCESSING \u2192 COMPLETED/FAILED</li> <li>Event-driven workflow</li> <li>Automatic rollback on failures</li> <li>Idempotency support</li> </ul>"},{"location":"services/transactions/#validation","title":"Validation","text":"<ul> <li>Balance verification for transfers</li> <li>User existence checks</li> <li>Amount validation</li> </ul>"},{"location":"services/transactions/#technology-stack","title":"Technology Stack","text":"<ul> <li>Express.js - Web framework</li> <li>MongoDB/Mongoose - Database ORM</li> <li>RabbitMQ - Event consumption &amp; publishing</li> <li>Zod - Request validation</li> <li>Jose - JWT verification</li> </ul>"},{"location":"services/transactions/#key-endpoints","title":"Key Endpoints","text":"<p>For detailed API documentation, see Transactions API Reference.</p> Endpoint Method Description Auth Required <code>/api/v1/transactions</code> GET List all transactions Yes <code>/api/v1/transactions/:id</code> GET Get transaction details Yes <code>/api/v1/transactions/topup</code> POST Add funds to wallet Yes <code>/api/v1/transactions/transfer</code> POST Transfer funds Yes"},{"location":"services/transactions/#transaction-states","title":"Transaction States","text":"State Description <code>PENDING</code> Transaction created, awaiting processing <code>PROCESSING</code> Transaction is being processed <code>COMPLETED</code> Transaction successfully completed <code>FAILED</code> Transaction failed (insufficient balance, errors)"},{"location":"services/transactions/#event-flow","title":"Event Flow","text":""},{"location":"services/transactions/#top-up-flow","title":"Top-Up Flow","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant Transactions\n    participant RabbitMQ\n    participant Wallet\n\n    Client-&gt;&gt;Transactions: POST /topup\n    Transactions-&gt;&gt;Transactions: Create PENDING\n    Transactions-&gt;&gt;RabbitMQ: transaction.created\n    Transactions--&gt;&gt;Client: Return transaction\n\n    RabbitMQ-&gt;&gt;Transactions: Consume created\n    Transactions-&gt;&gt;Transactions: Update to PROCESSING\n    Transactions-&gt;&gt;RabbitMQ: transaction.completed\n\n    RabbitMQ-&gt;&gt;Wallet: Consume completed\n    Wallet-&gt;&gt;Wallet: Update balance\n    Wallet-&gt;&gt;RabbitMQ: wallet.transactionFinalized\n\n    RabbitMQ-&gt;&gt;Transactions: Consume finalized\n    Transactions-&gt;&gt;Transactions: Update to COMPLETED</code></pre>"},{"location":"services/transactions/#transfer-flow","title":"Transfer Flow","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant Transactions\n    participant RabbitMQ\n    participant Wallet\n\n    Client-&gt;&gt;Transactions: POST /transfer\n    Transactions-&gt;&gt;Transactions: Create PENDING\n    Transactions-&gt;&gt;RabbitMQ: transaction.created\n    Transactions--&gt;&gt;Client: Return transaction\n\n    RabbitMQ-&gt;&gt;Transactions: Consume created\n    Transactions-&gt;&gt;Transactions: Validate balance\n\n    alt Sufficient Balance\n        Transactions-&gt;&gt;Transactions: Update to PROCESSING\n        Transactions-&gt;&gt;RabbitMQ: transaction.completed\n        RabbitMQ-&gt;&gt;Wallet: Update balances\n        Wallet-&gt;&gt;RabbitMQ: wallet.transactionFinalized\n        Transactions-&gt;&gt;Transactions: COMPLETED\n    else Insufficient Balance\n        Transactions-&gt;&gt;RabbitMQ: transaction.failed\n        Transactions-&gt;&gt;Transactions: Update to FAILED\n    end</code></pre>"},{"location":"services/transactions/#event-publishing","title":"Event Publishing","text":""},{"location":"services/transactions/#transactioncreated","title":"transaction.created","text":"<p>Published when a transaction is created.</p> <p>Routing Key: <code>transaction.created</code></p> <p>Payload: <pre><code>{\n  \"transactionId\": \"507f1f77bcf86cd799439013\",\n  \"type\": \"transfer\",\n  \"senderId\": \"507f1f77bcf86cd799439011\",\n  \"recipientId\": \"507f1f77bcf86cd799439020\",\n  \"amount\": 50.00\n}\n</code></pre></p>"},{"location":"services/transactions/#transactioncompleted","title":"transaction.completed","text":"<p>Published when a transaction is successfully processed.</p> <p>Routing Key: <code>transaction.completed</code></p> <p>Consumers: - Wallet Service - Updates balances - Notifications Service - Sends success email</p>"},{"location":"services/transactions/#transactionfailed","title":"transaction.failed","text":"<p>Published when a transaction fails.</p> <p>Routing Key: <code>transaction.failed</code></p> <p>Consumers: - Wallet Service - Reverts changes - Notifications Service - Sends failure email</p>"},{"location":"services/transactions/#event-consumption","title":"Event Consumption","text":""},{"location":"services/transactions/#transactioncreated_1","title":"transaction.created","text":"<p>Processes the transaction and validates requirements.</p> <p>Action: Validate and update state to PROCESSING or FAILED</p>"},{"location":"services/transactions/#wallettransactionfinalized","title":"wallet.transactionFinalized","text":"<p>Finalizes the transaction after wallet updates.</p> <p>Action: Update state to COMPLETED</p>"},{"location":"services/transactions/#database-schema","title":"Database Schema","text":""},{"location":"services/transactions/#transaction-model","title":"Transaction Model","text":"<pre><code>{\n  type: 'topup' | 'transfer',\n  senderId: ObjectId,\n  recipientId: ObjectId,      // Only for transfers\n  amount: Number,\n  description: String,\n  status: 'pending' | 'processing' | 'completed' | 'failed',\n  createdAt: Date,\n  completedAt: Date,\n  failedAt: Date\n}\n</code></pre> <p>Indexes: - <code>senderId</code> - <code>recipientId</code> - <code>type</code> - <code>status</code></p>"},{"location":"services/transactions/#validation-rules","title":"Validation Rules","text":""},{"location":"services/transactions/#top-up","title":"Top-Up","text":"<ul> <li>Amount must be positive</li> <li>Amount must be a number</li> </ul>"},{"location":"services/transactions/#transfer","title":"Transfer","text":"<ul> <li>Amount must be positive</li> <li>Sender must have sufficient balance</li> <li>Recipient must exist</li> <li>Cannot transfer to self</li> </ul>"},{"location":"services/transactions/#configuration","title":"Configuration","text":"<p>See Configuration Guide for environment variables.</p>"},{"location":"services/transactions/#related-documentation","title":"Related Documentation","text":"<ul> <li>Transactions API Reference</li> <li>Event Architecture</li> <li>Wallet Service</li> </ul>"},{"location":"services/wallet/","title":"Wallet Service","text":"<p>The Wallet Service manages user wallet balances and processes wallet updates through event-driven architecture.</p>"},{"location":"services/wallet/#overview","title":"Overview","text":"<ul> <li>Port: 4003</li> <li>Database: <code>mint_wallet</code> (MongoDB)</li> <li>Events Published: <code>wallet.transactionFinalized</code></li> <li>Events Consumed: <code>user.signup</code>, <code>transaction.completed</code>, <code>transaction.failed</code></li> </ul>"},{"location":"services/wallet/#features","title":"Features","text":""},{"location":"services/wallet/#wallet-management","title":"Wallet Management","text":"<ul> <li>Automatic wallet creation on user signup</li> <li>Real-time balance updates from transaction events</li> <li>Wallet balance retrieval</li> <li>Transaction history tracking</li> </ul>"},{"location":"services/wallet/#concurrency-handling","title":"Concurrency Handling","text":"<ul> <li>Optimistic locking for concurrent transactions</li> <li>Atomic balance updates</li> <li>Automatic wallet reversal on failed transactions</li> </ul>"},{"location":"services/wallet/#technology-stack","title":"Technology Stack","text":"<ul> <li>Express.js - Web framework</li> <li>MongoDB/Mongoose - Database ORM</li> <li>RabbitMQ - Event consumption &amp; publishing</li> <li>Jose - JWT verification</li> </ul>"},{"location":"services/wallet/#key-endpoints","title":"Key Endpoints","text":"<p>For detailed API documentation, see Wallet API Reference.</p> Endpoint Method Description Auth Required <code>/api/v1/wallet/user</code> GET Get current user's wallet Yes"},{"location":"services/wallet/#event-consumption","title":"Event Consumption","text":""},{"location":"services/wallet/#usersignup","title":"user.signup","text":"<p>Creates a new wallet for the user.</p> <p>Action: Creates wallet with initial balance (default: $0)</p>"},{"location":"services/wallet/#transactioncompleted","title":"transaction.completed","text":"<p>Updates wallet balances based on transaction type.</p> <p>Actions: - Top-up: Add amount to wallet - Transfer: Deduct from sender, add to recipient</p>"},{"location":"services/wallet/#transactionfailed","title":"transaction.failed","text":"<p>Reverts any wallet changes from failed transactions.</p> <p>Action: Rollback balance changes</p>"},{"location":"services/wallet/#event-publishing","title":"Event Publishing","text":""},{"location":"services/wallet/#wallettransactionfinalized","title":"wallet.transactionFinalized","text":"<p>Published after successfully updating wallet balances.</p> <p>Routing Key: <code>wallet.transactionFinalized</code></p> <p>Payload: <pre><code>{\n  \"transactionId\": \"507f1f77bcf86cd799439013\",\n  \"status\": \"completed\"\n}\n</code></pre></p> <p>Consumers: - Transactions Service - Finalizes transaction state</p>"},{"location":"services/wallet/#database-schema","title":"Database Schema","text":""},{"location":"services/wallet/#wallet-model","title":"Wallet Model","text":"<pre><code>{\n  userId: ObjectId,      // Unique user reference\n  balance: Number,       // Current balance\n  createdAt: Date,\n  updatedAt: Date\n}\n</code></pre> <p>Indexes: - <code>userId</code> (unique)</p>"},{"location":"services/wallet/#concurrency-control","title":"Concurrency Control","text":""},{"location":"services/wallet/#optimistic-locking","title":"Optimistic Locking","text":"<p>Uses Mongoose versioning to prevent race conditions:</p> <pre><code>wallet.balance += amount;\nawait wallet.save(); // Throws error if version mismatch\n</code></pre>"},{"location":"services/wallet/#atomic-updates","title":"Atomic Updates","text":"<p>All balance updates are atomic operations:</p> <pre><code>await Wallet.updateOne(\n  { userId, __v: currentVersion },\n  { $inc: { balance: amount }, $inc: { __v: 1 } }\n);\n</code></pre>"},{"location":"services/wallet/#configuration","title":"Configuration","text":"<p>See Configuration Guide for environment variables.</p>"},{"location":"services/wallet/#related-documentation","title":"Related Documentation","text":"<ul> <li>Wallet API Reference</li> <li>Event Architecture</li> <li>Transactions Service</li> </ul>"}]}